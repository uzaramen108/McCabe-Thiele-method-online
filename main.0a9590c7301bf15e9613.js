"use strict";(self.webpackChunkmccabe_thiele_method_online=self.webpackChunkmccabe_thiele_method_online||[]).push([[792],{940:(e,t,n)=>{const a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBzbG96bXZmZHJwcG1tdnNucGZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NzQ1NzIsImV4cCI6MjA4MDA1MDU3Mn0.4gL96sI9vhEwgpPXFdY_c80msecst08vJYPv6PNzgO0",o="https://pslozmvfdrppmmvsnpff.supabase.co/rest/v1/systems";let l=[];const s=[{x:0,y:0},{x:.012,y:.068},{x:.02,y:.121},{x:.026,y:.159},{x:.033,y:.188},{x:.036,y:.215},{x:.053,y:.275},{x:.076,y:.366},{x:.1,y:.438},{x:.12,y:.485},{x:.14,y:.522},{x:.15,y:.541},{x:.2,y:.605},{x:.3,y:.686},{x:.4,y:.739},{x:.5,y:.779},{x:.6,y:.825},{x:.7,y:.87},{x:.8,y:.915},{x:.9,y:.958},{x:.95,y:.979},{x:1,y:1}];function r(e){if(!Array.isArray(e)||e.length<2)return console.error("VLE Data initialization failed: Data must be an array with at least 2 points."),void(l=s);l=e,console.log(`VLE Data initialized with ${l.length} points.`)}function i(e,t){if(e<=0)return 0;if(e>=1)return 1;if(t)return e*t/(1+(t-1)*e);let n=l[0],a=l[1];for(let t=1;t<l.length;t++)if(l[t].x>=e){n=l[t-1],a=l[t];break}const o=(a.y-n.y)/(a.x-n.x);return n.y+(e-n.x)*o}r(s);const c="my_created_vle_systems";class d{xd;xb;zf;q;r_factor;nm;sc;alpha;constructor(){this.xd=parseFloat(document.getElementById("xd").value),this.xb=parseFloat(document.getElementById("xb").value),this.zf=parseFloat(document.getElementById("zf").value),this.q=parseFloat(document.getElementById("q").value),this.r_factor=parseFloat(document.getElementById("r_factor").value),this.nm=parseFloat(document.getElementById("nm").value),this.sc=parseFloat(document.getElementById("sub_cooling").value);const e=document.getElementById("system_select"),t=e&&"ideal_binary"===e.value;this.alpha=t?parseFloat(document.getElementById("alpha_value").value):null,this.validate()}validate(){return[this.xd,this.xb,this.zf,this.q,this.r_factor,this.nm,this.sc,this.alpha].some(e=>isNaN(e))?(alert("유효하지 않은 입력값이 있습니다. 숫자만 입력해주세요."),!1):null!==this.alpha&&(isNaN(this.alpha)||this.alpha<=1)?(alert("상대휘발도(α)는 1.0보다 커야 합니다."),!1):((this.xd<=this.zf||this.zf<=this.xb)&&console.warn("경고: 조성 순서가 일반적이지 않습니다 (xd > zf > xb)."),!0)}}const u=document.getElementById("system_select"),m=document.getElementById("system_for_delete_select"),y=document.getElementById("delete-vle-btn"),h=document.querySelector(".description"),p=document.getElementById("vle-input-modal"),f=document.getElementById("add-vle-row-btn"),v=document.getElementById("vle-data-list"),b=document.getElementById("save-vle-btn"),_=document.getElementById("cancel-vle-btn"),x=document.getElementById("data-management-modal"),g=document.getElementById("manage-vle-data-btn"),E=document.getElementById("close-data-management-modal-btn"),I=document.getElementById("add-new-vle-data-btn"),w=document.getElementById("alpha-container");let B=[];function L(){const e=localStorage.getItem(c);return e?JSON.parse(e):[]}async function C(){const e=await async function(){try{const e=await fetch(`${o}?select=system_id,system_name`,{method:"GET",headers:{apikey:a,Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error(e.statusText);return await e.json()}catch(e){return console.error("DB Fetch Error:",e),[]}}();if(u){const t=u.value;u.innerHTML="";const n=document.createElement("option");n.value="ideal_binary",n.textContent="Ideal Binary System (Relative Volatility α)",u.appendChild(n);const a=document.createElement("option");a.value="methanol_water",a.textContent="Methanol-Water (Default)",u.appendChild(a),e.forEach(e=>{const t=document.createElement("option");t.value=e.system_id,t.textContent=e.system_name,u.appendChild(t)}),t&&("methanol_water"===t||e.find(e=>e.system_id===t))&&(u.value=t)}!function(e){if(!m)return;m.innerHTML="";const t=L(),n=e.filter(e=>t.includes(e.system_id));if(0===n.length){const e=document.createElement("option");e.textContent="내가 만든 데이터가 없습니다.",e.disabled=!0,m.appendChild(e),y&&(y.disabled=!0)}else y&&(y.disabled=!1),n.forEach(e=>{const t=document.createElement("option");t.value=e.system_id,t.textContent=e.system_name,m.appendChild(t)})}(e)}async function M(e){const t=e.target.value;if("ideal_binary"===t)return w&&w.classList.remove("hidden"),void(h&&(h.innerHTML="<b>System:</b> Ideal Binary<br><b>Method:</b> Relative Volatility (α)"));"methanol_water"===t?(r(s),B=s,h&&(h.innerHTML="<b>System:</b> Methanol-Water<br><b>Assumptions:</b> Total Condenser, Partial Reboiler")):"user_input"===t?S():await async function(e){try{const t=await fetch(`${o}?select=system_name,vle_source,vle_points&system_id=eq.${e}`,{method:"GET",headers:{apikey:a,Authorization:`Bearer ${a}`,Accept:"application/json"}});if(!t.ok)throw new Error("Load failed");const n=await t.json();if(0===n.length)throw new Error("No data found");const l=n[0];r(l.vle_points),B=l.vle_points,h&&(h.innerHTML=`<b>System:</b> ${l.system_name}<br><b>Source:</b> ${l.vle_source}`)}catch(e){console.error(e),alert("Failed to load data. Back to default."),r(s),u&&(u.value="methanol_water")}}(t)}function S(){p&&(p.classList.remove("hidden"),function(){if(!v)return;v.innerHTML="";const e=document.createElement("div");e.className="vle-row",e.innerHTML='<label>x:</label><input type="number" value="0.0" class="vle-x" readonly><label>y:</label><input type="number" value="0.0" class="vle-y" readonly><button class="remove-vle-row" style="visibility:hidden">-</button>',v.appendChild(e);const t=document.createElement("div");t.className="vle-row",t.innerHTML='<label>x:</label><input type="number" value="1.0" class="vle-x" readonly><label>y:</label><input type="number" value="1.0" class="vle-y" readonly><button class="remove-vle-row" style="visibility:hidden">-</button>',v.appendChild(t),F()}())}function z(){p&&p.classList.add("hidden"),x&&x.classList.remove("hidden")}function F(){if(!v)return;const e=Array.from(v.querySelectorAll(".vle-row"));e.forEach((t,n)=>{const a=t.querySelector(".remove-vle-row");a&&(a.style.visibility=0===n||n===e.length-1?"hidden":"visible")})}function $(e,t){if(t<=e[0].y)return e[0].x;if(t>=e[e.length-1].y)return e[e.length-1].x;let n=0,a=e.length-1,o=e[n],l=e[a];for(;a-n>1;){let o=Math.floor((n+a)/2);e[o].y<t?n=o:a=o}o=e[n],l=e[a];const s=(l.x-o.x)/(l.y-o.y);return o.x+(t-o.y)*s}function k(e){const{xd:t,xb:n,zf:a,q:o,r_factor:l,nm:s,sc:r}=e,c={ideal_eq_curve:[],line_45:[{x:0,y:0},{x:1,y:1}],q_line:[],esol_line:[],ssol_line:[],steps:[],effective_curve:[]},d={R_min:0,R:0,stages:0,feed_stage:0,xb_actual:0},{x:u,y:m}=function(e,t,n){if(Math.abs(e-1)<1e-6)return{x:t,y:i(t,n)};if(Math.abs(e)<1e-6){const e=function(e,t){let n,a=0,o=1;for(let l=0;l<30;l++)n=(a+o)/2,i(n,t)<e?a=n:o=n;return(a+o)/2}(t,n);return{x:e,y:t}}const a=e/(e-1),o=-t/(e-1),l=e=>i(e,n)-(e=>a*e+o)(e);let s,r=0,c=1;for(let e=0;e<30;e++)s=(r+c)/2,l(s)<0?r=s:c=s;const d=(r+c)/2;return{x:d,y:i(d,n)}}(o,a,e.alpha),y=function(){const e=(e,t)=>i(e,t)-e,t=[],n=1e-6;let a=0,o=e(a);for(let l=1;l<=1e3;l++){let s=Math.min(1,.001*l),r=e(s);if(Math.abs(a)<n||Math.abs(s-1)<n)a=s,o=r;else{if(o*r<0){let o=a,l=s;for(let t=0;t<30;t++){let t=(o+l)/2;if(0===e(t)||l-o<n){o=t;break}e(t)*e(o)<0?l=t:o=t}const r=(o+l)/2;(0===t.length||Math.abs(t[t.length-1]-r)>n)&&t.push(r)}a=s,o=r}}return t}();let h=!1;const p=[];if(y.length>0){const e=Math.min(t,n),a=Math.max(t,n);y.forEach(t=>{t>e&&t<a&&(h=!0,p.push(t))})}if(h)return{plotData:{},results:{},floatStageNum:0,isAzeoError:!0,x_azeo_list:p.map(e=>e.toFixed(3)).join(", ")};const f=(t-m)/(t-u);d.R_min=f/(1-f),d.R=d.R_min*l;let v=d.R;const b=1+81.6*r/35270;v=d.R*b;const _=v/(v+1),x=t/(v+1);let g,E;Math.abs(o-1)<1e-6?(g=a,E=_*g+x):(g=(x- -a/(o-1))/(o/(o-1)-_),E=_*g+x);const I=(E-n)/(g-n),w=n-I*n;c.q_line=[{x:a,y:a},{x:u,y:m}],c.esol_line=[{x:t,y:t},{x:g,y:E}],c.ssol_line=[{x:n,y:n},{x:g,y:E}];const B=e=>_*e+x,L=e=>I*e+w;for(let t=0;t<=100;t++){const n=t/100,a=i(n,e.alpha);c.ideal_eq_curve.push({x:n,y:a});const o=B(n),l=o+s*(a-o);n>g&&c.effective_curve.push({x:n,y:l});const r=L(n),d=r+s*(a-r);n<=g&&c.effective_curve.push({x:n,y:d})}let C=t,M=t,S=0,z=0;for(;C>n&&S<200;){let e;S++;const t=M;let a;if(e=$(c.effective_curve,M),e>g?a=B(e):(a=L(e),0===d.feed_stage&&(d.feed_stage=S)),c.steps.push([{x:C,y:t},{x:e,y:t}]),c.steps.push([{x:e,y:t},{x:e,y:a}]),e<n){z=S+(C-n)/(C-e);break}C=e,M=a}return 0===d.feed_stage&&(d.feed_stage=1),d.stages=S,d.xb_actual=C,{plotData:c,results:d,floatStageNum:z,isAzeoError:h,x_azeo_array:y}}C(),u&&u.addEventListener("change",M),g&&g.addEventListener("click",()=>{C(),x.classList.remove("hidden")}),E&&E.addEventListener("click",()=>x.classList.add("hidden")),I&&I.addEventListener("click",()=>{x.classList.add("hidden"),S()}),y&&y.addEventListener("click",async function(){const e=document.getElementById("system_for_delete_select"),t=document.getElementById("delete-vle-btn"),n=document.getElementById("system_select");if(!e||!e.value)return void alert("삭제할 시스템을 선택해주세요.");const l=e.value,i=e.options[e.selectedIndex].text;if(!confirm(`[경고] 정말로 '${i}' 데이터를 삭제하시겠습니까?\n\n이 작업은 되돌릴 수 없으며, 서버에서 영구적으로 삭제됩니다.`))return;const c=t.textContent;t.textContent="삭제 중...",t.disabled=!0;try{const e=await fetch(`${o}?system_id=eq.${l}`,{method:"DELETE",headers:{apikey:a,Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error(`삭제 실패 (Status: ${e.status})`);if(function(e){const t="my_created_vle_systems";let n=localStorage.getItem(t);n=n?JSON.parse(n):[];const a=n.filter(t=>t!==e);localStorage.setItem(t,JSON.stringify(a))}(l),alert("데이터가 성공적으로 삭제되었습니다."),await C(),n&&n.value===l){alert("현재 보고 있던 데이터가 삭제되어, 기본값(Methanol-Water)으로 전환됩니다."),n.value="methanol_water",r(s);const e=document.querySelector(".description");e&&(e.innerHTML="<b>System:</b> Methanol-Water<br><b>Assumptions:</b> Total Condenser, Partial Reboiler")}}catch(e){console.error("Delete Error:",e),alert(`삭제 중 오류가 발생했습니다.\n${e.message}`)}finally{t&&(t.textContent=c,t.disabled=!1)}}),_&&_.addEventListener("click",z),b&&b.addEventListener("click",async function(){const e=v.querySelectorAll(".vle-row"),t=[];if(e.forEach(e=>{t.push({x:parseFloat(e.querySelector(".vle-x").value),y:parseFloat(e.querySelector(".vle-y").value)})}),!function(){const e=document.getElementById("comp_name_A").value,t=document.getElementById("comp_name_B").value,n=document.getElementById("vle_source_input").value;return!!(e&&t&&n)||(alert("성분명/출처 필수"),!1)}())return;t.sort((e,t)=>e.x-t.x);const n=document.getElementById("comp_name_A").value.trim(),l=document.getElementById("comp_name_B").value.trim(),s=document.getElementById("vle_source_input").value.trim(),i=`${n}-${l}`,d={vle_type:"Distillation",vle_component_num:2,system_name:i,component_a:n,component_b:l,vle_points:t,vle_source:s};try{const e=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",apikey:a,Authorization:`Bearer ${a}`,Prefer:"return=representation"},body:JSON.stringify(d)});if(!e.ok)throw new Error("DB Save Failed");const n=(await e.json())[0].system_id;!function(e){const t=L();t.includes(e)||(t.push(e),localStorage.setItem(c,JSON.stringify(t)))}(n),B=t,r(B),z(),alert(`저장 완료! '${i}' 시스템이 DB에 등록되었습니다.`),await C(),u&&(u.value=n,M({target:u}))}catch(e){console.error(e),alert("저장 중 오류가 발생했습니다: "+e.message)}}),f&&f.addEventListener("click",()=>function(e=.5,t=.5){if(!v)return;const n=document.createElement("div");n.className="vle-row",n.innerHTML=`\n        <label>x:</label><input type="number" step="any" min="0" max="1" value="${e}" class="vle-x" required>\n        <label>y:</label><input type="number" step="any" min="0" max="1" value="${t}" class="vle-y" required>\n        <button type="button" class="remove-vle-row">-</button>\n    `;const a=v.querySelectorAll(".vle-row"),o=a.length>0?a[a.length-1]:null;o?v.insertBefore(n,o):v.appendChild(n),F()}()),v&&v.addEventListener("click",e=>{e.target.classList.contains("remove-vle-row")&&(e.target.closest(".vle-row").remove(),F())});var q=n(106);let N=null;const R=document.getElementById("calc-form"),T=document.getElementById("mccabeThieleChart"),A=document.getElementById("results-text"),D=T.getContext("2d");function O(){try{const e=new d,{plotData:t,results:n,floatStageNum:a,isAzeoError:o,x_azeo_array:l}=k(e);if(o){const t=`Azeotrope Error: Desired distillate composition (xd = ${e.xd.toFixed(3)}) exceeds the azeotropic point (x_azeo = ${l}). Separation to this purity is physically impossible.`;return alert(t),A.textContent=`Calculation Error:\n${t}`,void(N&&N.destroy())}!function(e,t){document.getElementById("results_Rmin").textContent=e.R_min.toFixed(3),document.getElementById("results_Rreal").textContent=e.R.toFixed(3),document.getElementById("results_Rfactor").textContent=document.getElementById("r_factor").value,document.getElementById("results_Nstage").textContent=e.stages,document.getElementById("results_Nstage_float").textContent=t.toFixed(1),document.getElementById("results_Fstage").textContent=e.feed_stage}(n,a),function(e){const t=[{label:"Ideal Equilibrium (VLE)",data:e.ideal_eq_curve,borderColor:"blue",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"Effective Eq. (Rectifying)",data:e.effective_curve,borderColor:"#00c000",borderDash:[5,5],borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"y = x",data:e.line_45,borderColor:"grey",borderWidth:1,pointRadius:0,showLine:!0,type:"line"},{label:"q-Line",data:e.q_line,borderColor:"orange",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"ESOL",data:e.esol_line,borderColor:"#6a5acd",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"SSOL",data:e.ssol_line,borderColor:"#6a5acd",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},...e.steps.map(e=>({type:"line",data:e,borderColor:"#FF6384",borderWidth:1.5,pointRadius:0,fill:!1,showLine:!0,showInLegend:!1}))];N&&N.destroy(),N=new q.t1(D,{type:"scatter",data:{datasets:t},options:{plugins:{title:{display:!0,text:"McCabe-Thiele Plot (Methanol-Water @ 1 atm)",font:{size:18}},legend:{position:"bottom",labels:{filter:e=>!!e.text}},tooltip:{callbacks:{label:e=>{const t=e.raw;return`${e.dataset.label}: (x: ${t.x.toFixed(3)}, y: ${t.y.toFixed(3)})`}}}},scales:{x:{type:"linear",position:"bottom",title:{display:!0,text:"Liquid Mole Fraction (x)"},min:0,max:1},y:{type:"linear",title:{display:!0,text:"Vapor Mole Fraction (y)"},min:0,max:1}},aspectRatio:1,animation:!1,parsing:!1}})}(t)}catch(e){console.error("McCabe-Thiele 계산 중 오류 발생:",e),alert(`계산에 실패했습니다: ${e.message}\n콘솔(F12)에서 자세한 내용을 확인하세요.`),A.textContent=`계산 오류:\n${e.message}`}}q.t1.register(q.kc,q.FN,q.No,q.ZT,q.dN,q.m_,q.s$,q.hE,q.Pz),R.addEventListener("submit",e=>{e.preventDefault(),O()}),document.addEventListener("DOMContentLoaded",()=>{console.log("페이지 로드 완료. 기본값으로 첫 계산을 실행합니다."),O()})}},e=>{e.O(0,[106],()=>e(e.s=940)),e.O()}]);
//# sourceMappingURL=main.0a9590c7301bf15e9613.js.map
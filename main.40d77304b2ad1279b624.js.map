{"version":3,"file":"main.40d77304b2ad1279b624.js","mappings":"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","sources":["webpack://mccabe-thiele-method-online/./src/resources/js/supadata_channel/supadata_config.js","webpack://mccabe-thiele-method-online/./src/resources/js/eq_line.js","webpack://mccabe-thiele-method-online/./src/resources/js/ui.js","webpack://mccabe-thiele-method-online/./src/resources/js/mccabe-thiele.js","webpack://mccabe-thiele-method-online/./src/resources/js/main.js"],"sourcesContent":["export { SUPABASE_SYSTEMS_ENDPOINT, SUPABASE_ANON_KEY, SUPABASE_URL}\r\n\r\nconst SUPABASE_URL = 'https://pslozmvfdrppmmvsnpff.supabase.co'; // 예: https://abcdefg12345.supabase.co\r\nconst SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBzbG96bXZmZHJwcG1tdnNucGZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NzQ1NzIsImV4cCI6MjA4MDA1MDU3Mn0.4gL96sI9vhEwgpPXFdY_c80msecst08vJYPv6PNzgO0'; // 예: eyJhbGciOiJIUzI1NiI...\r\nconst SUPABASE_SYSTEMS_ENDPOINT = `${SUPABASE_URL}/rest/v1/systems`;","/**\r\n * @typedef {{x: number, y: number}} VLEPoint\r\n */\r\n\r\n// VLE 데이터는 모듈 내부 변수에 저장되며, 외부에서 주입 가능\r\n/** @type {VLEPoint[]} */\r\nlet VLE_DATA = [];\r\n\r\n// [TODO] Methanol-Water 기본 데이터 (초기값으로 사용)\r\nexport const METHANOL_VLE_DATA = [\r\n  { x: 0.0, y: 0.0 },\r\n  { x: 0.012, y: 0.068 },\r\n  { x: 0.02, y: 0.121 },\r\n  { x: 0.026, y: 0.159 },\r\n  { x: 0.033, y: 0.188 },\r\n  { x: 0.036, y: 0.215 },\r\n  { x: 0.053, y: 0.275 },\r\n  { x: 0.076, y: 0.366 },\r\n  { x: 0.1, y: 0.438 },\r\n  { x: 0.12, y: 0.485 },\r\n  { x: 0.14, y: 0.522 },\r\n  { x: 0.15, y: 0.541 },\r\n  { x: 0.2, y: 0.605 },\r\n  { x: 0.3, y: 0.686 },\r\n  { x: 0.4, y: 0.739 },\r\n  { x: 0.5, y: 0.779 },\r\n  { x: 0.6, y: 0.825 },\r\n  { x: 0.7, y: 0.87 },\r\n  { x: 0.8, y: 0.915 },\r\n  { x: 0.9, y: 0.958 },\r\n  { x: 0.95, y: 0.979 },\r\n  { x: 1.0, y: 1.0 },\r\n];\r\n\r\n// 모듈 로드 시 기본 데이터로 초기화\r\ninitializeVLEData(METHANOL_VLE_DATA);\r\n\r\n\r\n/**\r\n * 외부에서 VLE 데이터를 주입하여 모듈을 초기화합니다.\r\n * @param {VLEPoint[]} newVLEData - 정렬된 VLE 포인트 배열\r\n */\r\nexport function initializeVLEData(newVLEData) {\r\n    if (!Array.isArray(newVLEData) || newVLEData.length < 2) {\r\n        console.error(\"VLE Data initialization failed: Data must be an array with at least 2 points.\");\r\n        VLE_DATA = METHANOL_VLE_DATA; // 오류 시 기본값 유지\r\n        return;\r\n    }\r\n    // [핵심] 외부 데이터를 내부 변수에 저장\r\n    VLE_DATA = newVLEData;\r\n    console.log(`VLE Data initialized with ${VLE_DATA.length} points.`);\r\n}\r\n\r\n\r\n/**\r\n * 액상 조성(x_in)에 대한 이상 평형 기상 조성(y)을 계산합니다.\r\n * 선형 보간(Linear Interpolation)을 사용합니다.\r\n * @param {number} x_in - 액상 몰분율\r\n * @returns {number} - 기상 몰분율 (y)\r\n */\r\nexport function getIdealEquilibriumY(x_in) {\r\n  if (x_in <= 0) return 0;\r\n  if (x_in >= 1) return 1;\r\n\r\n  // [핵심] 내부 변수 VLE_DATA 사용\r\n  let p1 = VLE_DATA[0];\r\n  let p2 = VLE_DATA[1];\r\n\r\n  for (let i = 1; i < VLE_DATA.length; i++) {\r\n    if (VLE_DATA[i].x >= x_in) {\r\n      p1 = VLE_DATA[i - 1];\r\n      p2 = VLE_DATA[i];\r\n      break;\r\n    }\r\n  }\r\n\r\n  const slope = (p2.y - p1.y) / (p2.x - p1.x);\r\n  const y_out = p1.y + (x_in - p1.x) * slope;\r\n\r\n  return y_out;\r\n}","/**\r\n * ui.js\r\n * Supabase를 메인 DB로 사용하고, \r\n * LocalStorage를 이용해 '내가 만든 데이터'의 ID를 추적하여 삭제 권한을 관리합니다.\r\n */\r\n\r\nimport { SUPABASE_SYSTEMS_ENDPOINT, SUPABASE_ANON_KEY } from \"./supadata_channel/supadata_config.js\"; // 확장자 주의\r\nimport { initializeVLEData, METHANOL_VLE_DATA } from \"./eq_line.js\";\r\n\r\n// 내가 만든 시스템의 ID들을 저장할 로컬 스토리지 키\r\nconst MY_SYSTEMS_KEY = \"my_created_vle_systems\";\r\n\r\nexport class Variable {\r\n  xd; xb; zf; q; r_factor; nm; sc;\r\n\r\n  constructor() {\r\n    //@ts-ignore\r\n    this.xd = parseFloat(document.getElementById(\"xd\").value);\r\n    //@ts-ignore\r\n    this.xb = parseFloat(document.getElementById(\"xb\").value);\r\n    //@ts-ignore\r\n    this.zf = parseFloat(document.getElementById(\"zf\").value);\r\n    //@ts-ignore\r\n    this.q = parseFloat(document.getElementById(\"q\").value);\r\n    //@ts-ignore\r\n    this.r_factor = parseFloat(document.getElementById(\"r_factor\").value);\r\n    //@ts-ignore\r\n    this.nm = parseFloat(document.getElementById(\"nm\").value);\r\n    //@ts-ignore\r\n    this.sc = parseFloat(document.getElementById(\"sub_cooling\").value);\r\n    this.validate();\r\n  }\r\n\r\n  validate() {\r\n    const allValues = [this.xd, this.xb, this.zf, this.q, this.r_factor, this.nm, this.sc];\r\n    if (allValues.some((val) => isNaN(val))) {\r\n      alert(\"유효하지 않은 입력값이 있습니다. 숫자만 입력해주세요.\");\r\n      return false;\r\n    }\r\n    if (this.xd <= this.zf || this.zf <= this.xb) {\r\n      console.warn(\"경고: 조성 순서가 일반적이지 않습니다 (xd > zf > xb).\");\r\n    }\r\n    return true;\r\n  }\r\n}\r\n\r\n// --- DOM Elements ---\r\nconst systemSelect = document.getElementById('system_select');\r\nconst systemDeleteSelect = document.getElementById('system_for_delete_select');\r\nconst deleteVleBtn = document.getElementById('delete-vle-btn'); \r\nconst systemDescription = document.querySelector('.description');\r\n\r\nconst vleInputModal = document.getElementById('vle-input-modal');\r\nconst addVleRowBtn = document.getElementById('add-vle-row-btn');\r\nconst vleDataList = document.getElementById('vle-data-list');\r\nconst saveVleBtn = document.getElementById('save-vle-btn');\r\nconst cancelVleBtn = document.getElementById('cancel-vle-btn');\r\nconst dataManagementModal = document.getElementById('data-management-modal');\r\nconst manageDataBtn = document.getElementById('manage-vle-data-btn');\r\nconst closeManageBtn = document.getElementById('close-data-management-modal-btn');\r\nconst addNewVleDataBtn = document.getElementById('add-new-vle-data-btn');\r\n\r\nlet customVLEData = []; \r\n\r\n// --- Initialization ---\r\nexport function setUpUIListeners() {\r\n    fetchAndPopulateSystems();\r\n    if (systemSelect) {\r\n      systemSelect.addEventListener('change', handleSystemChange);\r\n    }\r\n    if (manageDataBtn) {\r\n        manageDataBtn.addEventListener('click', () => {\r\n             fetchAndPopulateSystems();\r\n             dataManagementModal.classList.remove('hidden');\r\n        });\r\n    }\r\n    if (closeManageBtn) {\r\n      closeManageBtn.addEventListener('click', () => dataManagementModal.classList.add('hidden'));\r\n    }\r\n    // 4. 새 데이터 추가 버튼\r\n    if (addNewVleDataBtn) {\r\n        addNewVleDataBtn.addEventListener('click', () => {\r\n            dataManagementModal.classList.add('hidden');\r\n            showVLEModal();\r\n        });\r\n    }\r\n\r\n    // 5. 삭제 버튼\r\n    if (deleteVleBtn) {\r\n        deleteVleBtn.addEventListener('click', handleDeleteSystem);\r\n    }\r\n\r\n    setUpVLEModalManagement();\r\n    setUpDynamicVLEInput();\r\n}\r\n\r\n// --- LocalStorage Helpers (Ownership Tracking) ---\r\nfunction getMySystemIds() {\r\n    const stored = localStorage.getItem(MY_SYSTEMS_KEY);\r\n    return stored ? JSON.parse(stored) : [];\r\n}\r\n\r\nfunction addMySystemId(id) {\r\n    const ids = getMySystemIds();\r\n    if (!ids.includes(id)) {\r\n        ids.push(id);\r\n        localStorage.setItem(MY_SYSTEMS_KEY, JSON.stringify(ids));\r\n    }\r\n}\r\n\r\n// --- Supabase Interaction ---\r\n\r\nasync function fetchSystemsFromDB() {\r\n    try {\r\n        const response = await fetch(`${SUPABASE_SYSTEMS_ENDPOINT}?select=system_id,system_name`, {\r\n            method: 'GET',\r\n            headers: {\r\n                'apikey': SUPABASE_ANON_KEY,\r\n                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\r\n            }\r\n        });\r\n        if (!response.ok) throw new Error(response.statusText);\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error(\"DB Fetch Error:\", error);\r\n        return [];\r\n    }\r\n}\r\n\r\nasync function fetchAndPopulateSystems() {\r\n    const systems = await fetchSystemsFromDB();\r\n    \r\n    // 1. 메인 선택 드롭다운 (모든 시스템 표시)\r\n    if (systemSelect) {\r\n        //@ts-ignore\r\n        const currentVal = systemSelect.value;\r\n        systemSelect.innerHTML = '';\r\n        \r\n        // 기본값\r\n        const defaultOpt = document.createElement('option');\r\n        defaultOpt.value = 'methanol_water';\r\n        defaultOpt.textContent = 'Methanol-Water (Default)';\r\n        systemSelect.appendChild(defaultOpt);\r\n\r\n        systems.forEach(sys => {\r\n            const opt = document.createElement('option');\r\n            opt.value = sys.system_id;\r\n            opt.textContent = sys.system_name;\r\n            systemSelect.appendChild(opt);\r\n        });\r\n        \r\n        // 이전에 선택된 값이 있으면 유지\r\n        if (currentVal && (currentVal === 'methanol_water' || systems.find(s => s.system_id === currentVal))) {\r\n          //@ts-ignore\r\n          systemSelect.value = currentVal;\r\n        }\r\n    }\r\n\r\n    // 2. 삭제용 드롭다운 (내가 만든 시스템만 표시)\r\n    updateDeleteDropdown(systems);\r\n}\r\n\r\n/**\r\n * Supabase에서 가져온 전체 목록 중, LocalStorage에 ID가 있는 것만 필터링하여 삭제 목록 생성\r\n */\r\nfunction updateDeleteDropdown(allSystems) {\r\n    if (!systemDeleteSelect) return;\r\n    \r\n    systemDeleteSelect.innerHTML = '';\r\n    const myIds = getMySystemIds();\r\n    \r\n    // 내 ID와 일치하는 시스템만 필터링\r\n    const mySystems = allSystems.filter(sys => myIds.includes(sys.system_id));\r\n\r\n    if (mySystems.length === 0) {\r\n        const opt = document.createElement('option');\r\n        opt.textContent = \"내가 만든 데이터가 없습니다.\";\r\n        opt.disabled = true;\r\n        systemDeleteSelect.appendChild(opt);\r\n        //@ts-ignore\r\n        if(deleteVleBtn) deleteVleBtn.disabled = true; // 삭제 버튼 비활성화\r\n    } else {\r\n        //@ts-ignore\r\n        if(deleteVleBtn) deleteVleBtn.disabled = false; // 삭제 버튼 활성화\r\n        mySystems.forEach(sys => {\r\n            const opt = document.createElement('option');\r\n            opt.value = sys.system_id;\r\n            opt.textContent = sys.system_name;\r\n            systemDeleteSelect.appendChild(opt);\r\n        });\r\n    }\r\n}\r\n\r\n// --- System Selection & Loading ---\r\n\r\nasync function handleSystemChange(event) {\r\n    const selectedValue = event.target.value;\r\n    \r\n    if (selectedValue === 'methanol_water') {\r\n        initializeVLEData(METHANOL_VLE_DATA);\r\n        customVLEData = METHANOL_VLE_DATA;\r\n        if(systemDescription) systemDescription.innerHTML = `<b>System:</b> Methanol-Water<br><b>Assumptions:</b> Total Condenser, Partial Reboiler`;\r\n    } else if (selectedValue === 'user_input') {\r\n        // (구현상 옵션에 없더라도 방어 로직)\r\n        showVLEModal();\r\n    } else {\r\n        await loadVLEDataBySystemId(selectedValue);\r\n    }\r\n}\r\n\r\nasync function loadVLEDataBySystemId(systemId) {\r\n    try {\r\n        const response = await fetch(`${SUPABASE_SYSTEMS_ENDPOINT}?select=system_name,vle_source,vle_points&system_id=eq.${systemId}`, {\r\n            method: 'GET',\r\n            headers: {\r\n                'apikey': SUPABASE_ANON_KEY,\r\n                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\r\n                'Accept': 'application/json'\r\n            }\r\n        });\r\n        \r\n        if (!response.ok) throw new Error('Load failed');\r\n        const data = await response.json();\r\n        if (data.length === 0) throw new Error('No data found');\r\n\r\n        const system = data[0];\r\n        initializeVLEData(system.vle_points);\r\n        customVLEData = system.vle_points;\r\n\r\n        if (systemDescription) {\r\n            systemDescription.innerHTML = `<b>System:</b> ${system.system_name}<br><b>Source:</b> ${system.vle_source}`;\r\n        }\r\n    } catch (e) {\r\n        console.error(e);\r\n        alert(\"데이터 로드 실패. 기본값으로 복귀합니다.\");\r\n        initializeVLEData(METHANOL_VLE_DATA);\r\n        //@ts-ignore\r\n        if (systemSelect) systemSelect.value = 'methanol_water';\r\n    }\r\n}\r\n\r\n// --- VLE Data Saving & Deleting ---\r\n\r\nasync function handleVLEDataSave() {\r\n    // 1. 데이터 추출 및 검증 (기존 로직과 동일, 요약)\r\n    const rows = vleDataList.querySelectorAll('.vle-row');\r\n    const data = [];\r\n    rows.forEach(row => {\r\n        //@ts-ignore\r\n        data.push({ x: parseFloat(row.querySelector('.vle-x').value), y: parseFloat(row.querySelector('.vle-y').value) });\r\n    });\r\n    \r\n    if (!validateVLEData(data)) return;\r\n    data.sort((a, b) => a.x - b.x);\r\n\r\n    // 2. Payload 생성\r\n    //@ts-ignore\r\n    const compA = document.getElementById('comp_name_A').value.trim();\r\n    //@ts-ignore\r\n    const compB = document.getElementById('comp_name_B').value.trim();\r\n    //@ts-ignore\r\n    const source = document.getElementById('vle_source_input').value.trim();\r\n    const systemName = `${compA}-${compB}`;\r\n\r\n    const dbPayload = {\r\n        vle_type: 'Distillation',\r\n        vle_component_num: 2,\r\n        system_name: systemName,\r\n        component_a: compA,\r\n        component_b: compB,\r\n        vle_points: data,\r\n        vle_source: source\r\n    };\r\n\r\n    // 3. Supabase 전송\r\n    try {\r\n        const response = await fetch(SUPABASE_SYSTEMS_ENDPOINT, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'apikey': SUPABASE_ANON_KEY,\r\n                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\r\n                'Prefer': 'return=representation' // 생성된 데이터를 반환받음 (ID 포함)\r\n            },\r\n            body: JSON.stringify(dbPayload)\r\n        });\r\n\r\n        if (!response.ok) throw new Error(\"DB Save Failed\");\r\n        \r\n        const savedRecords = await response.json();\r\n        const savedSystemId = savedRecords[0].system_id; // DB에서 생성된 ID\r\n\r\n        // [핵심] 4. LocalStorage에 내 데이터로 등록\r\n        addMySystemId(savedSystemId);\r\n\r\n        // 5. 후처리\r\n        customVLEData = data;\r\n        initializeVLEData(customVLEData);\r\n        hideVLEModal();\r\n        alert(`저장 완료! '${systemName}' 시스템이 DB에 등록되었습니다.`);\r\n        \r\n        // 목록 갱신 및 자동 선택\r\n        await fetchAndPopulateSystems();\r\n        if (systemSelect) {\r\n            //@ts-ignore\r\n            systemSelect.value = savedSystemId;\r\n            handleSystemChange({ target: systemSelect });\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error(error);\r\n        alert(\"저장 중 오류가 발생했습니다: \" + error.message);\r\n    }\r\n}\r\n\r\n// --- Validation & Helper (기존 유지) ---\r\n\r\nfunction validateVLEData(data) {\r\n    // (이전 코드와 동일하므로 생략 가능하나, 완전성을 위해 간단히 포함)\r\n    //@ts-ignore\r\n    const compA = document.getElementById('comp_name_A').value;\r\n    //@ts-ignore\r\n    const compB = document.getElementById('comp_name_B').value;\r\n    //@ts-ignore\r\n    const src = document.getElementById('vle_source_input').value;\r\n    if(!compA || !compB || !src) { alert(\"성분명/출처 필수\"); return false; }\r\n    // ... 나머지 검증 로직 ...\r\n    return true;\r\n}\r\n\r\nfunction showVLEModal() {\r\n    if (vleInputModal) {\r\n        vleInputModal.classList.remove('hidden');\r\n        clearVLERows();\r\n    }\r\n}\r\n\r\nfunction hideVLEModal() {\r\n    if (vleInputModal) vleInputModal.classList.add('hidden');\r\n    if (dataManagementModal) dataManagementModal.classList.remove('hidden');\r\n}\r\n\r\nfunction setUpVLEModalManagement() {\r\n    if (cancelVleBtn) cancelVleBtn.addEventListener('click', hideVLEModal);\r\n    if (saveVleBtn) saveVleBtn.addEventListener('click', handleVLEDataSave);\r\n}\r\n\r\nfunction setUpDynamicVLEInput() {\r\n    if (addVleRowBtn) addVleRowBtn.addEventListener('click', () => addVLEDataRow());\r\n    if (vleDataList) {\r\n        vleDataList.addEventListener('click', (e) => {\r\n            //@ts-ignore\r\n            if (e.target.classList.contains('remove-vle-row')) {\r\n                //@ts-ignore\r\n                e.target.closest('.vle-row').remove();\r\n                updateRemoveButtonVisibility();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n// (addVLEDataRow, clearVLERows, updateRemoveButtonVisibility, getCustomVLEData 등은 이전과 동일하게 유지)\r\n// 코드가 너무 길어지면 잘릴 수 있으니, 필요하면 이 부분도 다시 적어주겠네.\r\n// 핵심 로직은 위 handleVLEDataSave와 handleDeleteSystem, updateDeleteDropdown일세.\r\nfunction addVLEDataRow(x=0.5, y=0.5) {\r\n     if (!vleDataList) return;\r\n    const row = document.createElement('div');\r\n    row.className = 'vle-row';\r\n    row.innerHTML = `\r\n        <label>x:</label><input type=\"number\" step=\"any\" min=\"0\" max=\"1\" value=\"${x}\" class=\"vle-x\" required>\r\n        <label>y:</label><input type=\"number\" step=\"any\" min=\"0\" max=\"1\" value=\"${y}\" class=\"vle-y\" required>\r\n        <button type=\"button\" class=\"remove-vle-row\">-</button>\r\n    `;\r\n    const rows = vleDataList.querySelectorAll('.vle-row');\r\n    const lastRow = rows.length > 0 ? rows[rows.length - 1] : null;\r\n    if (lastRow) vleDataList.insertBefore(row, lastRow);\r\n    else vleDataList.appendChild(row);\r\n    updateRemoveButtonVisibility();\r\n}\r\n\r\nfunction clearVLERows() {\r\n    if (!vleDataList) return;\r\n    vleDataList.innerHTML = '';\r\n    // 0,0 및 1,1 추가 로직 (기존 동일)\r\n    const firstRow = document.createElement('div'); firstRow.className = 'vle-row';\r\n    firstRow.innerHTML = `<label>x:</label><input type=\"number\" value=\"0.0\" class=\"vle-x\" readonly><label>y:</label><input type=\"number\" value=\"0.0\" class=\"vle-y\" readonly><button class=\"remove-vle-row\" style=\"visibility:hidden\">-</button>`;\r\n    vleDataList.appendChild(firstRow);\r\n    const lastRow = document.createElement('div'); lastRow.className = 'vle-row';\r\n    lastRow.innerHTML = `<label>x:</label><input type=\"number\" value=\"1.0\" class=\"vle-x\" readonly><label>y:</label><input type=\"number\" value=\"1.0\" class=\"vle-y\" readonly><button class=\"remove-vle-row\" style=\"visibility:hidden\">-</button>`;\r\n    vleDataList.appendChild(lastRow);\r\n    updateRemoveButtonVisibility();\r\n}\r\n\r\nfunction updateRemoveButtonVisibility() {\r\n    // 기존 로직 유지\r\n     if (!vleDataList) return;\r\n    const rows = Array.from(vleDataList.querySelectorAll('.vle-row'));\r\n    rows.forEach((row, index) => {\r\n        const btn = row.querySelector('.remove-vle-row');\r\n        if (btn) {\r\n            //@ts-ignore\r\n            btn.style.visibility = (index === 0 || index === rows.length - 1) ? 'hidden' : 'visible';\r\n        }\r\n    });\r\n}\r\n\r\nfunction removeMySystemId(id) {\r\n    const MY_SYSTEMS_KEY = \"my_created_vle_systems\"; // 상단에 정의된 키와 동일해야 함\r\n    let ids = localStorage.getItem(MY_SYSTEMS_KEY);\r\n    ids = ids ? JSON.parse(ids) : [];\r\n    \r\n    // 삭제할 ID만 빼고 다시 저장\r\n    //@ts-ignore\r\n    const newIds = ids.filter(savedId => savedId !== id);\r\n    localStorage.setItem(MY_SYSTEMS_KEY, JSON.stringify(newIds));\r\n}\r\n\r\n/**\r\n * 선택한 VLE 데이터를 삭제하는 함수\r\n * 1. 사용자가 선택한 옵션 확인\r\n * 2. Supabase에 DELETE 요청\r\n * 3. 성공 시 LocalStorage 소유권 목록에서 제거\r\n * 4. UI(드롭다운) 갱신 및 현재 선택된 데이터가 삭제된 경우 초기화\r\n */\r\nasync function handleDeleteSystem() {\r\n    const deleteSelect = document.getElementById('system_for_delete_select');\r\n    const deleteBtn = document.getElementById('delete-vle-btn');\r\n    const mainSystemSelect = document.getElementById('system_select');\r\n\r\n    // 1. 유효성 검사\r\n    //@ts-ignore\r\n    if (!deleteSelect || !deleteSelect.value) {\r\n        alert(\"삭제할 시스템을 선택해주세요.\");\r\n        return;\r\n    }\r\n    //@ts-ignore\r\n    const idToDelete = deleteSelect.value;\r\n    //@ts-ignore\r\n    const selectedOptionText = deleteSelect.options[deleteSelect.selectedIndex].text;\r\n\r\n    // 2. 사용자 확인 (실수 방지)\r\n    const isConfirmed = confirm(\r\n        `[경고] 정말로 '${selectedOptionText}' 데이터를 삭제하시겠습니까?\\n\\n` +\r\n        `이 작업은 되돌릴 수 없으며, 서버에서 영구적으로 삭제됩니다.`\r\n    );\r\n\r\n    if (!isConfirmed) return;\r\n\r\n    // 버튼 중복 클릭 방지 (로딩 중 표시)\r\n    const originalBtnText = deleteBtn.textContent;\r\n    deleteBtn.textContent = \"삭제 중...\";\r\n    //@ts-ignore\r\n    deleteBtn.disabled = true;\r\n\r\n    try {\r\n        // 3. Supabase DELETE 요청\r\n        const response = await fetch(`${SUPABASE_SYSTEMS_ENDPOINT}?system_id=eq.${idToDelete}`, {\r\n            method: 'DELETE',\r\n            headers: {\r\n                'apikey': SUPABASE_ANON_KEY,\r\n                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`\r\n            }\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`삭제 실패 (Status: ${response.status})`);\r\n        }\r\n\r\n        // 4. 성공 시 LocalStorage 업데이트 (소유권 포기)\r\n        removeMySystemId(idToDelete);\r\n\r\n        alert(\"데이터가 성공적으로 삭제되었습니다.\");\r\n\r\n        // 5. UI 목록 갱신 (전체 목록 다시 불러오기)\r\n        await fetchAndPopulateSystems(); \r\n\r\n        // 6. 만약 방금 삭제한 데이터를 현재 메인 화면에서 보고 있었다면? -> 기본값으로 리셋\r\n        //@ts-ignore\r\n        if (mainSystemSelect && mainSystemSelect.value === idToDelete) {\r\n            alert(\"현재 보고 있던 데이터가 삭제되어, 기본값(Methanol-Water)으로 전환됩니다.\");\r\n            //@ts-ignore\r\n            mainSystemSelect.value = 'methanol_water';\r\n            // 기본값 로드 함수 호출 (eq_line.js의 함수)\r\n            initializeVLEData(METHANOL_VLE_DATA); \r\n            // 설명창 업데이트 (필요 시)\r\n            const desc = document.querySelector('.description');\r\n            if(desc) desc.innerHTML = `<b>System:</b> Methanol-Water<br><b>Assumptions:</b> Total Condenser, Partial Reboiler`;\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error(\"Delete Error:\", error);\r\n        alert(`삭제 중 오류가 발생했습니다.\\n${error.message}`);\r\n    } finally {\r\n        // 버튼 상태 복구\r\n        if (deleteBtn) {\r\n            deleteBtn.textContent = originalBtnText;\r\n            //@ts-ignore\r\n            deleteBtn.disabled = false;\r\n        }\r\n    }\r\n}\r\n\r\nexport function getCustomVLEData() { return customVLEData; }\r\n\r\n// Initial Call\r\nsetUpUIListeners();","/**\r\n * mccabe-thiele.js\r\n * Main logic for McCabe-Thiele\r\n * Use equilibrium line from 'eq_line.js'\r\n * Murphree efficiency is calculated between actual equilibrium line and operating line\r\n * (y_effective = y_op + nm * (y_ideal - y_op))\r\n * Seperated operating line into rectifying section and stripping section.\r\n */\r\n\r\nimport { getIdealEquilibriumY } from \"./eq_line.js\";\r\nimport { Variable } from \"./ui.js\";\r\n\r\n/**\r\n * VLE 곡선과 y=x 선(45도선)의 교차점 (공비점)을 모두 찾아 반환합니다.\r\n * @returns {number[]} - 공비점 x-조성 배열. 공비점이 없으면 빈 배열을 반환합니다.\r\n */\r\nfunction findAzeotropeX() {\r\n    const f = (x) => getIdealEquilibriumY(x) - x;\r\n    const azeotropes = [];\r\n    \r\n    // [설정] 스캔할 간격의 수 (정밀도와 성능의 타협점, 1000개로 설정)\r\n    const NUM_SEGMENTS = 1000; \r\n    const step = 1.0 / NUM_SEGMENTS;\r\n    const tolerance = 1e-6; // 부동 소수점 오차 허용 범위\r\n\r\n    let x1 = 0.0;\r\n    let y1 = f(x1); // f(0) = 0.0 (항상 0임)\r\n\r\n    for (let i = 1; i <= NUM_SEGMENTS; i++) {\r\n        let x2 = Math.min(1.0, i * step); // 1.0을 넘지 않도록 보장\r\n        let y2 = f(x2);\r\n\r\n        // 1. [경계값 검사] (x=0 또는 x=1)에서는 공비점이 없다고 가정하고 넘어감\r\n        if (Math.abs(x1) < tolerance || Math.abs(x2 - 1.0) < tolerance) {\r\n             x1 = x2;\r\n             y1 = y2;\r\n             continue;\r\n        }\r\n\r\n        // 2. [부호 변화 검사] y1과 y2의 부호가 다른지 확인 (45도선 통과)\r\n        if (y1 * y2 < 0) {\r\n            // 부호가 바뀌었으므로, 이 구간 [x1, x2] 안에 공비점이 존재\r\n            \r\n            // [이분법 재활용] 이 구간에서 정밀한 교차점을 찾음 (30회)\r\n            let low = x1;\r\n            let high = x2;\r\n            for (let j = 0; j < 30; j++) {\r\n                let mid_x = (low + high) / 2;\r\n                if (f(mid_x) === 0 || high - low < tolerance) {\r\n                    low = mid_x; // mid_x로 수렴\r\n                    break;\r\n                }\r\n                if (f(mid_x) * f(low) < 0) {\r\n                    high = mid_x;\r\n                } else {\r\n                    low = mid_x;\r\n                }\r\n            }\r\n            const x_azeo = (low + high) / 2;\r\n\r\n            // 중복 방지 및 배열에 추가\r\n            if (azeotropes.length === 0 || Math.abs(azeotropes[azeotropes.length - 1] - x_azeo) > tolerance) {\r\n                 azeotropes.push(x_azeo);\r\n            }\r\n        }\r\n        \r\n        // 3. 다음 루프를 위해 값 갱신\r\n        x1 = x2;\r\n        y1 = y2;\r\n    }\r\n\r\n    return azeotropes; // 공비점 배열 반환\r\n}\r\n\r\n/**\r\n * Return x' when q = 0 (수평선)\r\n * (q-line 플로팅 및 R_min 계산에 사용됨)\r\n */\r\nfunction ideal_eq2(y_target) {\r\n  let low = 0.0;\r\n  let high = 1.0;\r\n  let mid_xa;\r\n  for (let i = 0; i < 30; i++) {\r\n    mid_xa = (low + high) / 2;\r\n    const y_guess = getIdealEquilibriumY(mid_xa);\r\n    if (y_guess < y_target) {\r\n      low = mid_xa;\r\n    } else {\r\n      high = mid_xa;\r\n    }\r\n  }\r\n  return (low + high) / 2;\r\n}\r\n\r\n/**\r\n * q-line actual equilibrium line의 교차점을 찾기 (q-line 플로팅 및 R_min 계산용).\r\n */\r\nfunction find_q_ideal_eq_intersect(q, zf) {\r\n  if (Math.abs(q - 1.0) < 1e-6) {\r\n    // q = 1 (수직선)\r\n    const x_intersect = zf;\r\n    const y_intersect = getIdealEquilibriumY(zf);\r\n    return { x: x_intersect, y: y_intersect };\r\n  }\r\n  if (Math.abs(q) < 1e-6) {\r\n    // q = 0 (수평선)\r\n    const x_intersect = ideal_eq2(zf);\r\n    const y_intersect = zf;\r\n    return { x: x_intersect, y: y_intersect };\r\n  }\r\n\r\n  const q_slope = q / (q - 1);\r\n  const q_intercept = -zf / (q - 1);\r\n  const q_line = (x) => q_slope * x + q_intercept;\r\n  const f = (x) => getIdealEquilibriumY(x) - q_line(x);\r\n\r\n  let low = 0.0,\r\n    high = 1.0,\r\n    mid_x;\r\n  for (let i = 0; i < 30; i++) {\r\n    mid_x = (low + high) / 2;\r\n    if (f(mid_x) < 0) {\r\n      low = mid_x;\r\n    } else {\r\n      high = mid_x;\r\n    }\r\n  }\r\n  const x_intersect = (low + high) / 2;\r\n  const y_intersect = getIdealEquilibriumY(x_intersect);\r\n\r\n  return { x: x_intersect, y: y_intersect };\r\n}\r\n\r\n/**\r\n * @param {array} dataArray\r\n * @param {number} y_target\r\n * @returns {number}\r\n */\r\nfunction find_x_from_data(dataArray, y_target) {\r\n  // Is target end of data?\r\n  if (y_target <= dataArray[0].y) return dataArray[0].x;\r\n  if (y_target >= dataArray[dataArray.length - 1].y)\r\n    return dataArray[dataArray.length - 1].x;\r\n\r\n  let low = 0;\r\n  let high = dataArray.length - 1;\r\n  let p1 = dataArray[low];\r\n  let p2 = dataArray[high];\r\n\r\n  while (high - low > 1) {\r\n    let mid = Math.floor((low + high) / 2);\r\n    if (dataArray[mid].y < y_target) {\r\n      low = mid;\r\n    } else {\r\n      high = mid;\r\n    }\r\n  }\r\n  p1 = dataArray[low];\r\n  p2 = dataArray[high];\r\n\r\n  // 데이터 사이를 선형으로 메꿈\r\n  const slope_inv = (p2.x - p1.x) / (p2.y - p1.y);\r\n  const x_out = p1.x + (y_target - p1.y) * slope_inv;\r\n\r\n  return x_out;\r\n}\r\n\r\n/**\r\n * McCabe-Thiele 계산을 수행하는 메인 함수\r\n * @param {Variable} variables - ui.js에서 생성된 Variable class\r\n * @returns {object}\r\n */\r\nexport function calculateMcCabeThiele(variables) {\r\n  const { xd, xb, zf, q, r_factor, nm, sc } = variables;\r\n  const plotData = {\r\n    ideal_eq_curve: [],\r\n    line_45: [\r\n      { x: 0, y: 0 },\r\n      { x: 1, y: 1 },\r\n    ],\r\n    q_line: [],\r\n    esol_line: [],\r\n    ssol_line: [],\r\n    steps: [],\r\n    effective_curve: [],\r\n  };\r\n  const results = { R_min: 0, R: 0, stages: 0, feed_stage: 0, xb_actual: 0 };\r\n  const { x: q_ideal_eq_x, y: q_ideal_eq_y } = find_q_ideal_eq_intersect(q, zf);\r\n  const x_azeo_array = findAzeotropeX(); // 공비점 배열을 받음\r\n  let isAzeoError = false;\r\n  const azeoPointsInBoundary = [];\r\n\r\n  if (x_azeo_array.length > 0) {\r\n      // 1. 분리 영역(xb ~ xd)을 정의\r\n      const x_min = Math.min(xd, xb);\r\n      const x_max = Math.max(xd, xb);\r\n\r\n      // 2. 공비점이 분리 영역 내부에 있는지 확인\r\n      x_azeo_array.forEach(x_azeo => {\r\n          if (x_azeo > x_min && x_azeo < x_max) {\r\n              isAzeoError = true;\r\n              azeoPointsInBoundary.push(x_azeo);\r\n          }\r\n      });\r\n      /** \r\n      const highest_x_azeo = x_azeo_array[x_azeo_array.length - 1];\r\n      if (xd > highest_x_azeo) {\r\n          isAzeoError = true;\r\n          if (!azeoPointsInBoundary.includes(highest_x_azeo)) {\r\n              azeoPointsInBoundary.push(highest_x_azeo);\r\n          }\r\n      }\r\n      */\r\n  }\r\n  \r\n  // [신규] 공비물 오류 발생 시 즉시 반환 (계산 중단)\r\n  if (isAzeoError) {\r\n      // 오류가 발생했음을 알리는 플래그와 공비점 배열 반환\r\n      return { \r\n          plotData: { /* empty */ }, \r\n          results: { /* empty */ }, \r\n          floatStageNum: 0,\r\n          isAzeoError: true,\r\n          x_azeo_list: azeoPointsInBoundary.map(x => x.toFixed(3)).join(\", \")\r\n      };\r\n  }\r\n\r\n  const r_min_slope = (xd - q_ideal_eq_y) / (xd - q_ideal_eq_x);\r\n  results.R_min = r_min_slope / (1 - r_min_slope); // 최소 환류비\r\n\r\n  results.R = results.R_min * r_factor; // 실제 환류비\r\n\r\n  let R_internal = results.R;\r\n\r\n  const CP_LIQUID = 81.6; // 메탄올 액체 열용량 (J/mol·K)\r\n  const LATENT_HEAT = 35270; // 메탄올 기화 잠열 (J/mol)\r\n  const DELTA_T = sc; // 과냉각\r\n\r\n  // 과냉각 보정 계수 (F > 1)\r\n  // 차가운 환류가 증기를 추가 응축시켜 내부 유량을 증가시킴\r\n  const F_factor = 1 + (CP_LIQUID * DELTA_T) / LATENT_HEAT; // 엔탈피 수지식을 토대로 구함\r\n\r\n  // 조작선 그리기용 '내부 환류비' 갱신\r\n  R_internal = results.R * F_factor;\r\n\r\n  const esol_slope = R_internal / (R_internal + 1); // 정류부 operating line 기울기\r\n  const esol_intercept = xd / (R_internal + 1); // 정류부 operating line 절편\r\n\r\n  let q_esol_intersect_x, q_esol_intersect_y;\r\n  if (Math.abs(q - 1.0) < 1e-6) {\r\n    q_esol_intersect_x = zf;\r\n    q_esol_intersect_y = esol_slope * q_esol_intersect_x + esol_intercept;\r\n  } else {\r\n    const q_slope = q / (q - 1);\r\n    const q_intercept = -zf / (q - 1);\r\n    q_esol_intersect_x =\r\n      (esol_intercept - q_intercept) / (q_slope - esol_slope);\r\n    q_esol_intersect_y = esol_slope * q_esol_intersect_x + esol_intercept;\r\n  }\r\n\r\n  const ssol_slope = (q_esol_intersect_y - xb) / (q_esol_intersect_x - xb); // 탈거부 operating line 기울기\r\n  const ssol_intercept = xb - ssol_slope * xb; // 탈거부 operating line 절편\r\n\r\n  plotData.q_line = [\r\n    { x: zf, y: zf },\r\n    { x: q_ideal_eq_x, y: q_ideal_eq_y },\r\n  ];\r\n  plotData.esol_line = [\r\n    { x: xd, y: xd },\r\n    { x: q_esol_intersect_x, y: q_esol_intersect_y },\r\n  ];\r\n  plotData.ssol_line = [\r\n    { x: xb, y: xb },\r\n    { x: q_esol_intersect_x, y: q_esol_intersect_y },\r\n  ];\r\n\r\n  const y_op_rect = (x) => esol_slope * x + esol_intercept;\r\n  const y_op_strip = (x) => ssol_slope * x + ssol_intercept;\r\n\r\n  for (let i = 0; i <= 100; i++) {\r\n    const x = i / 100.0;\r\n    const y_ideal = getIdealEquilibriumY(x); // Ideal equilibrium(blue)\r\n\r\n    plotData.ideal_eq_curve.push({ x: x, y: y_ideal });\r\n\r\n    const y_op_r = y_op_rect(x);\r\n    const y_eff_r = y_op_r + nm * (y_ideal - y_op_r);\r\n    if (x > q_esol_intersect_x) {\r\n      plotData.effective_curve.push({ x: x, y: y_eff_r }); // 만약 qline을 안지났다면 rectifying operating line 기준으로, 아니면 stripping으로\r\n    }\r\n\r\n    const y_op_s = y_op_strip(x);\r\n    const y_eff_s = y_op_s + nm * (y_ideal - y_op_s);\r\n    if (x <= q_esol_intersect_x) {\r\n      plotData.effective_curve.push({ x: x, y: y_eff_s });\r\n    }\r\n  }\r\n\r\n  // stepping, 단수 계산.\r\n\r\n  let current_x = xd;\r\n  let current_y = xd;\r\n  let stage_count = 0;\r\n  let floatStageNum = 0;\r\n  const MAX_STAGES = 200;\r\n\r\n  while (current_x > xb && stage_count < MAX_STAGES) {\r\n    stage_count++;\r\n\r\n    let next_x; // 이번 스텝의 '다음 x'\r\n    const step_start_y = current_y; // 수평선 그리기를 위한 y값 저장\r\n\r\n    // 수평 이동\r\n    next_x = find_x_from_data(plotData.effective_curve, current_y);\r\n\r\n    // 수직 이동\r\n    let next_y;\r\n    if (next_x > q_esol_intersect_x) {\r\n      next_y = y_op_rect(next_x);\r\n    } else {\r\n      next_y = y_op_strip(next_x);\r\n\r\n      if (results.feed_stage === 0) {\r\n        results.feed_stage = stage_count;\r\n      }\r\n    }\r\n\r\n    plotData.steps.push([\r\n      { x: current_x, y: step_start_y },\r\n      { x: next_x, y: step_start_y },\r\n    ]); // 수평선\r\n    plotData.steps.push([\r\n      { x: next_x, y: step_start_y },\r\n      { x: next_x, y: next_y },\r\n    ]); // 수직선\r\n\r\n    if (next_x < xb) {\r\n      floatStageNum = stage_count + (current_x - xb) / (current_x - next_x);\r\n      break;\r\n    }\r\n\r\n    current_x = next_x;\r\n    current_y = next_y;\r\n  }\r\n\r\n  if (results.feed_stage === 0) results.feed_stage = 1;\r\n  results.stages = stage_count;\r\n  results.xb_actual = current_x;\r\n\r\n  return { plotData, results, floatStageNum, isAzeoError, x_azeo_array};\r\n}\r\n","/**\r\n * main.js\r\n * - Receive event from'index.html'.\r\n * - Get class 'Variable' from 'ui.js'.\r\n * - Actual calculation from 'mccabe-thiele.js'.\r\n * - Draw graph by Chart.js at canvas(html)\r\n */\r\n\r\nimport { Variable } from './ui.js';\r\nimport { calculateMcCabeThiele } from './mccabe-thiele.js';\r\nimport {\r\n    Chart,\r\n    LinearScale, // 선형 눈금 (linear scale)\r\n    PointElement, // 점 요소\r\n    LineElement,  // 선 요소\r\n    LineController,  // 선 그래프 컨트롤러\r\n    Filler,          // 영역 채우기 플러그인\r\n    Tooltip,      // 툴팁\r\n    Legend,       // 범례\r\n    Title,        // 제목\r\n    ScatterController, // 산점도 차트 컨트롤러\r\n} from 'chart.js'; \r\nimport \"../style.css\";\r\nlet mccabeChart = null;\r\n\r\nconst calcForm = document.getElementById('calc-form');\r\nconst chartCanvas = document.getElementById('mccabeThieleChart');\r\nconst resultsTextElement = document.getElementById('results-text');\r\n//@ts-ignore\r\nconst ctx = chartCanvas.getContext('2d');\r\n\r\nChart.register(\r\n    LinearScale,\r\n    PointElement,\r\n    LineElement,\r\n    LineController,  // 선 그래프 컨트롤러\r\n    Filler,          // 영역 채우기 플러그인\r\n    Tooltip,\r\n    Legend,\r\n    Title,\r\n    ScatterController\r\n);\r\n\r\n/**\r\n * Run calculation and update states\r\n */\r\nfunction runCalculation() {\r\n    try {\r\n        const variables = new Variable();\r\n        const { plotData, results, floatStageNum, isAzeoError, x_azeo_array } = calculateMcCabeThiele(variables);\r\n\r\n        if (isAzeoError) {\r\n            const errorMessage = `Azeotrope Error: Desired distillate composition (xd = ${variables.xd.toFixed(3)}) exceeds the azeotropic point (x_azeo = ${x_azeo_array}). Separation to this purity is physically impossible.`;\r\n            alert(errorMessage);\r\n            resultsTextElement.textContent = `Calculation Error:\\n${errorMessage}`;\r\n            \r\n            // 이전 차트가 있다면 파괴하여 빈 캔버스를 만듭니다.\r\n            if (mccabeChart) mccabeChart.destroy();\r\n            \r\n            // 여기서 정상적인 흐름을 중단합니다.\r\n            return; \r\n        }\r\n        renderResults(results, floatStageNum); // print output as text\r\n        renderPlot(plotData); // print output as plot\r\n\r\n    } catch (error) {\r\n        console.error(\"McCabe-Thiele 계산 중 오류 발생:\", error);\r\n        alert(`계산에 실패했습니다: ${error.message}\\n콘솔(F12)에서 자세한 내용을 확인하세요.`);\r\n        resultsTextElement.textContent = `계산 오류:\\n${error.message}`;\r\n    }\r\n}\r\n\r\n/**\r\n * print output at HTML <pre> tag\r\n * @param {object} results\r\n */\r\nfunction renderResults(results, floatStageNum) {\r\n    document.getElementById('results_Rmin').textContent = results.R_min.toFixed(3);\r\n    document.getElementById('results_Rreal').textContent = results.R.toFixed(3);\r\n    //@ts-ignore\r\n    document.getElementById('results_Rfactor').textContent = document.getElementById('r_factor').value;\r\n    document.getElementById('results_Nstage').textContent = results.stages;\r\n    document.getElementById('results_Nstage_float').textContent = floatStageNum.toFixed(1);\r\n    document.getElementById('results_Fstage').textContent = results.feed_stage;\r\n}\r\n\r\n/**\r\n * 계산된 플롯 데이터를 받아 Chart.js로 캔버스에 그래프를 그립니다.\r\n * (v2.0 - 분리된 유사 평형 곡선 렌더링)\r\n * @param {object} plotData - mccabe-thiele.js가 반환한 plotData 객체\r\n */\r\nfunction renderPlot(plotData) {\r\n    \r\n    // 1. Chart.js가 요구하는 'datasets' 형식으로 데이터를 변환합니다.\r\n    const datasets = [\r\n        // (1) 이상 평형 곡선 (VLE 데이터)\r\n        {\r\n            label: 'Ideal Equilibrium (VLE)',\r\n            data: plotData.ideal_eq_curve, // [{x, y}, ...]\r\n            borderColor: 'blue',\r\n            borderWidth: 2,\r\n            pointRadius: 0,\r\n            showLine: true,\r\n            type: 'line',\r\n        },\r\n        \r\n        \r\n        // [!] 'murphree_eq_curve'\r\n        {   label: 'Effective Eq. (Rectifying)',\r\n            data: plotData.effective_curve,\r\n            borderColor: '#00c000', // 녹색\r\n            borderDash: [5, 5], // 점선\r\n            borderWidth: 2,\r\n            pointRadius: 0,\r\n            showLine: true,\r\n            type: 'line',\r\n        },\r\n\r\n        // (3) y=x (45도선)\r\n        {\r\n            label: 'y = x',\r\n            data: plotData.line_45,\r\n            borderColor: 'grey',\r\n            borderWidth: 1,\r\n            pointRadius: 0,\r\n            showLine: true,\r\n            type: 'line',\r\n        },\r\n        // (4) q-line\r\n        {\r\n            label: 'q-Line',\r\n            data: plotData.q_line,\r\n            borderColor: 'orange', // (q-line 색상, 겹칠 수 있으니 orange 유지)\r\n            borderWidth: 2,\r\n            pointRadius: 0,\r\n            showLine: true,\r\n            type: 'line',\r\n        },\r\n        // (5) 정류부 조작선 (ESOL)\r\n        {\r\n            label: 'ESOL',\r\n            data: plotData.esol_line,\r\n            borderColor: '#6a5acd', // 보라색\r\n            borderWidth: 2,\r\n            pointRadius: 0,\r\n            showLine: true,\r\n            type: 'line',\r\n        },\r\n        // (6) 탈거부 조작선 (SSOL)\r\n        {\r\n            label: 'SSOL',\r\n            data: plotData.ssol_line,\r\n            borderColor: '#6a5acd', // 보라색\r\n            borderWidth: 2,\r\n            pointRadius: 0,\r\n            showLine: true,\r\n            type: 'line',\r\n        },\r\n        // (7) 계단 (Steps) - 각 선분을 별도의 데이터셋으로 추가\r\n        ...plotData.steps.map(segment => ({\r\n            type: 'line',\r\n            data: segment, // [{x,y}, {x,y}]\r\n            borderColor: '#FF6384', // 빨간색 (계단)\r\n            borderWidth: 1.5,\r\n            pointRadius: 0,\r\n            fill: false,\r\n            showLine: true,\r\n            showInLegend: false, \r\n        }))\r\n    ];\r\n\r\n    // 2. 기존에 차트가 있다면, 업데이트를 위해 파괴(destroy)합니다.\r\n    if (mccabeChart) {\r\n        mccabeChart.destroy();\r\n    }\r\n\r\n    // 3. 새 차트를 생성합니다.\r\n    mccabeChart = new Chart(ctx, {\r\n        type: 'scatter', \r\n        data: { datasets: datasets },\r\n        options: {\r\n            plugins: {\r\n                title: {\r\n                    display: true,\r\n                    text: 'McCabe-Thiele Plot (Methanol-Water @ 1 atm)',\r\n                    font: { size: 18 }\r\n                },\r\n                legend: {\r\n                    position: 'bottom',\r\n                    labels: {\r\n                        // [!] 우리가 이전에 수정한 'TypeError' 방지 코드 포함\r\n                        filter: (legendItem) => {\r\n                            if (!legendItem.text) {\r\n                                return false; // 'label'이 없는 항목 (예: steps) 숨기기\r\n                            }\r\n                            return true; // 'label'이 있는 항목만 표시\r\n                        }\r\n                    }\r\n                },\r\n                tooltip: {\r\n                    callbacks: {\r\n                        label: (context) => {\r\n                            const d = context.raw\r\n                            //@ts-ignore\r\n                            return `${context.dataset.label}: (x: ${d.x.toFixed(3)}, y: ${d.y.toFixed(3)})`;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            scales: {\r\n                x: {\r\n                    type: 'linear',\r\n                    position: 'bottom',\r\n                    title: { display: true, text: 'Liquid Mole Fraction (x)' },\r\n                    min: 0.0,\r\n                    max: 1.0,\r\n                },\r\n                y: {\r\n                    type: 'linear',\r\n                    title: { display: true, text: 'Vapor Mole Fraction (y)' },\r\n                    min: 0.0,\r\n                    max: 1.0,\r\n                }\r\n            },\r\n            aspectRatio: 1,\r\n            animation: false,\r\n            parsing: false, \r\n        }\r\n    });\r\n}\r\n\r\ncalcForm.addEventListener('submit', (event) => {\r\n    event.preventDefault(); \r\n    runCalculation();\r\n});\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    console.log(\"페이지 로드 완료. 기본값으로 첫 계산을 실행합니다.\");\r\n    runCalculation();\r\n});"],"names":["SUPABASE_ANON_KEY","SUPABASE_SYSTEMS_ENDPOINT","VLE_DATA","METHANOL_VLE_DATA","x","y","initializeVLEData","newVLEData","Array","isArray","length","console","error","log","getIdealEquilibriumY","x_in","p1","p2","i","slope","MY_SYSTEMS_KEY","Variable","xd","xb","zf","q","r_factor","nm","sc","constructor","this","parseFloat","document","getElementById","value","validate","some","val","isNaN","alert","warn","systemSelect","systemDeleteSelect","deleteVleBtn","systemDescription","querySelector","vleInputModal","addVleRowBtn","vleDataList","saveVleBtn","cancelVleBtn","dataManagementModal","manageDataBtn","closeManageBtn","addNewVleDataBtn","customVLEData","getMySystemIds","stored","localStorage","getItem","JSON","parse","async","fetchAndPopulateSystems","systems","response","fetch","method","headers","ok","Error","statusText","json","fetchSystemsFromDB","currentVal","innerHTML","defaultOpt","createElement","textContent","appendChild","forEach","sys","opt","system_id","system_name","find","s","allSystems","myIds","mySystems","filter","includes","disabled","updateDeleteDropdown","handleSystemChange","event","selectedValue","target","showVLEModal","systemId","data","system","vle_points","vle_source","e","loadVLEDataBySystemId","classList","remove","firstRow","className","lastRow","updateRemoveButtonVisibility","clearVLERows","hideVLEModal","add","rows","from","querySelectorAll","row","index","btn","style","visibility","find_x_from_data","dataArray","y_target","low","high","mid","Math","floor","slope_inv","calculateMcCabeThiele","variables","plotData","ideal_eq_curve","line_45","q_line","esol_line","ssol_line","steps","effective_curve","results","R_min","R","stages","feed_stage","xb_actual","q_ideal_eq_x","q_ideal_eq_y","abs","x_intersect","mid_xa","ideal_eq2","q_slope","q_intercept","f","mid_x","find_q_ideal_eq_intersect","x_azeo_array","azeotropes","tolerance","x1","y1","x2","min","y2","j","x_azeo","push","findAzeotropeX","isAzeoError","azeoPointsInBoundary","x_min","x_max","max","floatStageNum","x_azeo_list","map","toFixed","join","r_min_slope","R_internal","F_factor","esol_slope","esol_intercept","q_esol_intersect_x","q_esol_intersect_y","ssol_slope","ssol_intercept","y_op_rect","y_op_strip","y_ideal","y_op_r","y_eff_r","y_op_s","y_eff_s","current_x","current_y","stage_count","next_x","step_start_y","next_y","addEventListener","deleteSelect","deleteBtn","mainSystemSelect","idToDelete","selectedOptionText","options","selectedIndex","text","confirm","originalBtnText","status","id","ids","newIds","savedId","setItem","stringify","removeMySystemId","desc","message","compA","compB","src","validateVLEData","sort","a","b","trim","source","systemName","dbPayload","vle_type","vle_component_num","component_a","component_b","body","savedSystemId","addMySystemId","insertBefore","addVLEDataRow","contains","closest","mccabeChart","calcForm","chartCanvas","resultsTextElement","ctx","getContext","runCalculation","errorMessage","destroy","renderResults","datasets","label","borderColor","borderWidth","pointRadius","showLine","type","borderDash","segment","fill","showInLegend","plugins","title","display","font","size","legend","position","labels","legendItem","tooltip","callbacks","context","d","raw","dataset","scales","aspectRatio","animation","parsing","renderPlot","register","preventDefault"],"ignoreList":[],"sourceRoot":""}
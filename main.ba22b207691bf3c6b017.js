"use strict";(self.webpackChunkmccabe_thiele_method_online=self.webpackChunkmccabe_thiele_method_online||[]).push([[792],{374:(e,t,n)=>{let a=[];const l=[{x:0,y:0},{x:.012,y:.068},{x:.02,y:.121},{x:.026,y:.159},{x:.033,y:.188},{x:.036,y:.215},{x:.053,y:.275},{x:.076,y:.366},{x:.1,y:.438},{x:.12,y:.485},{x:.14,y:.522},{x:.15,y:.541},{x:.2,y:.605},{x:.3,y:.686},{x:.4,y:.739},{x:.5,y:.779},{x:.6,y:.825},{x:.7,y:.87},{x:.8,y:.915},{x:.9,y:.958},{x:.95,y:.979},{x:1,y:1}];function o(e){if(!Array.isArray(e)||e.length<2)return console.error("VLE Data initialization failed: Data must be an array with at least 2 points."),void(a=l);a=e,console.log(`VLE Data initialized with ${a.length} points.`)}function s(e,t){if(e<=0)return 0;if(e>=1)return 1;if(t)return e*t/(1+(t-1)*e);let n=a[0],l=a[1];for(let t=1;t<a.length;t++)if(a[t].x>=e){n=a[t-1],l=a[t];break}const o=(l.y-n.y)/(l.x-n.x);return n.y+(e-n.x)*o}o(l);const i="vle_systems_data";let r={LK_Cp:81.6,LK_Latent:35270,HK_Cp:75.3,HK_Latent:40660};function d(){const e=localStorage.getItem(i);return e?JSON.parse(e):[]}function c(e){localStorage.setItem(i,JSON.stringify(e))}class u{xd;xb;zf;q;r_factor;nm;sc;alpha;Cp_LK;Latent_LK;Cp_HK;Latent_HK;constructor(){this.xd=parseFloat(document.getElementById("xd").value),this.xb=parseFloat(document.getElementById("xb").value),this.zf=parseFloat(document.getElementById("zf").value),this.q=parseFloat(document.getElementById("q").value),this.r_factor=parseFloat(document.getElementById("r_factor").value),this.nm=parseFloat(document.getElementById("nm").value),this.sc=parseFloat(document.getElementById("sub_cooling").value);const e=document.getElementById("system_select"),t=e&&"ideal_binary"===e.value;this.alpha=t?parseFloat(document.getElementById("alpha_value").value):null,this.Cp_LK=r.LK_Cp||0,this.Latent_LK=r.LK_Latent||0,this.Cp_HK=r.HK_Cp||0,this.Latent_HK=r.HK_Latent||0,this.validate()}validate(){return[this.xd,this.xb,this.zf,this.q,this.r_factor,this.nm,this.sc].some(e=>isNaN(e))?(alert("유효하지 않은 입력값이 있습니다. 숫자만 입력해주세요."),!1):null===this.alpha||!(isNaN(this.alpha)||this.alpha<=1)||(alert("상대휘발도(α)는 1.0보다 커야 합니다."),!1)}}const m=document.getElementById("system_select"),y=document.getElementById("system_for_delete_select"),_=document.getElementById("system_for_out_select"),p=document.getElementById("delete-vle-btn"),v=document.getElementById("out-vle-btn"),h=document.getElementById("input_json_btn"),f=document.querySelector(".description"),b=document.getElementById("vle-input-modal"),x=document.getElementById("add-vle-row-btn"),g=document.getElementById("vle-data-list"),L=document.getElementById("save-vle-btn"),E=document.getElementById("cancel-vle-btn"),C=document.getElementById("data-management-modal"),I=document.getElementById("manage-vle-data-btn"),B=document.getElementById("close-data-management-modal-btn"),K=document.getElementById("add-new-vle-data-btn"),w=document.getElementById("alpha-container");let H=[];function M(){const e=d();if(m){const t=m.value;m.innerHTML="";const n=document.createElement("option");n.value="ideal_binary",n.textContent="Ideal Binary System (Relative Volatility α)",m.appendChild(n);const a=document.createElement("option");a.value="methanol_water",a.textContent="Methanol-Water (Default)",m.appendChild(a),e.forEach(e=>{const t=document.createElement("option");t.value=e.system_id,t.textContent=e.system_name,m.appendChild(t)}),t&&("methanol_water"===t||e.find(e=>e.system_id===t))&&(m.value=t)}F(y,e,p,"삭제할 데이터가 없습니다."),F(_,e,v,"내보낼 데이터가 없습니다.")}function F(e,t,n,a){if(e)if(e.innerHTML="",0===t.length){const t=document.createElement("option");t.textContent=a,t.disabled=!0,e.appendChild(t),n&&(n.disabled=!0)}else n&&(n.disabled=!1),t.forEach(t=>{const n=document.createElement("option");n.value=t.system_id,n.textContent=t.system_name,e.appendChild(n)})}async function R(e){const t=e.target.value;if("ideal_binary"===t)return w&&w.classList.remove("hidden"),f&&(f.innerHTML="<b>System:</b> Ideal Binary<br><b>Method:</b> Relative Volatility (α)"),void(r={LK_Cp:0,LK_Latent:0,HK_Cp:0,HK_Latent:0});w&&w.classList.add("hidden"),"methanol_water"===t?(o(l),H=l,r={LK_Cp:81.6,LK_Latent:35270,HK_Cp:75.3,HK_Latent:40660},f&&(f.innerHTML="<b>System:</b> Methanol-Water<br><b>Assumptions:</b> Total Condenser, Partial Reboiler")):function(e){try{const t=d().find(t=>t.system_id===e);if(!t)throw new Error("Data not found");o(t.vle_points),H=t.vle_points;const n=t.props||{};r={LK_Cp:n.LK_Cp||0,LK_Latent:n.LK_Latent||0,HK_Cp:n.HK_Cp||0,HK_Latent:n.HK_Latent||0},f&&(f.innerHTML=`<b>System:</b> ${t.system_name}<br><b>Source:</b> ${t.vle_source}<br>\n      <span style="font-size:0.85em; color:#555;">(Props Loaded)</span>`)}catch(e){console.error(e),alert("데이터 로드 실패. 기본값으로 복귀합니다."),m&&(m.value="methanol_water")}}(t)}function S(){b&&b.classList.add("hidden"),C&&C.classList.remove("hidden")}function q(){const e=g.querySelectorAll(".vle-row");e.forEach((t,n)=>{const a=t.querySelector(".remove-vle-row");a&&(a.style.visibility=0===n||n===e.length-1?"hidden":"visible")})}function k(e,t){if(t<=e[0].y)return e[0].x;if(t>=e[e.length-1].y)return e[e.length-1].x;let n=0,a=e.length-1,l=e[n],o=e[a];for(;a-n>1;){let l=Math.floor((n+a)/2);e[l].y<t?n=l:a=l}l=e[n],o=e[a];const s=(o.x-l.x)/(o.y-l.y);return l.x+(t-l.y)*s}function $(e){const{xd:t,xb:n,zf:a,q:l,r_factor:o,nm:i,sc:r,Cp_LK:d,Latent_LK:c,Cp_HK:u,Latent_HK:m}=e,y={ideal_eq_curve:[],line_45:[{x:0,y:0},{x:1,y:1}],q_line:[],esol_line:[],ssol_line:[],steps:[],effective_curve:[]},_={R_min:0,R:0,stages:0,feed_stage:0,xb_actual:0},{x:p,y:v}=function(e,t,n){if(Math.abs(e-1)<1e-6)return{x:t,y:s(t,n)};if(Math.abs(e)<1e-6){const e=function(e,t){let n,a=0,l=1;for(let o=0;o<30;o++)n=(a+l)/2,s(n,t)<e?a=n:l=n;return(a+l)/2}(t,n);return{x:e,y:t}}const a=e/(e-1),l=-t/(e-1),o=e=>s(e,n)-(e=>a*e+l)(e);let i,r=0,d=1;for(let e=0;e<30;e++)i=(r+d)/2,o(i)<0?r=i:d=i;const c=(r+d)/2;return{x:c,y:s(c,n)}}(l,a,e.alpha),h=function(){const e=(e,t)=>s(e,t)-e,t=[],n=1e-6;let a=0,l=e(a);for(let o=1;o<=1e3;o++){let s=Math.min(1,.001*o),i=e(s);if(Math.abs(a)<n||Math.abs(s-1)<n)a=s,l=i;else{if(l*i<0){let l=a,o=s;for(let t=0;t<30;t++){let t=(l+o)/2;if(0===e(t)||o-l<n){l=t;break}e(t)*e(l)<0?o=t:l=t}const i=(l+o)/2;(0===t.length||Math.abs(t[t.length-1]-i)>n)&&t.push(i)}a=s,l=i}}return t}();let f=!1;const b=[];if(h.length>0){const e=Math.min(t,n),a=Math.max(t,n);h.forEach(t=>{t>e&&t<a&&(f=!0,b.push(t))})}if(f)return{plotData:{},results:{},floatStageNum:0,isAzeoError:!0,x_azeo_list:b.map(e=>e.toFixed(3)).join(", ")};const x=(t-v)/(t-p);_.R_min=x/(1-x),_.R=_.R_min*o;let g=_.R;const L=1+(t*d+(1-t)*u)*r/(t*c+(1-t)*m);g=_.R*L;const E=g/(g+1),C=t/(g+1);let I,B;Math.abs(l-1)<1e-6?(I=a,B=E*I+C):(I=(C- -a/(l-1))/(l/(l-1)-E),B=E*I+C);const K=(B-n)/(I-n),w=n-K*n;y.q_line=[{x:a,y:a},{x:p,y:v}],y.esol_line=[{x:t,y:t},{x:I,y:B}],y.ssol_line=[{x:n,y:n},{x:I,y:B}];const H=e=>E*e+C,M=e=>K*e+w;for(let t=0;t<=100;t++){const n=t/100,a=s(n,e.alpha);y.ideal_eq_curve.push({x:n,y:a});const l=H(n),o=l+i*(a-l);n>I&&y.effective_curve.push({x:n,y:o});const r=M(n),d=r+i*(a-r);n<=I&&y.effective_curve.push({x:n,y:d})}let F=t,R=t,S=0,q=0;for(;F>n&&S<200;){let e;S++;const t=R;let a;if(e=k(y.effective_curve,R),e>I?a=H(e):(a=M(e),0===_.feed_stage&&(_.feed_stage=S)),y.steps.push([{x:F,y:t},{x:e,y:t}]),y.steps.push([{x:e,y:t},{x:e,y:a}]),e<n){q=S+(F-n)/(F-e);break}F=e,R=a}return 0===_.feed_stage&&(_.feed_stage=1),_.stages=S,_.xb_actual=F,{plotData:y,results:_,floatStageNum:q,isAzeoError:f,x_azeo_array:h}}M(),m&&m.addEventListener("change",R),I&&I.addEventListener("click",()=>{M(),C.classList.remove("hidden")}),B&&B.addEventListener("click",()=>C.classList.add("hidden")),K&&K.addEventListener("click",()=>{C.classList.add("hidden"),b&&(b.classList.remove("hidden"),function(){if(!g)return;g.innerHTML="";const e=document.createElement("div");e.className="vle-row",e.innerHTML='<label>x:</label><input value="0.0" readonly class="vle-x"><label>y:</label><input value="0.0" readonly class="vle-y"><button class="remove-vle-row" style="visibility:hidden">-</button>',g.appendChild(e);const t=document.createElement("div");t.className="vle-row",t.innerHTML='<label>x:</label><input value="1.0" readonly class="vle-x"><label>y:</label><input value="1.0" readonly class="vle-y"><button class="remove-vle-row" style="visibility:hidden">-</button>',g.appendChild(t),q()}(),["comp_name_A","comp_name_B","vle_source_input","LK_vle_Cpl_input","LK_vle_vLatent_heat_input","HK_vle_Cpl_input","HK_vle_vLatent_heat_input"].forEach(e=>{const t=document.getElementById(e);t&&(t.value="")}))}),p&&p.addEventListener("click",function(){if(!y||!y.value)return alert("선택 필요");const e=y.options[y.selectedIndex].text;if(!confirm(`정말 '${e}' 데이터를 삭제합니까?`))return;const t=y.value;c(d().filter(e=>e.system_id!==t)),alert("삭제되었습니다."),M(),m&&m.value===t&&(m.value="methanol_water",R({target:{value:"methanol_water"}}))}),v&&v.addEventListener("click",function(){if(!_||!_.value)return void alert("내보낼 시스템을 선택해주세요.");const e=_.value,t=d().find(t=>t.system_id===e);if(!t)return alert("데이터 없음");const n=JSON.stringify(t,null,2),a=new Blob([n],{type:"application/json"}),l=URL.createObjectURL(a),o=document.createElement("a");o.href=l,o.download=`${t.system_name}_VLE.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)}),h&&h.addEventListener("change",function(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=function(t){try{const e=JSON.parse(t.target.result);if(!e.system_name||!e.vle_points)throw new Error("필수 데이터 누락");const n="loc_"+Date.now()+Math.floor(1e3*Math.random());e.system_id=n,e.created_at=(new Date).toISOString();const a=d();a.push(e),c(a),alert(`가져오기 완료: ${e.system_name}`),M(),C&&C.classList.add("hidden"),m&&(m.value=n,R({target:{value:n}}))}catch(e){alert("Import Error: "+e.message)}finally{e.target.value=""}},n.readAsText(t)}),E&&E.addEventListener("click",S),L&&L.addEventListener("click",function(){const e=g.querySelectorAll(".vle-row"),t=[];if(e.forEach(e=>{const n=parseFloat(e.querySelector(".vle-x").value),a=parseFloat(e.querySelector(".vle-y").value);t.push({x:n,y:a})}),!function(e){const t=document.getElementById("comp_name_A").value,n=document.getElementById("comp_name_B").value;return t&&n?!(e.length<2)||(alert("최소 2개의 데이터 필요"),!1):(alert("성분명 필수"),!1)}(t))return;t.sort((e,t)=>e.x-t.x);const n=document.getElementById("comp_name_A").value.trim(),a=document.getElementById("comp_name_B").value.trim(),l=document.getElementById("vle_source_input").value.trim(),s=parseFloat(document.getElementById("LK_vle_Cpl_input").value)||0,i=parseFloat(document.getElementById("LK_vle_vLatent_heat_input").value)||0,u=parseFloat(document.getElementById("HK_vle_Cpl_input").value)||0,y=parseFloat(document.getElementById("HK_vle_vLatent_heat_input").value)||0,_=`${n}-${a}`,p="loc_"+Date.now()+Math.floor(1e3*Math.random()),v={system_id:p,system_name:_,component_a:n,component_b:a,vle_points:t,vle_source:l,props:{LK_Cp:s,LK_Latent:i,HK_Cp:u,HK_Latent:y},created_at:(new Date).toISOString()};try{const e=d();e.push(v),c(e),H=t,r=v.props,o(H),S(),alert(`저장 완료! '${_}'`),M(),m&&(m.value=p,R({target:{value:p}}))}catch(e){console.error(e),alert("저장 실패: "+e.message)}}),x&&x.addEventListener("click",()=>function(e=.5,t=.5){if(!g)return;const n=document.createElement("div");n.className="vle-row",n.innerHTML=`<label>x:</label><input type="number" step="any" min="0" max="1" value="${e}" class="vle-x"><label>y:</label><input type="number" step="any" min="0" max="1" value="${t}" class="vle-y"><button type="button" class="remove-vle-row">-</button>`,g.appendChild(n),q()}()),g&&g.addEventListener("click",e=>{e.target.classList.contains("remove-vle-row")&&(e.target.closest(".vle-row").remove(),q())});var z=n(106);let N=null;const D=document.getElementById("calc-form"),T=document.getElementById("mccabeThieleChart"),A=document.getElementById("results-text"),O=T.getContext("2d");function W(){try{const e=new u,{plotData:t,results:n,floatStageNum:a,isAzeoError:l,x_azeo_array:o}=$(e);if(l){const t=`Azeotrope Error: Desired distillate composition (xd = ${e.xd.toFixed(3)}) exceeds the azeotropic point (x_azeo = ${o}). Separation to this purity is physically impossible.`;return alert(t),A.textContent=`Calculation Error:\n${t}`,void(N&&N.destroy())}!function(e,t){document.getElementById("results_Rmin").textContent=e.R_min.toFixed(3),document.getElementById("results_Rreal").textContent=e.R.toFixed(3),document.getElementById("results_Rfactor").textContent=document.getElementById("r_factor").value,document.getElementById("results_Nstage").textContent=e.stages,document.getElementById("results_Nstage_float").textContent=t.toFixed(1),document.getElementById("results_Fstage").textContent=e.feed_stage}(n,a),function(e){const t=[{label:"Ideal Equilibrium (VLE)",data:e.ideal_eq_curve,borderColor:"blue",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"Effective Eq. (Rectifying)",data:e.effective_curve,borderColor:"#00c000",borderDash:[5,5],borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"y = x",data:e.line_45,borderColor:"grey",borderWidth:1,pointRadius:0,showLine:!0,type:"line"},{label:"q-Line",data:e.q_line,borderColor:"orange",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"ESOL",data:e.esol_line,borderColor:"#6a5acd",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"SSOL",data:e.ssol_line,borderColor:"#6a5acd",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},...e.steps.map(e=>({type:"line",data:e,borderColor:"#FF6384",borderWidth:1.5,pointRadius:0,fill:!1,showLine:!0,showInLegend:!1}))];N&&N.destroy(),N=new z.t1(O,{type:"scatter",data:{datasets:t},options:{plugins:{title:{display:!0,text:"McCabe-Thiele Plot (Methanol-Water @ 1 atm)",font:{size:18}},legend:{position:"bottom",labels:{filter:e=>!!e.text}},tooltip:{callbacks:{label:e=>{const t=e.raw;return`${e.dataset.label}: (x: ${t.x.toFixed(3)}, y: ${t.y.toFixed(3)})`}}}},scales:{x:{type:"linear",position:"bottom",title:{display:!0,text:"Liquid Mole Fraction (x)"},min:0,max:1},y:{type:"linear",title:{display:!0,text:"Vapor Mole Fraction (y)"},min:0,max:1}},aspectRatio:1,animation:!1,parsing:!1}})}(t)}catch(e){console.error("McCabe-Thiele 계산 중 오류 발생:",e),alert(`계산에 실패했습니다: ${e.message}\n콘솔(F12)에서 자세한 내용을 확인하세요.`),A.textContent=`계산 오류:\n${e.message}`}}z.t1.register(z.kc,z.FN,z.No,z.ZT,z.dN,z.m_,z.s$,z.hE,z.Pz),D.addEventListener("submit",e=>{e.preventDefault(),W()}),document.addEventListener("DOMContentLoaded",()=>{console.log("페이지 로드 완료. 기본값으로 첫 계산을 실행합니다."),W()})}},e=>{e.O(0,[106],()=>e(e.s=374)),e.O()}]);
//# sourceMappingURL=main.ba22b207691bf3c6b017.js.map
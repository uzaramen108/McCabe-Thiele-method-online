"use strict";(self.webpackChunkmccabe_thiele_method_online=self.webpackChunkmccabe_thiele_method_online||[]).push([[792],{940:(e,t,n)=>{const o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBzbG96bXZmZHJwcG1tdnNucGZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NzQ1NzIsImV4cCI6MjA4MDA1MDU3Mn0.4gL96sI9vhEwgpPXFdY_c80msecst08vJYPv6PNzgO0";let a=[];const l=[{x:0,y:0},{x:.012,y:.068},{x:.02,y:.121},{x:.026,y:.159},{x:.033,y:.188},{x:.036,y:.215},{x:.053,y:.275},{x:.076,y:.366},{x:.1,y:.438},{x:.12,y:.485},{x:.14,y:.522},{x:.15,y:.541},{x:.2,y:.605},{x:.3,y:.686},{x:.4,y:.739},{x:.5,y:.779},{x:.6,y:.825},{x:.7,y:.87},{x:.8,y:.915},{x:.9,y:.958},{x:.95,y:.979},{x:1,y:1}];function r(e){if(!Array.isArray(e)||e.length<2)return console.error("VLE Data initialization failed: Data must be an array with at least 2 points."),void(a=l);a=e,console.log(`VLE Data initialized with ${a.length} points.`)}function i(e){if(e<=0)return 0;if(e>=1)return 1;let t=a[0],n=a[1];for(let o=1;o<a.length;o++)if(a[o].x>=e){t=a[o-1],n=a[o];break}const o=(n.y-t.y)/(n.x-t.x);return t.y+(e-t.x)*o}r(l);class s{xd;xb;zf;q;r_factor;nm;sc;constructor(){this.xd=parseFloat(document.getElementById("xd").value),this.xb=parseFloat(document.getElementById("xb").value),this.zf=parseFloat(document.getElementById("zf").value),this.q=parseFloat(document.getElementById("q").value),this.r_factor=parseFloat(document.getElementById("r_factor").value),this.nm=parseFloat(document.getElementById("nm").value),this.sc=parseFloat(document.getElementById("sub_cooling").value),this.validate()}validate(){return[this.xd,this.xb,this.zf,this.q,this.r_factor,this.nm,this.sc].some(e=>isNaN(e))?(console.error("입력값 오류: 일부 값이 숫자가 아닙니다 (NaN).",this),alert("유효하지 않은 입력값이 있습니다. 숫자만 입력해주세요."),!1):((this.xd<=this.zf||this.zf<=this.xb)&&console.warn(`입력값 경고: 조성 순서가 올바르지 않습니다 (xd > zf > xb 여야 함). xd=${this.xd}, zf=${this.zf}, xb=${this.xb}`),!0)}}const c=document.getElementById("system_select"),d=document.getElementById("system-description"),u=document.getElementById("vle-input-modal"),m=document.getElementById("add-vle-row-btn"),y=document.getElementById("vle-data-list"),p=document.getElementById("save-vle-btn"),x=document.getElementById("cancel-vle-btn");let b=[];function f(){u&&u.classList.add("hidden")}function v(){if(!y)return;const e=Array.from(y.querySelectorAll(".vle-row")),t=e.length;e.forEach((e,n)=>{const o=e.querySelector(".remove-vle-row");if(o){const e=n>0&&n<t-1;o.style.visibility=e?"visible":"hidden"}})}function h(e,t){if(t<=e[0].y)return e[0].x;if(t>=e[e.length-1].y)return e[e.length-1].x;let n=0,o=e.length-1,a=e[n],l=e[o];for(;o-n>1;){let a=Math.floor((n+o)/2);e[a].y<t?n=a:o=a}a=e[n],l=e[o];const r=(l.x-a.x)/(l.y-a.y);return a.x+(t-a.y)*r}function g(e){const{xd:t,xb:n,zf:o,q:a,r_factor:l,nm:r,sc:s}=e,c={ideal_eq_curve:[],line_45:[{x:0,y:0},{x:1,y:1}],q_line:[],esol_line:[],ssol_line:[],steps:[],effective_curve:[]},d={R_min:0,R:0,stages:0,feed_stage:0,xb_actual:0},{x:u,y:m}=function(e,t){if(Math.abs(e-1)<1e-6)return{x:t,y:i(t)};if(Math.abs(e)<1e-6){const e=function(e){let t,n=0,o=1;for(let a=0;a<30;a++)t=(n+o)/2,i(t)<e?n=t:o=t;return(n+o)/2}(t);return{x:e,y:t}}const n=e/(e-1),o=-t/(e-1),a=e=>i(e)-(e=>n*e+o)(e);let l,r=0,s=1;for(let e=0;e<30;e++)l=(r+s)/2,a(l)<0?r=l:s=l;const c=(r+s)/2;return{x:c,y:i(c)}}(a,o),y=function(){const e=e=>i(e)-e;let t,n=1e-6,o=.999999;if(e(n)*e(o)>0)return null;for(let a=0;a<30&&(t=(n+o)/2,!(0===e(t)||o-n<1e-6));a++)e(t)>0?o=t:n=t;return t}();let p=!1;if(null!==y&&t>y&&(p=!0),p)return{plotData:{},results:{},floatStageNum:0,isAzeoError:!0,x_azeo:y.toFixed(3)};const x=(t-m)/(t-u);d.R_min=x/(1-x),d.R=d.R_min*l;let b=d.R;const f=1+81.6*s/35270;b=d.R*f;const v=b/(b+1),g=t/(b+1);let _,E;Math.abs(a-1)<1e-6?(_=o,E=v*_+g):(_=(g- -o/(a-1))/(a/(a-1)-v),E=v*_+g);const I=(E-n)/(_-n),L=n-I*n;c.q_line=[{x:o,y:o},{x:u,y:m}],c.esol_line=[{x:t,y:t},{x:_,y:E}],c.ssol_line=[{x:n,y:n},{x:_,y:E}];const w=e=>v*e+g,B=e=>I*e+L;for(let e=0;e<=100;e++){const t=e/100,n=i(t);c.ideal_eq_curve.push({x:t,y:n});const o=w(t),a=o+r*(n-o);t>_&&c.effective_curve.push({x:t,y:a});const l=B(t),s=l+r*(n-l);t<=_&&c.effective_curve.push({x:t,y:s})}let C=t,q=t,z=0,F=0;for(;C>n&&z<200;){let e;z++;const t=q;let o;if(e=h(c.effective_curve,q),e>_?o=w(e):(o=B(e),0===d.feed_stage&&(d.feed_stage=z)),c.steps.push([{x:C,y:t},{x:e,y:t}]),c.steps.push([{x:e,y:t},{x:e,y:o}]),e<n){F=z+(C-n)/(C-e);break}C=e,q=o}return 0===d.feed_stage&&(d.feed_stage=1),d.stages=z,d.xb_actual=C,{plotData:c,results:d,floatStageNum:F,isAzeoError:p,x_azeo:y}}c.addEventListener("change",e=>{const t=e.target.value;"methanol_water"===t?d.innerHTML="<b>System:</b> Methanol-Water @ 1 atm (VLE 데이터 기반)":"user_input"===t&&u&&(u.classList.remove("hidden"),function(){y.innerHTML="";const e=document.createElement("div");e.className="vle-row",e.innerHTML='\n        <label>x (Liquid):</label>\n        <input type="number" step="any" min="0" max="1" value="0.0" class="vle-x" required>\n        <label>y (Vapor):</label>\n        <input type="number" step="any" min="0" max="1" value="0.0" class="vle-y" required>\n        <button type="button" class="remove-vle-row" style="visibility: hidden;">-</button>\n    ',y.appendChild(e);const t=document.createElement("div");t.className="vle-row",t.innerHTML='\n        <label>x (Liquid):</label>\n        <input type="number" step="any" min="0" max="1" value="1.0" class="vle-x" required>\n        <label>y (Vapor):</label>\n        <input type="number" step="any" min="0" max="1" value="1.0" class="vle-y" required>\n        <button type="button" class="remove-vle-row" style="visibility: hidden;">-</button>\n    ',y.appendChild(t),v()}())}),x&&x.addEventListener("click",()=>{f(),c&&(c.value="methanol_water")}),p&&p.addEventListener("click",async function(){if(!y)return;const e=[],t=y.querySelectorAll(".vle-row");for(const n of t){const t=n.querySelector(".vle-x"),o=n.querySelector(".vle-y"),a=parseFloat(t.value),l=parseFloat(o.value);e.push({x:a,y:l})}if(!function(e){const t=document.getElementById("comp_name_A"),n=document.getElementById("comp_name_B"),o=document.getElementById("vle_source_input");if(!t||!t.value||""===t.value.trim())return alert("Validation Error: Component A name cannot be empty. Please fill in the component name."),t.focus(),!1;if(!n||!n.value||""===n.value.trim())return alert("Validation Error: Component B name cannot be empty. Please fill in the component name."),n.focus(),!1;if(!o||!o.value||""===o.value.trim())return alert("Validation Error: Source/Remarks field cannot be empty. Please provide a source, link, or brief remark."),o.focus(),!1;if(e.find(e=>isNaN(e.x)||isNaN(e.y)))return alert("Validation Error: Invalid number input. Please ensure all x and y fields contain valid numerical data."),!1;const a=e.find(e=>e.x<0||e.x>1||e.y<0||e.y>1);if(a)return alert(`Validation Error: Out of range input. Both x (${a.x.toFixed(3)}) and y (${a.y.toFixed(3)}) components must be between 0 and 1.`),!1;const l=e[0],r=e[e.length-1];if(Math.abs(l.x)>1e-10||Math.abs(l.y)>1e-10||Math.abs(r.x-1)>1e-10||Math.abs(r.y-1)>1e-10)return alert("Validation Error: Invalid boundary points. The first point must be (0.0, 0.0) and the last point must be (1.0, 1.0). (Floating point precision error detected)"),!1;const i=e.map(e=>e.x),s=[...i].sort((e,t)=>e-t);for(let e=0;e<i.length;e++){if(e>0&&Math.abs(i[e]-i[e-1])<1e-10)return alert(`Validation Error: Invalid x components. Duplicate liquid composition (x = ${i[e].toFixed(3)}) found. VLE data must have unique x values.`),!1;if(Math.abs(i[e]-s[e])>1e-10)return alert("Validation Error: VLE data must be sorted by the liquid composition (x value). Please ensure your x values are strictly increasing."),!1}return e.length<=5&&alert(`Warning: The number of data points (${e.length}) is very low. VLE curve accuracy may be compromised. Using more data points (e.g., > 10) is recommended.`),!0}(e))return;const n=[...e].sort((e,t)=>e.x-t.x),a=document.getElementById("comp_name_A"),l=document.getElementById("comp_name_B"),i=document.getElementById("vle_source_input"),s=`${a.value.trim()}-${l.value.trim()}`,c={vle_type:"Distillation",vle_component_num:2,system_name:s,component_a:a.value.trim(),component_b:l.value.trim(),vle_points:n,vle_source:i.value.trim()};try{const e=await fetch("https://pslozmvfdrppmmvsnpff.supabase.co/rest/v1/systems",{method:"POST",headers:{"Content-Type":"application/json",apikey:o,Authorization:`Bearer ${o}`,Prefer:"return=representation"},body:JSON.stringify(c)});if(!e.ok){const t=await e.json();throw new Error(`Supabase Error: ${t.message||e.statusText}`)}await e.json(),b=n,r(b),f(),alert(`Success: ${n.length} Custom VLE data points for ${s} have been saved to the database and will be used for calculation.`),d&&(d.innerHTML=`<b>System:</b> ${s} (Custom VLE, DB Connected) <br><b>Assumptions:</b> Total Condenser, Partial Reboiler`)}catch(e){return console.error("DB 전송 오류:",e),void alert(`DB Save Error: Failed to save VLE data. Please check your Supabase connection and console (F12) for details.\n${e.message}`)}}),m&&m.addEventListener("click",()=>{!function(e=.5,t=.5){if(!y)return;const n=document.createElement("div");n.className="vle-row",n.innerHTML=`\n        <label>x (Liquid):</label>\n        <input type="number" step="any" min="0" max="1" value="${e}" class="vle-x" required>\n        <label>y (Vapor):</label>\n        <input type="number" step="any" min="0" max="1" value="${t}" class="vle-y" required>\n        <button type="button" class="remove-vle-row">-</button>\n    `;const o=y.querySelectorAll(".vle-row"),a=o.length>0?o[o.length-1]:null;a?y.insertBefore(n,a):y.appendChild(n),v()}()}),y&&y.addEventListener("click",e=>{e.target.classList.contains("remove-vle-row")&&(e.target.closest(".vle-row").remove(),v())});var _=n(106);let E=null;const I=document.getElementById("calc-form"),L=document.getElementById("mccabeThieleChart"),w=document.getElementById("results-text"),B=L.getContext("2d");function C(){try{const e=new s,{plotData:t,results:n,floatStageNum:o,isAzeoError:a,x_azeo:l}=g(e);if(a){const t=`Azeotrope Error: Desired distillate composition (xd = ${e.xd.toFixed(3)}) exceeds the azeotropic point (x_azeo = ${l}). Separation to this purity is physically impossible.`;return alert(t),w.textContent=`Calculation Error:\n${t}`,void(E&&E.destroy())}!function(e,t){document.getElementById("results_Rmin").textContent=e.R_min.toFixed(3),document.getElementById("results_Rreal").textContent=e.R.toFixed(3),document.getElementById("results_Rfactor").textContent=document.getElementById("r_factor").value,document.getElementById("results_Nstage").textContent=e.stages,document.getElementById("results_Nstage_float").textContent=t.toFixed(1),document.getElementById("results_Fstage").textContent=e.feed_stage}(n,o),function(e){const t=[{label:"Ideal Equilibrium (VLE)",data:e.ideal_eq_curve,borderColor:"blue",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"Effective Eq. (Rectifying)",data:e.effective_curve,borderColor:"#00c000",borderDash:[5,5],borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"y = x",data:e.line_45,borderColor:"grey",borderWidth:1,pointRadius:0,showLine:!0,type:"line"},{label:"q-Line",data:e.q_line,borderColor:"orange",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"ESOL",data:e.esol_line,borderColor:"#6a5acd",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"SSOL",data:e.ssol_line,borderColor:"#6a5acd",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},...e.steps.map(e=>({type:"line",data:e,borderColor:"#FF6384",borderWidth:1.5,pointRadius:0,fill:!1,showLine:!0,showInLegend:!1}))];E&&E.destroy(),E=new _.t1(B,{type:"scatter",data:{datasets:t},options:{plugins:{title:{display:!0,text:"McCabe-Thiele Plot (Methanol-Water @ 1 atm)",font:{size:18}},legend:{position:"bottom",labels:{filter:e=>!!e.text}},tooltip:{callbacks:{label:e=>{const t=e.raw;return`${e.dataset.label}: (x: ${t.x.toFixed(3)}, y: ${t.y.toFixed(3)})`}}}},scales:{x:{type:"linear",position:"bottom",title:{display:!0,text:"Liquid Mole Fraction (x)"},min:0,max:1},y:{type:"linear",title:{display:!0,text:"Vapor Mole Fraction (y)"},min:0,max:1}},aspectRatio:1,animation:!1,parsing:!1}})}(t)}catch(e){console.error("McCabe-Thiele 계산 중 오류 발생:",e),alert(`계산에 실패했습니다: ${e.message}\n콘솔(F12)에서 자세한 내용을 확인하세요.`),w.textContent=`계산 오류:\n${e.message}`}}_.t1.register(_.kc,_.FN,_.No,_.ZT,_.dN,_.m_,_.s$,_.hE,_.Pz),I.addEventListener("submit",e=>{e.preventDefault(),C()}),document.addEventListener("DOMContentLoaded",()=>{console.log("페이지 로드 완료. 기본값으로 첫 계산을 실행합니다."),C()})}},e=>{e.O(0,[106],()=>e(e.s=940)),e.O()}]);
//# sourceMappingURL=main.4bbe649e626231d736a7.js.map
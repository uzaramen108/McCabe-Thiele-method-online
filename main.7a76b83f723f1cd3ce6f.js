"use strict";(self.webpackChunkmccabe_thiele_method_online=self.webpackChunkmccabe_thiele_method_online||[]).push([[792],{374:(e,t,n)=>{let l=[];const a=[{x:0,y:0},{x:.012,y:.068},{x:.02,y:.121},{x:.026,y:.159},{x:.033,y:.188},{x:.036,y:.215},{x:.053,y:.275},{x:.076,y:.366},{x:.1,y:.438},{x:.12,y:.485},{x:.14,y:.522},{x:.15,y:.541},{x:.2,y:.605},{x:.3,y:.686},{x:.4,y:.739},{x:.5,y:.779},{x:.6,y:.825},{x:.7,y:.87},{x:.8,y:.915},{x:.9,y:.958},{x:.95,y:.979},{x:1,y:1}];function o(e){if(!Array.isArray(e)||e.length<2)return console.error("VLE Data initialization failed: Data must be an array with at least 2 points."),void(l=a);l=e,console.log(`VLE Data initialized with ${l.length} points.`)}function s(e,t){if(e<=0)return 0;if(e>=1)return 1;if(t)return e*t/(1+(t-1)*e);let n=l[0],a=l[1];for(let t=1;t<l.length;t++)if(l[t].x>=e){n=l[t-1],a=l[t];break}const o=(a.y-n.y)/(a.x-n.x);return n.y+(e-n.x)*o}o(a);const r="vle_systems_data";function i(){const e=localStorage.getItem(r);return e?JSON.parse(e):[]}function d(e){localStorage.setItem(r,JSON.stringify(e))}class c{xd;xb;zf;q;r_factor;nm;sc;alpha;constructor(){this.xd=parseFloat(document.getElementById("xd").value),this.xb=parseFloat(document.getElementById("xb").value),this.zf=parseFloat(document.getElementById("zf").value),this.q=parseFloat(document.getElementById("q").value),this.r_factor=parseFloat(document.getElementById("r_factor").value),this.nm=parseFloat(document.getElementById("nm").value),this.sc=parseFloat(document.getElementById("sub_cooling").value);const e=document.getElementById("system_select"),t=e&&"ideal_binary"===e.value;this.alpha=t?parseFloat(document.getElementById("alpha_value").value):null,this.validate()}validate(){return[this.xd,this.xb,this.zf,this.q,this.r_factor,this.nm,this.sc,this.alpha].some(e=>isNaN(e))?(alert("유효하지 않은 입력값이 있습니다. 숫자만 입력해주세요."),!1):null!==this.alpha&&(isNaN(this.alpha)||this.alpha<=1)?(alert("상대휘발도(α)는 1.0보다 커야 합니다."),!1):((this.xd<=this.zf||this.zf<=this.xb)&&console.warn("경고: 조성 순서가 일반적이지 않습니다 (xd > zf > xb)."),!0)}}const u=document.getElementById("system_select"),m=document.getElementById("system_for_delete_select"),y=document.getElementById("delete-vle-btn"),h=document.querySelector(".description"),p=document.getElementById("vle-input-modal"),b=document.getElementById("add-vle-row-btn"),v=document.getElementById("vle-data-list"),f=document.getElementById("save-vle-btn"),x=document.getElementById("cancel-vle-btn"),_=document.getElementById("data-management-modal"),g=document.getElementById("manage-vle-data-btn"),E=document.getElementById("close-data-management-modal-btn"),I=document.getElementById("add-new-vle-data-btn"),L=document.getElementById("alpha-container");let B=[];function w(){const e=i();if(u){const t=u.value;u.innerHTML="";const n=document.createElement("option");n.value="ideal_binary",n.textContent="Ideal Binary System (Relative Volatility α)",u.appendChild(n);const l=document.createElement("option");l.value="methanol_water",l.textContent="Methanol-Water (Default)",u.appendChild(l),e.forEach(e=>{const t=document.createElement("option");t.value=e.system_id,t.textContent=e.system_name,u.appendChild(t)}),t&&("methanol_water"===t||e.find(e=>e.system_id===t))&&(u.value=t)}!function(e){if(m)if(m.innerHTML="",0===e.length){const e=document.createElement("option");e.textContent="저장된 데이터가 없습니다.",e.disabled=!0,m.appendChild(e),y&&(y.disabled=!0)}else y&&(y.disabled=!1),e.forEach(e=>{const t=document.createElement("option");t.value=e.system_id,t.textContent=e.system_name,m.appendChild(t)})}(e)}function C(){p&&p.classList.add("hidden"),_&&_.classList.remove("hidden")}function M(){if(!v)return;const e=Array.from(v.querySelectorAll(".vle-row"));e.forEach((t,n)=>{const l=t.querySelector(".remove-vle-row");l&&(l.style.visibility=0===n||n===e.length-1?"hidden":"visible")})}function S(e,t){if(t<=e[0].y)return e[0].x;if(t>=e[e.length-1].y)return e[e.length-1].x;let n=0,l=e.length-1,a=e[n],o=e[l];for(;l-n>1;){let a=Math.floor((n+l)/2);e[a].y<t?n=a:l=a}a=e[n],o=e[l];const s=(o.x-a.x)/(o.y-a.y);return a.x+(t-a.y)*s}function q(e){const{xd:t,xb:n,zf:l,q:a,r_factor:o,nm:r,sc:i}=e,d={ideal_eq_curve:[],line_45:[{x:0,y:0},{x:1,y:1}],q_line:[],esol_line:[],ssol_line:[],steps:[],effective_curve:[]},c={R_min:0,R:0,stages:0,feed_stage:0,xb_actual:0},{x:u,y:m}=function(e,t,n){if(Math.abs(e-1)<1e-6)return{x:t,y:s(t,n)};if(Math.abs(e)<1e-6){const e=function(e,t){let n,l=0,a=1;for(let o=0;o<30;o++)n=(l+a)/2,s(n,t)<e?l=n:a=n;return(l+a)/2}(t,n);return{x:e,y:t}}const l=e/(e-1),a=-t/(e-1),o=e=>s(e,n)-(e=>l*e+a)(e);let r,i=0,d=1;for(let e=0;e<30;e++)r=(i+d)/2,o(r)<0?i=r:d=r;const c=(i+d)/2;return{x:c,y:s(c,n)}}(a,l,e.alpha),y=function(){const e=(e,t)=>s(e,t)-e,t=[],n=1e-6;let l=0,a=e(l);for(let o=1;o<=1e3;o++){let s=Math.min(1,.001*o),r=e(s);if(Math.abs(l)<n||Math.abs(s-1)<n)l=s,a=r;else{if(a*r<0){let a=l,o=s;for(let t=0;t<30;t++){let t=(a+o)/2;if(0===e(t)||o-a<n){a=t;break}e(t)*e(a)<0?o=t:a=t}const r=(a+o)/2;(0===t.length||Math.abs(t[t.length-1]-r)>n)&&t.push(r)}l=s,a=r}}return t}();let h=!1;const p=[];if(y.length>0){const e=Math.min(t,n),l=Math.max(t,n);y.forEach(t=>{t>e&&t<l&&(h=!0,p.push(t))})}if(h)return{plotData:{},results:{},floatStageNum:0,isAzeoError:!0,x_azeo_list:p.map(e=>e.toFixed(3)).join(", ")};const b=(t-m)/(t-u);c.R_min=b/(1-b),c.R=c.R_min*o;let v=c.R;const f=1+81.6*i/35270;v=c.R*f;const x=v/(v+1),_=t/(v+1);let g,E;Math.abs(a-1)<1e-6?(g=l,E=x*g+_):(g=(_- -l/(a-1))/(a/(a-1)-x),E=x*g+_);const I=(E-n)/(g-n),L=n-I*n;d.q_line=[{x:l,y:l},{x:u,y:m}],d.esol_line=[{x:t,y:t},{x:g,y:E}],d.ssol_line=[{x:n,y:n},{x:g,y:E}];const B=e=>x*e+_,w=e=>I*e+L;for(let t=0;t<=100;t++){const n=t/100,l=s(n,e.alpha);d.ideal_eq_curve.push({x:n,y:l});const a=B(n),o=a+r*(l-a);n>g&&d.effective_curve.push({x:n,y:o});const i=w(n),c=i+r*(l-i);n<=g&&d.effective_curve.push({x:n,y:c})}let C=t,M=t,q=0,R=0;for(;C>n&&q<200;){let e;q++;const t=M;let l;if(e=S(d.effective_curve,M),e>g?l=B(e):(l=w(e),0===c.feed_stage&&(c.feed_stage=q)),d.steps.push([{x:C,y:t},{x:e,y:t}]),d.steps.push([{x:e,y:t},{x:e,y:l}]),e<n){R=q+(C-n)/(C-e);break}C=e,M=l}return 0===c.feed_stage&&(c.feed_stage=1),c.stages=q,c.xb_actual=C,{plotData:d,results:c,floatStageNum:R,isAzeoError:h,x_azeo_array:y}}w(),u&&u.addEventListener("change",async function(e){const t=e.target.value;if("ideal_binary"===t)return L&&L.classList.remove("hidden"),void(h&&(h.innerHTML="<b>System:</b> Ideal Binary<br><b>Method:</b> Relative Volatility (α)"));L&&L.classList.add("hidden"),"methanol_water"===t?(o(a),B=a,h&&(h.innerHTML="<b>System:</b> Methanol-Water<br><b>Assumptions:</b> Total Condenser, Partial Reboiler")):function(e){try{const t=i().find(t=>t.system_id===e);if(!t)throw new Error("Data not found");o(t.vle_points),B=t.vle_points,h&&(h.innerHTML=`<b>System:</b> ${t.system_name}<br><b>Source:</b> ${t.vle_source}`)}catch(e){console.error(e),alert("데이터를 불러오는데 실패했습니다. 기본값으로 돌아갑니다."),o(a),u&&(u.value="methanol_water")}}(t)}),g&&g.addEventListener("click",()=>{w(),_.classList.remove("hidden")}),E&&E.addEventListener("click",()=>_.classList.add("hidden")),I&&I.addEventListener("click",()=>{_.classList.add("hidden"),p&&(p.classList.remove("hidden"),function(){if(!v)return;v.innerHTML="";const e=document.createElement("div");e.className="vle-row",e.innerHTML='<label>x:</label><input type="number" value="0.0" class="vle-x" readonly><label>y:</label><input type="number" value="0.0" class="vle-y" readonly><button class="remove-vle-row" style="visibility:hidden">-</button>',v.appendChild(e);const t=document.createElement("div");t.className="vle-row",t.innerHTML='<label>x:</label><input type="number" value="1.0" class="vle-x" readonly><label>y:</label><input type="number" value="1.0" class="vle-y" readonly><button class="remove-vle-row" style="visibility:hidden">-</button>',v.appendChild(t),M()}())}),y&&y.addEventListener("click",function(){const e=document.getElementById("system_for_delete_select"),t=(document.getElementById("delete-vle-btn"),document.getElementById("system_select"));if(!e||!e.value)return void alert("삭제할 시스템을 선택해주세요.");const n=e.value,l=e.options[e.selectedIndex].text;if(confirm(`[경고] 정말로 '${l}' 데이터를 삭제하시겠습니까?\n이 작업은 되돌릴 수 없으며, 브라우저 저장소에서 영구적으로 삭제됩니다.`))try{if(d(i().filter(e=>e.system_id!==n)),alert("데이터가 성공적으로 삭제되었습니다."),w(),t&&t.value===n){alert("현재 보고 있던 데이터가 삭제되어, 기본값(Methanol-Water)으로 전환됩니다."),t.value="methanol_water",o(a),L&&L.classList.add("hidden");const e=document.querySelector(".description");e&&(e.innerHTML="<b>System:</b> Methanol-Water<br><b>Assumptions:</b> Total Condenser, Partial Reboiler")}}catch(e){console.error("Delete Error:",e),alert(`삭제 중 오류가 발생했습니다.\n${e.message}`)}}),x&&x.addEventListener("click",C),f&&f.addEventListener("click",function(){const e=v.querySelectorAll(".vle-row"),t=[];if(e.forEach(e=>{t.push({x:parseFloat(e.querySelector(".vle-x").value),y:parseFloat(e.querySelector(".vle-y").value)})}),!function(e){const t=document.getElementById("comp_name_A").value,n=document.getElementById("comp_name_B").value,l=document.getElementById("vle_source_input").value;return t&&n&&l?!(e.length<2)||(alert("최소 2개 이상의 데이터 포인트가 필요합니다."),!1):(alert("성분명/출처는 필수 입력 항목입니다."),!1)}(t))return;t.sort((e,t)=>e.x-t.x);const n=document.getElementById("comp_name_A").value.trim(),l=document.getElementById("comp_name_B").value.trim(),a=document.getElementById("vle_source_input").value.trim(),s=`${n}-${l}`,r="loc_"+Date.now()+Math.floor(1e3*Math.random()),c={system_id:r,system_name:s,component_a:n,component_b:l,vle_points:t,vle_source:a,created_at:(new Date).toISOString()};try{const e=i();e.push(c),d(e),B=t,o(B),C(),alert(`저장 완료! '${s}' 시스템이 브라우저에 저장되었습니다.`),w(),u&&(u.value=r,h&&(h.innerHTML=`<b>System:</b> ${s}<br><b>Source:</b> ${a}`))}catch(e){console.error(e),alert("저장 중 오류가 발생했습니다 (저장 공간 부족 등): "+e.message)}}),b&&b.addEventListener("click",()=>function(e=.5,t=.5){if(!v)return;const n=document.createElement("div");n.className="vle-row",n.innerHTML=`\n        <label>x:</label><input type="number" step="any" min="0" max="1" value="${e}" class="vle-x" required>\n        <label>y:</label><input type="number" step="any" min="0" max="1" value="${t}" class="vle-y" required>\n        <button type="button" class="remove-vle-row">-</button>\n    `;const l=v.querySelectorAll(".vle-row"),a=l.length>0?l[l.length-1]:null;a?v.insertBefore(n,a):v.appendChild(n),M()}()),v&&v.addEventListener("click",e=>{e.target.classList.contains("remove-vle-row")&&(e.target.closest(".vle-row").remove(),M())});var R=n(106);let F=null;const z=document.getElementById("calc-form"),$=document.getElementById("mccabeThieleChart"),k=document.getElementById("results-text"),N=$.getContext("2d");function T(){try{const e=new c,{plotData:t,results:n,floatStageNum:l,isAzeoError:a,x_azeo_array:o}=q(e);if(a){const t=`Azeotrope Error: Desired distillate composition (xd = ${e.xd.toFixed(3)}) exceeds the azeotropic point (x_azeo = ${o}). Separation to this purity is physically impossible.`;return alert(t),k.textContent=`Calculation Error:\n${t}`,void(F&&F.destroy())}!function(e,t){document.getElementById("results_Rmin").textContent=e.R_min.toFixed(3),document.getElementById("results_Rreal").textContent=e.R.toFixed(3),document.getElementById("results_Rfactor").textContent=document.getElementById("r_factor").value,document.getElementById("results_Nstage").textContent=e.stages,document.getElementById("results_Nstage_float").textContent=t.toFixed(1),document.getElementById("results_Fstage").textContent=e.feed_stage}(n,l),function(e){const t=[{label:"Ideal Equilibrium (VLE)",data:e.ideal_eq_curve,borderColor:"blue",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"Effective Eq. (Rectifying)",data:e.effective_curve,borderColor:"#00c000",borderDash:[5,5],borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"y = x",data:e.line_45,borderColor:"grey",borderWidth:1,pointRadius:0,showLine:!0,type:"line"},{label:"q-Line",data:e.q_line,borderColor:"orange",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"ESOL",data:e.esol_line,borderColor:"#6a5acd",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"SSOL",data:e.ssol_line,borderColor:"#6a5acd",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},...e.steps.map(e=>({type:"line",data:e,borderColor:"#FF6384",borderWidth:1.5,pointRadius:0,fill:!1,showLine:!0,showInLegend:!1}))];F&&F.destroy(),F=new R.t1(N,{type:"scatter",data:{datasets:t},options:{plugins:{title:{display:!0,text:"McCabe-Thiele Plot (Methanol-Water @ 1 atm)",font:{size:18}},legend:{position:"bottom",labels:{filter:e=>!!e.text}},tooltip:{callbacks:{label:e=>{const t=e.raw;return`${e.dataset.label}: (x: ${t.x.toFixed(3)}, y: ${t.y.toFixed(3)})`}}}},scales:{x:{type:"linear",position:"bottom",title:{display:!0,text:"Liquid Mole Fraction (x)"},min:0,max:1},y:{type:"linear",title:{display:!0,text:"Vapor Mole Fraction (y)"},min:0,max:1}},aspectRatio:1,animation:!1,parsing:!1}})}(t)}catch(e){console.error("McCabe-Thiele 계산 중 오류 발생:",e),alert(`계산에 실패했습니다: ${e.message}\n콘솔(F12)에서 자세한 내용을 확인하세요.`),k.textContent=`계산 오류:\n${e.message}`}}R.t1.register(R.kc,R.FN,R.No,R.ZT,R.dN,R.m_,R.s$,R.hE,R.Pz),z.addEventListener("submit",e=>{e.preventDefault(),T()}),document.addEventListener("DOMContentLoaded",()=>{console.log("페이지 로드 완료. 기본값으로 첫 계산을 실행합니다."),T()})}},e=>{e.O(0,[106],()=>e(e.s=374)),e.O()}]);
//# sourceMappingURL=main.7a76b83f723f1cd3ce6f.js.map
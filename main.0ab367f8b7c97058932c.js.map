{"version":3,"file":"main.0ab367f8b7c97058932c.js","mappings":"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","sources":["webpack://mccabe-thiele-method-online/./src/resources/js/ui.js","webpack://mccabe-thiele-method-online/./src/resources/js/eq_line.js","webpack://mccabe-thiele-method-online/./src/resources/js/mccabe-thiele.js","webpack://mccabe-thiele-method-online/./src/resources/js/main.js"],"sourcesContent":["/**\n * ui.js\n * Read input from index.html\n * Show output from mccabe-thiele.js to index.html\n */\n\nexport class Variable {\n  xd;\n  xb;\n  zf;\n  q;\n  r_factor;\n  nm;\n  sc;\n\n  constructor() {\n    // Used parseFloat() for shifting string(.value) to number\n    //@ts-ignore\n    this.xd = parseFloat(document.getElementById(\"xd\").value);\n    //@ts-ignore\n    this.xb = parseFloat(document.getElementById(\"xb\").value);\n    //@ts-ignore\n    this.zf = parseFloat(document.getElementById(\"zf\").value);\n    //@ts-ignore\n    this.q = parseFloat(document.getElementById(\"q\").value);\n    //@ts-ignore\n    this.r_factor = parseFloat(document.getElementById(\"r_factor\").value);\n    //@ts-ignore\n    this.nm = parseFloat(document.getElementById(\"nm\").value);\n    //@ts-ignore\n    this.sc = parseFloat(document.getElementById(\"sub_cooling\").value);\n    this.validate();\n  }\n\n  /**\n   * @returns {boolean} - 모든 값이 유효하면 true, 아니면 false\n   */\n  validate() {\n    const allValues = [\n      this.xd,\n      this.xb,\n      this.zf,\n      this.q,\n      this.r_factor,\n      this.nm,\n      this.sc,\n    ];\n    if (allValues.some((val) => isNaN(val))) {\n      console.error(\"입력값 오류: 일부 값이 숫자가 아닙니다 (NaN).\", this);\n      alert(\"유효하지 않은 입력값이 있습니다. 숫자만 입력해주세요.\");\n      return false;\n    }\n    if (this.xd <= this.zf || this.zf <= this.xb) {\n      console.warn(\n        `입력값 경고: 조성 순서가 올바르지 않습니다 (xd > zf > xb 여야 함). xd=${this.xd}, zf=${this.zf}, xb=${this.xb}`,\n      );\n    }\n    return true;\n  }\n}\n","// (메탄올-물 @ 1 atm)\nconst METHANOL_VLE_DATA = [\n  { x: 0.0, y: 0.0 },\n  { x: 0.012, y: 0.068 },\n  { x: 0.02, y: 0.121 },\n  { x: 0.026, y: 0.159 },\n  { x: 0.033, y: 0.188 },\n  { x: 0.036, y: 0.215 },\n  { x: 0.053, y: 0.275 },\n  { x: 0.076, y: 0.366 },\n  { x: 0.1, y: 0.438 },\n  { x: 0.12, y: 0.485 },\n  { x: 0.14, y: 0.522 },\n  { x: 0.15, y: 0.541 },\n  { x: 0.2, y: 0.605 },\n  { x: 0.3, y: 0.686 },\n  { x: 0.4, y: 0.739 },\n  { x: 0.5, y: 0.779 },\n  { x: 0.6, y: 0.825 },\n  { x: 0.7, y: 0.87 },\n  { x: 0.8, y: 0.915 },\n  { x: 0.9, y: 0.958 },\n  { x: 0.95, y: 0.979 },\n  { x: 1.0, y: 1.0 },\n];\n\n/**\n * @param {number} x_in - 액상 몰분율\n * @returns {number} - 기상 몰분율 (y), 빈 곳으로 선형 플롯\n */\nexport function getIdealEquilibriumY(x_in) {\n  if (x_in <= 0) return 0;\n  if (x_in >= 1) return 1;\n  let p1 = METHANOL_VLE_DATA[0];\n  let p2 = METHANOL_VLE_DATA[1];\n\n  for (let i = 1; i < METHANOL_VLE_DATA.length; i++) {\n    if (METHANOL_VLE_DATA[i].x >= x_in) {\n      p1 = METHANOL_VLE_DATA[i - 1];\n      p2 = METHANOL_VLE_DATA[i];\n      break;\n    }\n  }\n\n  const slope = (p2.y - p1.y) / (p2.x - p1.x);\n  const y_out = p1.y + (x_in - p1.x) * slope;\n\n  return y_out;\n}\n","/**\n * mccabe-thiele.js\n * Main logic for McCabe-Thiele\n * Use equilibrium line from 'eq_line.js'\n * Murphree efficiency is calculated between actual equilibrium line and operating line\n * (y_effective = y_op + nm * (y_ideal - y_op))\n * Seperated operating line into rectifying section and stripping section.\n */\n\nimport { getIdealEquilibriumY } from \"./eq_line.js\";\nimport { Variable } from \"./ui.js\";\n\n/**\n * Return x' when q = 0 (수평선)\n * (q-line 플로팅 및 R_min 계산에 사용됨)\n */\nfunction ideal_eq2(y_target) {\n  let low = 0.0;\n  let high = 1.0;\n  let mid_xa;\n  for (let i = 0; i < 30; i++) {\n    mid_xa = (low + high) / 2;\n    const y_guess = getIdealEquilibriumY(mid_xa);\n    if (y_guess < y_target) {\n      low = mid_xa;\n    } else {\n      high = mid_xa;\n    }\n  }\n  return (low + high) / 2;\n}\n\n/**\n * q-line actual equilibrium line의 교차점을 찾기 (q-line 플로팅 및 R_min 계산용).\n */\nfunction find_q_ideal_eq_intersect(q, zf) {\n  if (Math.abs(q - 1.0) < 1e-6) {\n    // q = 1 (수직선)\n    const x_intersect = zf;\n    const y_intersect = getIdealEquilibriumY(zf);\n    return { x: x_intersect, y: y_intersect };\n  }\n  if (Math.abs(q) < 1e-6) {\n    // q = 0 (수평선)\n    const x_intersect = ideal_eq2(zf);\n    const y_intersect = zf;\n    return { x: x_intersect, y: y_intersect };\n  }\n\n  const q_slope = q / (q - 1);\n  const q_intercept = -zf / (q - 1);\n  const q_line = (x) => q_slope * x + q_intercept;\n  const f = (x) => getIdealEquilibriumY(x) - q_line(x);\n\n  let low = 0.0,\n    high = 1.0,\n    mid_x;\n  for (let i = 0; i < 30; i++) {\n    mid_x = (low + high) / 2;\n    if (f(mid_x) < 0) {\n      low = mid_x;\n    } else {\n      high = mid_x;\n    }\n  }\n  const x_intersect = (low + high) / 2;\n  const y_intersect = getIdealEquilibriumY(x_intersect);\n\n  return { x: x_intersect, y: y_intersect };\n}\n\n/**\n * @param {array} dataArray\n * @param {number} y_target\n * @returns {number}\n */\nfunction find_x_from_data(dataArray, y_target) {\n  // Is target end of data?\n  if (y_target <= dataArray[0].y) return dataArray[0].x;\n  if (y_target >= dataArray[dataArray.length - 1].y)\n    return dataArray[dataArray.length - 1].x;\n\n  let low = 0;\n  let high = dataArray.length - 1;\n  let p1 = dataArray[low];\n  let p2 = dataArray[high];\n\n  while (high - low > 1) {\n    let mid = Math.floor((low + high) / 2);\n    if (dataArray[mid].y < y_target) {\n      low = mid;\n    } else {\n      high = mid;\n    }\n  }\n  p1 = dataArray[low];\n  p2 = dataArray[high];\n\n  // 데이터 사이를 선형으로 메꿈\n  const slope_inv = (p2.x - p1.x) / (p2.y - p1.y);\n  const x_out = p1.x + (y_target - p1.y) * slope_inv;\n\n  return x_out;\n}\n\n/**\n * McCabe-Thiele 계산을 수행하는 메인 함수\n * @param {Variable} variables - ui.js에서 생성된 Variable class\n * @returns {object}\n */\nexport function calculateMcCabeThiele(variables) {\n  const { xd, xb, zf, q, r_factor, nm, sc } = variables;\n  const plotData = {\n    ideal_eq_curve: [],\n    line_45: [\n      { x: 0, y: 0 },\n      { x: 1, y: 1 },\n    ],\n    q_line: [],\n    esol_line: [],\n    ssol_line: [],\n    steps: [],\n    effective_curve: [],\n  };\n  const results = { R_min: 0, R: 0, stages: 0, feed_stage: 0, xb_actual: 0 };\n  const { x: q_ideal_eq_x, y: q_ideal_eq_y } = find_q_ideal_eq_intersect(q, zf);\n\n  const r_min_slope = (xd - q_ideal_eq_y) / (xd - q_ideal_eq_x);\n  results.R_min = r_min_slope / (1 - r_min_slope); // 최소 환류비\n\n  results.R = results.R_min * r_factor; // 실제 환류비\n\n  let R_internal = results.R;\n\n  const CP_LIQUID = 81.6; // 메탄올 액체 열용량 (J/mol·K)\n  const LATENT_HEAT = 35270; // 메탄올 기화 잠열 (J/mol)\n  const DELTA_T = sc; // 과냉각\n\n  // 과냉각 보정 계수 (F > 1)\n  // 차가운 환류가 증기를 추가 응축시켜 내부 유량을 증가시킴\n  const F_factor = 1 + (CP_LIQUID * DELTA_T) / LATENT_HEAT; // 엔탈피 수지식을 토대로 구함\n\n  // 조작선 그리기용 '내부 환류비' 갱신\n  R_internal = results.R * F_factor;\n\n  const esol_slope = R_internal / (R_internal + 1); // 정류부 operating line 기울기\n  const esol_intercept = xd / (R_internal + 1); // 정류부 operating line 절편\n\n  let q_esol_intersect_x, q_esol_intersect_y;\n  if (Math.abs(q - 1.0) < 1e-6) {\n    q_esol_intersect_x = zf;\n    q_esol_intersect_y = esol_slope * q_esol_intersect_x + esol_intercept;\n  } else {\n    const q_slope = q / (q - 1);\n    const q_intercept = -zf / (q - 1);\n    q_esol_intersect_x =\n      (esol_intercept - q_intercept) / (q_slope - esol_slope);\n    q_esol_intersect_y = esol_slope * q_esol_intersect_x + esol_intercept;\n  }\n\n  const ssol_slope = (q_esol_intersect_y - xb) / (q_esol_intersect_x - xb); // 탈거부 operating line 기울기\n  const ssol_intercept = xb - ssol_slope * xb; // 탈거부 operating line 절편\n\n  plotData.q_line = [\n    { x: zf, y: zf },\n    { x: q_ideal_eq_x, y: q_ideal_eq_y },\n  ];\n  plotData.esol_line = [\n    { x: xd, y: xd },\n    { x: q_esol_intersect_x, y: q_esol_intersect_y },\n  ];\n  plotData.ssol_line = [\n    { x: xb, y: xb },\n    { x: q_esol_intersect_x, y: q_esol_intersect_y },\n  ];\n\n  const y_op_rect = (x) => esol_slope * x + esol_intercept;\n  const y_op_strip = (x) => ssol_slope * x + ssol_intercept;\n\n  for (let i = 0; i <= 100; i++) {\n    const x = i / 100.0;\n    const y_ideal = getIdealEquilibriumY(x); // Ideal equilibrium(blue)\n\n    plotData.ideal_eq_curve.push({ x: x, y: y_ideal });\n\n    const y_op_r = y_op_rect(x);\n    const y_eff_r = y_op_r + nm * (y_ideal - y_op_r);\n    if (x > q_esol_intersect_x) {\n      plotData.effective_curve.push({ x: x, y: y_eff_r }); // 만약 qline을 안지났다면 rectifying operating line 기준으로, 아니면 stripping으로\n    }\n\n    const y_op_s = y_op_strip(x);\n    const y_eff_s = y_op_s + nm * (y_ideal - y_op_s);\n    if (x <= q_esol_intersect_x) {\n      plotData.effective_curve.push({ x: x, y: y_eff_s });\n    }\n  }\n\n  // stepping, 단수 계산.\n\n  let current_x = xd;\n  let current_y = xd;\n  let stage_count = 0;\n  let floatStageNum = 0;\n  const MAX_STAGES = 200;\n\n  while (current_x > xb && stage_count < MAX_STAGES) {\n    stage_count++;\n\n    let next_x; // 이번 스텝의 '다음 x'\n    const step_start_y = current_y; // 수평선 그리기를 위한 y값 저장\n\n    // 수평 이동\n    next_x = find_x_from_data(plotData.effective_curve, current_y);\n\n    // 수직 이동\n    let next_y;\n    if (next_x > q_esol_intersect_x) {\n      next_y = y_op_rect(next_x);\n    } else {\n      next_y = y_op_strip(next_x);\n\n      if (results.feed_stage === 0) {\n        results.feed_stage = stage_count;\n      }\n    }\n\n    plotData.steps.push([\n      { x: current_x, y: step_start_y },\n      { x: next_x, y: step_start_y },\n    ]); // 수평선\n    plotData.steps.push([\n      { x: next_x, y: step_start_y },\n      { x: next_x, y: next_y },\n    ]); // 수직선\n\n    if (next_x < xb) {\n      floatStageNum = stage_count + (current_x - xb) / (current_x - next_x);\n      break;\n    }\n\n    current_x = next_x;\n    current_y = next_y;\n  }\n\n  if (results.feed_stage === 0) results.feed_stage = 1;\n  results.stages = stage_count;\n  results.xb_actual = current_x;\n\n  return { plotData, results, floatStageNum };\n}\n","/**\n * main.js\n * - Receive event from'index.html'.\n * - Get class 'Variable' from 'ui.js'.\n * - Actual calculation from 'mccabe-thiele.js'.\n * - Draw graph by Chart.js at canvas(html)\n */\n\nimport { Variable } from './ui.js';\nimport { calculateMcCabeThiele } from './mccabe-thiele.js';\nimport '../style.css';\n\nconst calcForm = document.getElementById('calc-form');\nconst chartCanvas = document.getElementById('mccabeThieleChart');\nconst resultsTextElement = document.getElementById('results-text');\n//@ts-ignore\nconst ctx = chartCanvas.getContext('2d');\n\n/**\n * Run calculation and update states\n */\nfunction runCalculation() {\n    try {\n        const variables = new Variable();\n        const { plotData, results, floatStageNum } = calculateMcCabeThiele(variables);\n        renderResults(results, floatStageNum); // print output as text\n        renderPlot(plotData); // print output as plot\n\n    } catch (error) {\n        console.error(\"McCabe-Thiele 계산 중 오류 발생:\", error);\n        alert(`계산에 실패했습니다: ${error.message}\\n콘솔(F12)에서 자세한 내용을 확인하세요.`);\n        resultsTextElement.textContent = `계산 오류:\\n${error.message}`;\n    }\n}\n\n/**\n * print output at HTML <pre> tag\n * @param {object} results\n */\nfunction renderResults(results, floatStageNum) {\n    const outputText = `\n    -- 계산 결과 (Results) --\n    최소 환류비 (R_min)   : ${results.R_min.toFixed(3)}\n    실제 환류비 (R)       : ${results.R.toFixed(3)} (R_min의 ${//@ts-ignore\n    document.getElementById('r_factor').value}배)\n    \n    총 이론 단 수 (Stages): ${results.stages}(${floatStageNum.toFixed(1)}) 단\n    최적 공급 단 (Feed @) : ${results.feed_stage} 번째 단 (from top)\n    \n    실제 하부 조성 (xb_actual): ${results.xb_actual.toFixed(5)}\n    (목표 하부 조성: ${//@ts-ignore \n    document.getElementById('xb').value})\n    `;\n    resultsTextElement.textContent = outputText;\n}\n\n/**\n * [!! 최종 수정된 함수 !!]\n * 계산된 플롯 데이터를 받아 Canvas API로 그래프를 그립니다.\n * @param {object} plotData - mccabe-thiele.js가 반환한 plotData 객체\n */\nfunction renderPlot(plotData) {\n    if (!ctx || !chartCanvas) return;\n\n    // 1. 캔버스 초기화 (Clear)\n    //@ts-ignore\n    ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);\n    \n    // 캔버스 크기를 1:1 비율로 맞춥니다 (CSS aspect-ratio 사용)\n    //@ts-ignore\n    const size = Math.min(chartCanvas.width, chartCanvas.height);\n    const padding = 40;\n    const plotSize = size - 2 * padding;\n    \n    // 좌표 변환 함수: x_comp (0.0 to 1.0) -> screen_x\n    const scaleX = (x) => padding + x * plotSize;\n    const scaleY = (y) => padding + (1.0 - y) * plotSize; // Y축은 캔버스 상단이 0이므로 1.0에서 빼줍니다.\n\n    // 2. 축 그리기 (Axes)\n    ctx.strokeStyle = '#333';\n    ctx.lineWidth = 1;\n    ctx.font = '10px Arial';\n    ctx.textAlign = 'center';\n    \n    // x-축\n    ctx.beginPath();\n    ctx.moveTo(scaleX(0), scaleY(0));\n    ctx.lineTo(scaleX(1), scaleY(0));\n    ctx.stroke();\n\n    // y-축\n    ctx.beginPath();\n    ctx.moveTo(scaleX(0), scaleY(0));\n    ctx.lineTo(scaleX(0), scaleY(1));\n    ctx.stroke();\n\n    // 3. 45도 선 (y=x) 그리기\n    ctx.strokeStyle = 'grey';\n    ctx.beginPath();\n    ctx.moveTo(scaleX(0), scaleY(0));\n    ctx.lineTo(scaleX(1), scaleY(1));\n    ctx.stroke();\n\n    /**\n     * 범용 라인 그리기 함수\n     * @param {Array<{x: number, y: number}>} lineData \n     * @param {string} color \n     * @param {number} width \n     * @param {number[]} [dash]\n     */\n    const drawLine = (lineData, color, width, dash = []) => {\n        ctx.strokeStyle = color;\n        ctx.lineWidth = width;\n        ctx.setLineDash(dash);\n        \n        if (lineData.length === 0) return;\n        \n        ctx.beginPath();\n        ctx.moveTo(scaleX(lineData[0].x), scaleY(lineData[0].y));\n        for (let i = 1; i < lineData.length; i++) {\n            ctx.lineTo(scaleX(lineData[i].x), scaleY(lineData[i].y));\n        }\n        ctx.stroke();\n        ctx.setLineDash([]); // 대시 초기화\n    };\n\n    // 4. 데이터셋 그리기\n\n    // (1) 이상 평형 곡선 (VLE)\n    drawLine(plotData.ideal_eq_curve, 'blue', 2);\n    \n    // (2) Murphree 효율 곡선 (점선)\n    drawLine(plotData.effective_curve, '#00c000', 2, [5, 5]);\n\n    // (3) q-Line\n    drawLine(plotData.q_line, 'orange', 2);\n\n    // (4) 정류부/탈거부 조작선 (ESOL, SSOL)\n    drawLine(plotData.esol_line, '#6a5acd', 2);\n    drawLine(plotData.ssol_line, '#6a5acd', 2);\n\n    // (5) 계단 (Steps) - 각 선분을 별도의 데이터셋으로 추가\n    ctx.strokeStyle = '#FF6384'; // 빨간색\n    ctx.lineWidth = 1.5;\n    \n    plotData.steps.forEach(segment => {\n        if (segment.length === 2) {\n            ctx.beginPath();\n            ctx.moveTo(scaleX(segment[0].x), scaleY(segment[0].y));\n            ctx.lineTo(scaleX(segment[1].x), scaleY(segment[1].y));\n            ctx.stroke();\n        }\n    });\n\n    // 5. 결과 포인트 표시 (xd, xb, zf)\n    const drawPoint = (x, y, color, label) => {\n        const sx = scaleX(x);\n        const sy = scaleY(y);\n        ctx.fillStyle = color;\n        ctx.beginPath();\n        ctx.arc(sx, sy, 4, 0, Math.PI * 2);\n        ctx.fill();\n        ctx.fillStyle = '#000';\n        ctx.textAlign = 'left';\n        ctx.fillText(label, sx + 6, sy);\n    };\n\n    const vars = new Variable(); // 변수 객체를 다시 생성하여 최신 값을 가져옵니다.\n    drawPoint(vars.xd, vars.xd, 'red', `xd (${vars.xd.toFixed(3)})`);\n    drawPoint(vars.xb, vars.xb, 'red', `xb (${vars.xb.toFixed(3)})`);\n    drawPoint(vars.zf, 0, 'black', `zf (${vars.zf.toFixed(3)})`);\n\n    // [TODO: 범례(Legend) 및 라벨링 추가]\n    // 순수 캔버스에서 범례는 수동으로 레이아웃 해야 합니다.\n}\n\ncalcForm.addEventListener('submit', (event) => {\n    event.preventDefault(); \n    runCalculation();\n});\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    console.log(\"페이지 로드 완료. 기본값으로 첫 계산을 실행합니다.\");\n    runCalculation();\n});"],"names":["Variable","xd","xb","zf","q","r_factor","nm","sc","constructor","this","parseFloat","document","getElementById","value","validate","some","val","isNaN","console","error","alert","warn","METHANOL_VLE_DATA","x","y","getIdealEquilibriumY","x_in","p1","p2","i","length","slope","find_x_from_data","dataArray","y_target","low","high","mid","Math","floor","slope_inv","calcForm","chartCanvas","resultsTextElement","ctx","getContext","runCalculation","variables","plotData","results","floatStageNum","ideal_eq_curve","line_45","q_line","esol_line","ssol_line","steps","effective_curve","R_min","R","stages","feed_stage","xb_actual","q_ideal_eq_x","q_ideal_eq_y","abs","x_intersect","mid_xa","ideal_eq2","q_slope","q_intercept","f","mid_x","find_q_ideal_eq_intersect","r_min_slope","R_internal","F_factor","esol_slope","esol_intercept","q_esol_intersect_x","q_esol_intersect_y","ssol_slope","ssol_intercept","y_op_rect","y_op_strip","y_ideal","push","y_op_r","y_eff_r","y_op_s","y_eff_s","current_x","current_y","stage_count","next_x","step_start_y","next_y","calculateMcCabeThiele","outputText","toFixed","textContent","renderResults","clearRect","width","height","size","min","plotSize","scaleX","scaleY","strokeStyle","lineWidth","font","textAlign","beginPath","moveTo","lineTo","stroke","drawLine","lineData","color","dash","setLineDash","forEach","segment","drawPoint","label","sx","sy","fillStyle","arc","PI","fill","fillText","vars","renderPlot","message","addEventListener","event","preventDefault","log"],"ignoreList":[],"sourceRoot":""}
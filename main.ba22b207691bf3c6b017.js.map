{"version":3,"file":"main.ba22b207691bf3c6b017.js","mappings":"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","sources":["webpack://mccabe-thiele-method-online/./src/resources/js/eq_line.js","webpack://mccabe-thiele-method-online/./src/resources/js/ui.js","webpack://mccabe-thiele-method-online/./src/resources/js/mccabe-thiele.js","webpack://mccabe-thiele-method-online/./src/resources/js/main.js"],"sourcesContent":["/**\n * @typedef {{x: number, y: number}} VLEPoint\n */\n\n// VLE 데이터는 모듈 내부 변수에 저장되며, 외부에서 주입 가능\n/** @type {VLEPoint[]} */\nlet VLE_DATA = [];\n\n// [TODO] Methanol-Water 기본 데이터 (초기값으로 사용)\nexport const METHANOL_VLE_DATA = [\n  { x: 0.0, y: 0.0 },\n  { x: 0.012, y: 0.068 },\n  { x: 0.02, y: 0.121 },\n  { x: 0.026, y: 0.159 },\n  { x: 0.033, y: 0.188 },\n  { x: 0.036, y: 0.215 },\n  { x: 0.053, y: 0.275 },\n  { x: 0.076, y: 0.366 },\n  { x: 0.1, y: 0.438 },\n  { x: 0.12, y: 0.485 },\n  { x: 0.14, y: 0.522 },\n  { x: 0.15, y: 0.541 },\n  { x: 0.2, y: 0.605 },\n  { x: 0.3, y: 0.686 },\n  { x: 0.4, y: 0.739 },\n  { x: 0.5, y: 0.779 },\n  { x: 0.6, y: 0.825 },\n  { x: 0.7, y: 0.87 },\n  { x: 0.8, y: 0.915 },\n  { x: 0.9, y: 0.958 },\n  { x: 0.95, y: 0.979 },\n  { x: 1.0, y: 1.0 },\n];\n\n// 모듈 로드 시 기본 데이터로 초기화\ninitializeVLEData(METHANOL_VLE_DATA);\n\n/**\n * 외부에서 VLE 데이터를 주입하여 모듈을 초기화합니다.\n * @param {VLEPoint[]} newVLEData - 정렬된 VLE 포인트 배열\n */\nexport function initializeVLEData(newVLEData) {\n  if (!Array.isArray(newVLEData) || newVLEData.length < 2) {\n    console.error(\n      'VLE Data initialization failed: Data must be an array with at least 2 points.'\n    );\n    VLE_DATA = METHANOL_VLE_DATA; // 오류 시 기본값 유지\n    return;\n  }\n  // [핵심] 외부 데이터를 내부 변수에 저장\n  VLE_DATA = newVLEData;\n  console.log(`VLE Data initialized with ${VLE_DATA.length} points.`);\n}\n\n/**\n * 액상 조성(x_in)에 대한 이상 평형 기상 조성(y)을 계산합니다.\n * 선형 보간(Linear Interpolation)을 사용합니다.\n * @param {number} x_in - 액상 몰분율\n * @returns {number} - 기상 몰분율 (y)\n * @param {number} alpha\n */\nexport function getIdealEquilibriumY(x_in, alpha) {\n  if (x_in <= 0) {\n    return 0;\n  }\n  if (x_in >= 1) {\n    return 1;\n  }\n  if (alpha) {\n    return (x_in * alpha) / (1 + (alpha - 1) * x_in);\n  }\n\n  // [핵심] 내부 변수 VLE_DATA 사용\n  let p1 = VLE_DATA[0];\n  let p2 = VLE_DATA[1];\n\n  for (let i = 1; i < VLE_DATA.length; i++) {\n    if (VLE_DATA[i].x >= x_in) {\n      p1 = VLE_DATA[i - 1];\n      p2 = VLE_DATA[i];\n      break;\n    }\n  }\n\n  const slope = (p2.y - p1.y) / (p2.x - p1.x);\n  const y_out = p1.y + (x_in - p1.x) * slope;\n\n  return y_out;\n}\n","/**\r\n * ui.js\r\n * LocalStorage DB + 3단 데이터 관리(추가/내보내기/삭제) + 물성치 연동\r\n */\r\n\r\nimport { initializeVLEData, METHANOL_VLE_DATA } from './eq_line.js';\r\n\r\n// 데이터를 저장할 로컬 스토리지 키\r\nconst LOCAL_STORAGE_DB_KEY = 'vle_systems_data';\r\n\r\n// 전역 변수: 현재 선택된 시스템의 물성치\r\n// 기본값: Methanol-Water 문헌값\r\nlet currentSystemProps = {\r\n  LK_Cp: 81.6,      \r\n  LK_Latent: 35270, \r\n  HK_Cp: 75.3,      \r\n  HK_Latent: 40660  \r\n};\r\n\r\n// --- Helper Functions for LocalStorage DB ---\r\nfunction getLocalSystems() {\r\n  const data = localStorage.getItem(LOCAL_STORAGE_DB_KEY);\r\n  return data ? JSON.parse(data) : [];\r\n}\r\n\r\nfunction saveLocalSystems(systems) {\r\n  localStorage.setItem(LOCAL_STORAGE_DB_KEY, JSON.stringify(systems));\r\n}\r\n\r\n// --- Variable Class ---\r\nexport class Variable {\r\n  xd; xb; zf; q; r_factor; nm; sc; alpha;\r\n  Cp_LK; Latent_LK; Cp_HK; Latent_HK;\r\n\r\n  constructor() {\r\n    //@ts-ignore\r\n    this.xd = parseFloat(document.getElementById('xd').value);\r\n    //@ts-ignore\r\n    this.xb = parseFloat(document.getElementById('xb').value);\r\n    //@ts-ignore\r\n    this.zf = parseFloat(document.getElementById('zf').value);\r\n    //@ts-ignore\r\n    this.q = parseFloat(document.getElementById('q').value);\r\n    //@ts-ignore\r\n    this.r_factor = parseFloat(document.getElementById('r_factor').value);\r\n    //@ts-ignore\r\n    this.nm = parseFloat(document.getElementById('nm').value);\r\n    //@ts-ignore\r\n    this.sc = parseFloat(document.getElementById('sub_cooling').value);\r\n    \r\n    const systemSelect = document.getElementById('system_select');\r\n    //@ts-ignore\r\n    const isIdealMode = systemSelect && systemSelect.value === 'ideal_binary';\r\n\r\n    if (isIdealMode) {\r\n      //@ts-ignore\r\n      this.alpha = parseFloat(document.getElementById('alpha_value').value);\r\n    } else {\r\n      this.alpha = null;\r\n    }\r\n\r\n    // 전역 변수에서 물성치 가져오기\r\n    this.Cp_LK = currentSystemProps.LK_Cp || 0;\r\n    this.Latent_LK = currentSystemProps.LK_Latent || 0;\r\n    this.Cp_HK = currentSystemProps.HK_Cp || 0;\r\n    this.Latent_HK = currentSystemProps.HK_Latent || 0;\r\n\r\n    this.validate();\r\n  }\r\n\r\n  validate() {\r\n    const allValues = [this.xd, this.xb, this.zf, this.q, this.r_factor, this.nm, this.sc];\r\n    if (allValues.some((val) => isNaN(val))) {\r\n      alert('유효하지 않은 입력값이 있습니다. 숫자만 입력해주세요.');\r\n      return false;\r\n    }\r\n    if (this.alpha !== null && (isNaN(this.alpha) || this.alpha <= 1.0)) {\r\n      alert('상대휘발도(α)는 1.0보다 커야 합니다.');\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n}\r\n\r\n// --- DOM Elements ---\r\nconst systemSelect = document.getElementById('system_select');\r\nconst systemDeleteSelect = document.getElementById('system_for_delete_select');\r\nconst systemOutSelect = document.getElementById('system_for_out_select'); // 내보내기용\r\n\r\nconst deleteVleBtn = document.getElementById('delete-vle-btn');\r\nconst outVleBtn = document.getElementById('out-vle-btn'); // 내보내기 버튼\r\nconst inputJsonBtn = document.getElementById('input_json_btn'); // 가져오기 버튼\r\n\r\nconst systemDescription = document.querySelector('.description');\r\nconst vleInputModal = document.getElementById('vle-input-modal');\r\nconst addVleRowBtn = document.getElementById('add-vle-row-btn');\r\nconst vleDataList = document.getElementById('vle-data-list');\r\nconst saveVleBtn = document.getElementById('save-vle-btn');\r\nconst cancelVleBtn = document.getElementById('cancel-vle-btn');\r\n\r\nconst dataManagementModal = document.getElementById('data-management-modal');\r\nconst manageDataBtn = document.getElementById('manage-vle-data-btn');\r\nconst closeManageBtn = document.getElementById('close-data-management-modal-btn');\r\nconst addNewVleDataBtn = document.getElementById('add-new-vle-data-btn');\r\nconst alphaContainer = document.getElementById('alpha-container');\r\n\r\nlet customVLEData = [];\r\n\r\n// --- Initialization ---\r\nexport function setUpUIListeners() {\r\n  fetchAndPopulateSystems();\r\n\r\n  if (systemSelect) systemSelect.addEventListener('change', handleSystemChange);\r\n  \r\n  // 데이터 관리 모달 열기\r\n  if (manageDataBtn) {\r\n    manageDataBtn.addEventListener('click', () => {\r\n      fetchAndPopulateSystems();\r\n      dataManagementModal.classList.remove('hidden');\r\n    });\r\n  }\r\n  // 데이터 관리 모달 닫기\r\n  if (closeManageBtn) {\r\n    closeManageBtn.addEventListener('click', () => dataManagementModal.classList.add('hidden'));\r\n  }\r\n  // 직접 입력(Add New) 창 열기\r\n  if (addNewVleDataBtn) {\r\n    addNewVleDataBtn.addEventListener('click', () => {\r\n      dataManagementModal.classList.add('hidden'); // 관리창 닫고\r\n      showVLEModal(); // 입력창 열기\r\n    });\r\n  }\r\n\r\n  // 삭제 & 내보내기 & 가져오기 리스너\r\n  if (deleteVleBtn) deleteVleBtn.addEventListener('click', handleDeleteSystem);\r\n  if (outVleBtn) outVleBtn.addEventListener('click', handleExportSystem);\r\n  if (inputJsonBtn) inputJsonBtn.addEventListener('change', handleImportSystem);\r\n\r\n  setUpVLEModalManagement();\r\n  setUpDynamicVLEInput();\r\n}\r\n\r\n// --- Data Fetching & UI Population ---\r\nfunction fetchAndPopulateSystems() {\r\n  const systems = getLocalSystems();\r\n\r\n  // 1. 메인 선택 드롭다운\r\n  if (systemSelect) {\r\n    //@ts-ignore\r\n    const currentVal = systemSelect.value;\r\n    systemSelect.innerHTML = '';\r\n\r\n    const idealOpt = document.createElement('option');\r\n    idealOpt.value = 'ideal_binary';\r\n    idealOpt.textContent = 'Ideal Binary System (Relative Volatility α)';\r\n    systemSelect.appendChild(idealOpt);\r\n\r\n    const defaultOpt = document.createElement('option');\r\n    defaultOpt.value = 'methanol_water';\r\n    defaultOpt.textContent = 'Methanol-Water (Default)';\r\n    systemSelect.appendChild(defaultOpt);\r\n\r\n    systems.forEach((sys) => {\r\n      const opt = document.createElement('option');\r\n      opt.value = sys.system_id;\r\n      opt.textContent = sys.system_name;\r\n      systemSelect.appendChild(opt);\r\n    });\r\n\r\n    // 선택값 복원\r\n    if (currentVal && (currentVal === 'methanol_water' || systems.find((s) => s.system_id === currentVal))) {\r\n      //@ts-ignore\r\n      systemSelect.value = currentVal;\r\n    }\r\n  }\r\n\r\n  // 2. 관리 모달 드롭다운들 업데이트\r\n  updateDropdown(systemDeleteSelect, systems, deleteVleBtn, \"삭제할 데이터가 없습니다.\");\r\n  updateDropdown(systemOutSelect, systems, outVleBtn, \"내보낼 데이터가 없습니다.\");\r\n}\r\n\r\n// 드롭다운 업데이트용 유틸 함수\r\nfunction updateDropdown(selectEl, systems, btnEl, emptyMsg) {\r\n  if (!selectEl) return;\r\n  selectEl.innerHTML = '';\r\n  if (systems.length === 0) {\r\n    const opt = document.createElement('option');\r\n    opt.textContent = emptyMsg;\r\n    opt.disabled = true;\r\n    selectEl.appendChild(opt);\r\n    if (btnEl) btnEl.disabled = true;\r\n  } else {\r\n    if (btnEl) btnEl.disabled = false;\r\n    systems.forEach((sys) => {\r\n      const opt = document.createElement('option');\r\n      opt.value = sys.system_id;\r\n      opt.textContent = sys.system_name;\r\n      selectEl.appendChild(opt);\r\n    });\r\n  }\r\n}\r\n\r\n// --- System Selection & Loading ---\r\nasync function handleSystemChange(event) {\r\n  const selectedValue = event.target.value;\r\n  \r\n  if (selectedValue === 'ideal_binary') {\r\n    if (alphaContainer) alphaContainer.classList.remove('hidden');\r\n    if (systemDescription) systemDescription.innerHTML = `<b>System:</b> Ideal Binary<br><b>Method:</b> Relative Volatility (α)`;\r\n    currentSystemProps = { LK_Cp: 0, LK_Latent: 0, HK_Cp: 0, HK_Latent: 0 };\r\n    return;\r\n  }\r\n  \r\n  if (alphaContainer) alphaContainer.classList.add('hidden');\r\n\r\n  if (selectedValue === 'methanol_water') {\r\n    initializeVLEData(METHANOL_VLE_DATA);\r\n    customVLEData = METHANOL_VLE_DATA;\r\n    // 기본값 물성치\r\n    currentSystemProps = { LK_Cp: 81.6, LK_Latent: 35270, HK_Cp: 75.3, HK_Latent: 40660 };\r\n    if (systemDescription) systemDescription.innerHTML = `<b>System:</b> Methanol-Water<br><b>Assumptions:</b> Total Condenser, Partial Reboiler`;\r\n  } else {\r\n    loadSystemFromLocal(selectedValue);\r\n  }\r\n}\r\n\r\nfunction loadSystemFromLocal(systemId) {\r\n  try {\r\n    const systems = getLocalSystems();\r\n    const system = systems.find(s => s.system_id === systemId);\r\n    if (!system) throw new Error('Data not found');\r\n\r\n    initializeVLEData(system.vle_points);\r\n    customVLEData = system.vle_points;\r\n\r\n    // 물성치 로드\r\n    const p = system.props || {};\r\n    currentSystemProps = { LK_Cp: p.LK_Cp||0, LK_Latent: p.LK_Latent||0, HK_Cp: p.HK_Cp||0, HK_Latent: p.HK_Latent||0 };\r\n\r\n    if (systemDescription) {\r\n      systemDescription.innerHTML = `<b>System:</b> ${system.system_name}<br><b>Source:</b> ${system.vle_source}<br>\r\n      <span style=\"font-size:0.85em; color:#555;\">(Props Loaded)</span>`;\r\n    }\r\n  } catch (e) {\r\n    console.error(e);\r\n    alert('데이터 로드 실패. 기본값으로 복귀합니다.');\r\n    //@ts-ignore\r\n    if(systemSelect) systemSelect.value = 'methanol_water';\r\n  }\r\n}\r\n\r\n// --- Data Saving (Create) ---\r\nfunction handleVLEDataSave() {\r\n  const rows = vleDataList.querySelectorAll('.vle-row');\r\n  const data = [];\r\n  rows.forEach((row) => {\r\n    //@ts-ignore\r\n    const x = parseFloat(row.querySelector('.vle-x').value);\r\n    //@ts-ignore\r\n    const y = parseFloat(row.querySelector('.vle-y').value);\r\n    data.push({ x, y });\r\n  });\r\n\r\n  if (!validateVLEData(data)) return;\r\n  data.sort((a, b) => a.x - b.x);\r\n\r\n  //@ts-ignore\r\n  const compA = document.getElementById('comp_name_A').value.trim();\r\n  //@ts-ignore\r\n  const compB = document.getElementById('comp_name_B').value.trim();\r\n  //@ts-ignore\r\n  const source = document.getElementById('vle_source_input').value.trim();\r\n  \r\n  // 물성치 읽기\r\n  //@ts-ignore\r\n  const lkCp = parseFloat(document.getElementById('LK_vle_Cpl_input').value) || 0;\r\n  //@ts-ignore\r\n  const lkLat = parseFloat(document.getElementById('LK_vle_vLatent_heat_input').value) || 0;\r\n  //@ts-ignore\r\n  const hkCp = parseFloat(document.getElementById('HK_vle_Cpl_input').value) || 0;\r\n  //@ts-ignore\r\n  const hkLat = parseFloat(document.getElementById('HK_vle_vLatent_heat_input').value) || 0;\r\n\r\n  const systemName = `${compA}-${compB}`;\r\n  const newSystemId = 'loc_' + Date.now() + Math.floor(Math.random() * 1000);\r\n\r\n  const newSystem = {\r\n    system_id: newSystemId,\r\n    system_name: systemName,\r\n    component_a: compA,\r\n    component_b: compB,\r\n    vle_points: data,\r\n    vle_source: source,\r\n    props: { LK_Cp: lkCp, LK_Latent: lkLat, HK_Cp: hkCp, HK_Latent: hkLat },\r\n    created_at: new Date().toISOString()\r\n  };\r\n\r\n  try {\r\n    const systems = getLocalSystems();\r\n    systems.push(newSystem);\r\n    saveLocalSystems(systems);\r\n\r\n    customVLEData = data;\r\n    currentSystemProps = newSystem.props;\r\n    initializeVLEData(customVLEData);\r\n\r\n    hideVLEModal();\r\n    alert(`저장 완료! '${systemName}'`);\r\n\r\n    fetchAndPopulateSystems();\r\n    if (systemSelect) {\r\n      //@ts-ignore\r\n      systemSelect.value = newSystemId;\r\n      handleSystemChange({ target: { value: newSystemId } });\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n    alert('저장 실패: ' + error.message);\r\n  }\r\n}\r\n\r\n// --- Data Export (JSON) ---\r\nfunction handleExportSystem() {\r\n  //@ts-ignore\r\n  if (!systemOutSelect || !systemOutSelect.value) {\r\n    alert('내보낼 시스템을 선택해주세요.');\r\n    return;\r\n  }\r\n  //@ts-ignore\r\n  const systemId = systemOutSelect.value;\r\n  const systems = getLocalSystems();\r\n  const target = systems.find(s => s.system_id === systemId);\r\n\r\n  if (!target) return alert('데이터 없음');\r\n\r\n  const jsonStr = JSON.stringify(target, null, 2);\r\n  const blob = new Blob([jsonStr], { type: 'application/json' });\r\n  const url = URL.createObjectURL(blob);\r\n  \r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = `${target.system_name}_VLE.json`;\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  document.body.removeChild(a);\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\n// --- Data Import (JSON) ---\r\nfunction handleImportSystem(event) {\r\n  const file = event.target.files[0];\r\n  if (!file) return;\r\n\r\n  const reader = new FileReader();\r\n  reader.onload = function(e) {\r\n    try {\r\n      //@ts-ignore\r\n      const imported = JSON.parse(e.target.result);\r\n      if (!imported.system_name || !imported.vle_points) throw new Error('필수 데이터 누락');\r\n\r\n      // ID 충돌 방지용 새 ID 발급\r\n      const newId = 'loc_' + Date.now() + Math.floor(Math.random() * 1000);\r\n      imported.system_id = newId;\r\n      imported.created_at = new Date().toISOString();\r\n\r\n      const systems = getLocalSystems();\r\n      systems.push(imported);\r\n      saveLocalSystems(systems);\r\n\r\n      alert(`가져오기 완료: ${imported.system_name}`);\r\n      fetchAndPopulateSystems();\r\n      \r\n      // 모달 닫기\r\n      if (dataManagementModal) dataManagementModal.classList.add('hidden');\r\n\r\n      // 바로 선택\r\n      if (systemSelect) {\r\n        //@ts-ignore\r\n        systemSelect.value = newId;\r\n        handleSystemChange({ target: { value: newId } });\r\n      }\r\n    } catch (err) {\r\n      alert('Import Error: ' + err.message);\r\n    } finally {\r\n      event.target.value = ''; // 초기화\r\n    }\r\n  };\r\n  reader.readAsText(file);\r\n}\r\n\r\n// --- Delete ---\r\nfunction handleDeleteSystem() {\r\n  //@ts-ignore\r\n  if (!systemDeleteSelect || !systemDeleteSelect.value) return alert('선택 필요');\r\n  \r\n  //@ts-ignore\r\n  const text = systemDeleteSelect.options[systemDeleteSelect.selectedIndex].text;\r\n  if (!confirm(`정말 '${text}' 데이터를 삭제합니까?`)) return;\r\n  //@ts-ignore\r\n  const id = systemDeleteSelect.value;\r\n  const systems = getLocalSystems();\r\n  const newSystems = systems.filter(s => s.system_id !== id);\r\n  saveLocalSystems(newSystems);\r\n\r\n  alert('삭제되었습니다.');\r\n  fetchAndPopulateSystems();\r\n\r\n  //@ts-ignore\r\n  if (systemSelect && systemSelect.value === id) {\r\n    //@ts-ignore\r\n    systemSelect.value = 'methanol_water';\r\n    handleSystemChange({ target: { value: 'methanol_water' } });\r\n  }\r\n}\r\n\r\n// --- UI Helpers ---\r\nfunction validateVLEData(data) {\r\n  //@ts-ignore\r\n  const compA = document.getElementById('comp_name_A').value;\r\n  //@ts-ignore\r\n  const compB = document.getElementById('comp_name_B').value;\r\n  if (!compA || !compB) { alert('성분명 필수'); return false; }\r\n  if (data.length < 2) { alert('최소 2개의 데이터 필요'); return false; }\r\n  return true;\r\n}\r\n\r\nfunction showVLEModal() {\r\n  if (vleInputModal) {\r\n    vleInputModal.classList.remove('hidden');\r\n    clearVLERows();\r\n    // 인풋 초기화\r\n    const ids = ['comp_name_A', 'comp_name_B', 'vle_source_input', 'LK_vle_Cpl_input', 'LK_vle_vLatent_heat_input', 'HK_vle_Cpl_input', 'HK_vle_vLatent_heat_input'];\r\n    ids.forEach(id => {\r\n      //@ts-ignore\r\n      const el = document.getElementById(id); if(el) el.value = '';\r\n    });\r\n  }\r\n}\r\n\r\nfunction hideVLEModal() {\r\n  if (vleInputModal) vleInputModal.classList.add('hidden');\r\n  if (dataManagementModal) dataManagementModal.classList.remove('hidden');\r\n}\r\n\r\nfunction setUpVLEModalManagement() {\r\n  if (cancelVleBtn) cancelVleBtn.addEventListener('click', hideVLEModal);\r\n  if (saveVleBtn) saveVleBtn.addEventListener('click', handleVLEDataSave);\r\n}\r\n\r\nfunction setUpDynamicVLEInput() {\r\n  if (addVleRowBtn) addVleRowBtn.addEventListener('click', () => addVLEDataRow());\r\n  if (vleDataList) {\r\n    vleDataList.addEventListener('click', (e) => {\r\n      //@ts-ignore\r\n      if (e.target.classList.contains('remove-vle-row')) {\r\n        //@ts-ignore\r\n        e.target.closest('.vle-row').remove();\r\n        updateRemoveButtonVisibility();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction addVLEDataRow(x = 0.5, y = 0.5) {\r\n  if (!vleDataList) return;\r\n  const row = document.createElement('div');\r\n  row.className = 'vle-row';\r\n  row.innerHTML = `<label>x:</label><input type=\"number\" step=\"any\" min=\"0\" max=\"1\" value=\"${x}\" class=\"vle-x\"><label>y:</label><input type=\"number\" step=\"any\" min=\"0\" max=\"1\" value=\"${y}\" class=\"vle-y\"><button type=\"button\" class=\"remove-vle-row\">-</button>`;\r\n  vleDataList.appendChild(row);\r\n  updateRemoveButtonVisibility();\r\n}\r\n\r\nfunction clearVLERows() {\r\n  if (!vleDataList) return;\r\n  vleDataList.innerHTML = '';\r\n  // 0,0 및 1,1 기본 추가\r\n  const r1 = document.createElement('div'); r1.className = 'vle-row'; r1.innerHTML = `<label>x:</label><input value=\"0.0\" readonly class=\"vle-x\"><label>y:</label><input value=\"0.0\" readonly class=\"vle-y\"><button class=\"remove-vle-row\" style=\"visibility:hidden\">-</button>`;\r\n  vleDataList.appendChild(r1);\r\n  const r2 = document.createElement('div'); r2.className = 'vle-row'; r2.innerHTML = `<label>x:</label><input value=\"1.0\" readonly class=\"vle-x\"><label>y:</label><input value=\"1.0\" readonly class=\"vle-y\"><button class=\"remove-vle-row\" style=\"visibility:hidden\">-</button>`;\r\n  vleDataList.appendChild(r2);\r\n  updateRemoveButtonVisibility();\r\n}\r\n\r\nfunction updateRemoveButtonVisibility() {\r\n  const rows = vleDataList.querySelectorAll('.vle-row');\r\n  rows.forEach((row, idx) => {\r\n    const btn = row.querySelector('.remove-vle-row');\r\n    //@ts-ignore\r\n    if(btn) btn.style.visibility = (idx === 0 || idx === rows.length - 1) ? 'hidden' : 'visible';\r\n  });\r\n}\r\n\r\nexport function getCustomVLEData() { return customVLEData; }\r\n\r\n// Initial Call\r\nsetUpUIListeners();","/**\n * mccabe-thiele.js\n * Main logic for McCabe-Thiele\n * Use equilibrium line from 'eq_line.js'\n * Murphree efficiency is calculated between actual equilibrium line and operating line\n * (y_effective = y_op + nm * (y_ideal - y_op))\n * Seperated operating line into rectifying section and stripping section.\n */\n\nimport { getIdealEquilibriumY } from './eq_line.js';\nimport { Variable } from './ui.js';\n\n/**\n * VLE 곡선과 y=x 선(45도선)의 교차점 (공비점)을 모두 찾아 반환합니다.\n * @returns {number[]} - 공비점 x-조성 배열. 공비점이 없으면 빈 배열을 반환합니다.\n */\nfunction findAzeotropeX() {\n  const f = (x, alpha) => getIdealEquilibriumY(x, alpha) - x;\n  const azeotropes = [];\n\n  // [설정] 스캔할 간격의 수 (정밀도와 성능의 타협점, 1000개로 설정)\n  const NUM_SEGMENTS = 1000;\n  const step = 1.0 / NUM_SEGMENTS;\n  const tolerance = 1e-6; // 부동 소수점 오차 허용 범위\n\n  let x1 = 0.0;\n  let y1 = f(x1); // f(0) = 0.0 (항상 0임)\n\n  for (let i = 1; i <= NUM_SEGMENTS; i++) {\n    let x2 = Math.min(1.0, i * step); // 1.0을 넘지 않도록 보장\n    let y2 = f(x2);\n\n    // 1. [경계값 검사] (x=0 또는 x=1)에서는 공비점이 없다고 가정하고 넘어감\n    if (Math.abs(x1) < tolerance || Math.abs(x2 - 1.0) < tolerance) {\n      x1 = x2;\n      y1 = y2;\n      continue;\n    }\n\n    // 2. [부호 변화 검사] y1과 y2의 부호가 다른지 확인 (45도선 통과)\n    if (y1 * y2 < 0) {\n      // 부호가 바뀌었으므로, 이 구간 [x1, x2] 안에 공비점이 존재\n\n      // [이분법 재활용] 이 구간에서 정밀한 교차점을 찾음 (30회)\n      let low = x1;\n      let high = x2;\n      for (let j = 0; j < 30; j++) {\n        let mid_x = (low + high) / 2;\n        if (f(mid_x) === 0 || high - low < tolerance) {\n          low = mid_x; // mid_x로 수렴\n          break;\n        }\n        if (f(mid_x) * f(low) < 0) {\n          high = mid_x;\n        } else {\n          low = mid_x;\n        }\n      }\n      const x_azeo = (low + high) / 2;\n\n      // 중복 방지 및 배열에 추가\n      if (\n        azeotropes.length === 0 ||\n        Math.abs(azeotropes[azeotropes.length - 1] - x_azeo) > tolerance\n      ) {\n        azeotropes.push(x_azeo);\n      }\n    }\n\n    // 3. 다음 루프를 위해 값 갱신\n    x1 = x2;\n    y1 = y2;\n  }\n\n  return azeotropes; // 공비점 배열 반환\n}\n\n/**\n * Return x' when q = 0 (수평선)\n * (q-line 플로팅 및 R_min 계산에 사용됨)\n */\nfunction ideal_eq2(y_target, alpha) {\n  let low = 0.0;\n  let high = 1.0;\n  let mid_xa;\n  for (let i = 0; i < 30; i++) {\n    mid_xa = (low + high) / 2;\n    const y_guess = getIdealEquilibriumY(mid_xa, alpha);\n    if (y_guess < y_target) {\n      low = mid_xa;\n    } else {\n      high = mid_xa;\n    }\n  }\n  return (low + high) / 2;\n}\n\n/**\n * q-line actual equilibrium line의 교차점을 찾기 (q-line 플로팅 및 R_min 계산용).\n */\nfunction find_q_ideal_eq_intersect(q, zf, alpha) {\n  if (Math.abs(q - 1.0) < 1e-6) {\n    // q = 1 (수직선)\n    const x_intersect = zf;\n    const y_intersect = getIdealEquilibriumY(zf, alpha);\n    return { x: x_intersect, y: y_intersect };\n  }\n  if (Math.abs(q) < 1e-6) {\n    // q = 0 (수평선)\n    const x_intersect = ideal_eq2(zf, alpha);\n    const y_intersect = zf;\n    return { x: x_intersect, y: y_intersect };\n  }\n\n  const q_slope = q / (q - 1);\n  const q_intercept = -zf / (q - 1);\n  const q_line = (x) => q_slope * x + q_intercept;\n  const f = (x) => getIdealEquilibriumY(x, alpha) - q_line(x);\n\n  let low = 0.0,\n    high = 1.0,\n    mid_x;\n  for (let i = 0; i < 30; i++) {\n    mid_x = (low + high) / 2;\n    if (f(mid_x) < 0) {\n      low = mid_x;\n    } else {\n      high = mid_x;\n    }\n  }\n  const x_intersect = (low + high) / 2;\n  const y_intersect = getIdealEquilibriumY(x_intersect, alpha);\n\n  return { x: x_intersect, y: y_intersect };\n}\n\n/**\n * @param {array} dataArray\n * @param {number} y_target\n * @returns {number}\n */\nfunction find_x_from_data(dataArray, y_target) {\n  // Is target end of data?\n  if (y_target <= dataArray[0].y) return dataArray[0].x;\n  if (y_target >= dataArray[dataArray.length - 1].y)\n    return dataArray[dataArray.length - 1].x;\n\n  let low = 0;\n  let high = dataArray.length - 1;\n  let p1 = dataArray[low];\n  let p2 = dataArray[high];\n\n  while (high - low > 1) {\n    let mid = Math.floor((low + high) / 2);\n    if (dataArray[mid].y < y_target) {\n      low = mid;\n    } else {\n      high = mid;\n    }\n  }\n  p1 = dataArray[low];\n  p2 = dataArray[high];\n\n  // 데이터 사이를 선형으로 메꿈\n  const slope_inv = (p2.x - p1.x) / (p2.y - p1.y);\n  const x_out = p1.x + (y_target - p1.y) * slope_inv;\n\n  return x_out;\n}\n\n/**\n * McCabe-Thiele 계산을 수행하는 메인 함수\n * @param {Variable} variables - ui.js에서 생성된 Variable class\n * @returns {object}\n */\nexport function calculateMcCabeThiele(variables) {\n  const { xd, xb, zf, q, r_factor, nm, sc, Cp_LK, Latent_LK, Cp_HK, Latent_HK } = variables;\n  const plotData = {\n    ideal_eq_curve: [],\n    line_45: [\n      { x: 0, y: 0 },\n      { x: 1, y: 1 },\n    ],\n    q_line: [],\n    esol_line: [],\n    ssol_line: [],\n    steps: [],\n    effective_curve: [],\n  };\n  const results = { R_min: 0, R: 0, stages: 0, feed_stage: 0, xb_actual: 0 };\n  const { x: q_ideal_eq_x, y: q_ideal_eq_y } = find_q_ideal_eq_intersect(\n    q,\n    zf,\n    variables.alpha\n  );\n  const x_azeo_array = findAzeotropeX(); // 공비점 배열을 받음\n  let isAzeoError = false;\n  const azeoPointsInBoundary = [];\n\n  if (x_azeo_array.length > 0) {\n    // 1. 분리 영역(xb ~ xd)을 정의\n    const x_min = Math.min(xd, xb);\n    const x_max = Math.max(xd, xb);\n\n    // 2. 공비점이 분리 영역 내부에 있는지 확인\n    x_azeo_array.forEach((x_azeo) => {\n      if (x_azeo > x_min && x_azeo < x_max) {\n        isAzeoError = true;\n        azeoPointsInBoundary.push(x_azeo);\n      }\n    });\n    /** \n      const highest_x_azeo = x_azeo_array[x_azeo_array.length - 1];\n      if (xd > highest_x_azeo) {\n          isAzeoError = true;\n          if (!azeoPointsInBoundary.includes(highest_x_azeo)) {\n              azeoPointsInBoundary.push(highest_x_azeo);\n          }\n      }\n      */\n  }\n\n  // [신규] 공비물 오류 발생 시 즉시 반환 (계산 중단)\n  if (isAzeoError) {\n    // 오류가 발생했음을 알리는 플래그와 공비점 배열 반환\n    return {\n      plotData: {\n        /* empty */\n      },\n      results: {\n        /* empty */\n      },\n      floatStageNum: 0,\n      isAzeoError: true,\n      x_azeo_list: azeoPointsInBoundary.map((x) => x.toFixed(3)).join(', '),\n    };\n  }\n\n  const r_min_slope = (xd - q_ideal_eq_y) / (xd - q_ideal_eq_x);\n  results.R_min = r_min_slope / (1 - r_min_slope); // 최소 환류비\n\n  results.R = results.R_min * r_factor; // 실제 환류비\n\n  let R_internal = results.R;\n\n  const CP_LIQUID = xd*Cp_LK+(1-xd)*Cp_HK; // 메탄올 액체 열용량 (J/mol·K)\n  const LATENT_HEAT = xd*Latent_LK+(1-xd)*Latent_HK; // 메탄올 기화 잠열 (J/mol)\n  const DELTA_T = sc; // 과냉각\n\n  // 과냉각 보정 계수 (F > 1)\n  // 차가운 환류가 증기를 추가 응축시켜 내부 유량을 증가시킴\n  const F_factor = 1 + (CP_LIQUID * DELTA_T) / LATENT_HEAT; // 엔탈피 수지식을 토대로 구함\n\n  // 조작선 그리기용 '내부 환류비' 갱신\n  R_internal = results.R * F_factor;\n\n  const esol_slope = R_internal / (R_internal + 1); // 정류부 operating line 기울기\n  const esol_intercept = xd / (R_internal + 1); // 정류부 operating line 절편\n\n  let q_esol_intersect_x, q_esol_intersect_y;\n  if (Math.abs(q - 1.0) < 1e-6) {\n    q_esol_intersect_x = zf;\n    q_esol_intersect_y = esol_slope * q_esol_intersect_x + esol_intercept;\n  } else {\n    const q_slope = q / (q - 1);\n    const q_intercept = -zf / (q - 1);\n    q_esol_intersect_x =\n      (esol_intercept - q_intercept) / (q_slope - esol_slope);\n    q_esol_intersect_y = esol_slope * q_esol_intersect_x + esol_intercept;\n  }\n\n  const ssol_slope = (q_esol_intersect_y - xb) / (q_esol_intersect_x - xb); // 탈거부 operating line 기울기\n  const ssol_intercept = xb - ssol_slope * xb; // 탈거부 operating line 절편\n\n  plotData.q_line = [\n    { x: zf, y: zf },\n    { x: q_ideal_eq_x, y: q_ideal_eq_y },\n  ];\n  plotData.esol_line = [\n    { x: xd, y: xd },\n    { x: q_esol_intersect_x, y: q_esol_intersect_y },\n  ];\n  plotData.ssol_line = [\n    { x: xb, y: xb },\n    { x: q_esol_intersect_x, y: q_esol_intersect_y },\n  ];\n\n  const y_op_rect = (x) => esol_slope * x + esol_intercept;\n  const y_op_strip = (x) => ssol_slope * x + ssol_intercept;\n\n  for (let i = 0; i <= 100; i++) {\n    const x = i / 100.0;\n    const y_ideal = getIdealEquilibriumY(x, variables.alpha); // Ideal equilibrium(blue)\n\n    plotData.ideal_eq_curve.push({ x: x, y: y_ideal });\n\n    const y_op_r = y_op_rect(x);\n    const y_eff_r = y_op_r + nm * (y_ideal - y_op_r);\n    if (x > q_esol_intersect_x) {\n      plotData.effective_curve.push({ x: x, y: y_eff_r }); // 만약 qline을 안지났다면 rectifying operating line 기준으로, 아니면 stripping으로\n    }\n\n    const y_op_s = y_op_strip(x);\n    const y_eff_s = y_op_s + nm * (y_ideal - y_op_s);\n    if (x <= q_esol_intersect_x) {\n      plotData.effective_curve.push({ x: x, y: y_eff_s });\n    }\n  }\n\n  // stepping, 단수 계산.\n\n  let current_x = xd;\n  let current_y = xd;\n  let stage_count = 0;\n  let floatStageNum = 0;\n  const MAX_STAGES = 200;\n\n  while (current_x > xb && stage_count < MAX_STAGES) {\n    stage_count++;\n\n    let next_x; // 이번 스텝의 '다음 x'\n    const step_start_y = current_y; // 수평선 그리기를 위한 y값 저장\n\n    // 수평 이동\n    next_x = find_x_from_data(plotData.effective_curve, current_y);\n\n    // 수직 이동\n    let next_y;\n    if (next_x > q_esol_intersect_x) {\n      next_y = y_op_rect(next_x);\n    } else {\n      next_y = y_op_strip(next_x);\n\n      if (results.feed_stage === 0) {\n        results.feed_stage = stage_count;\n      }\n    }\n\n    plotData.steps.push([\n      { x: current_x, y: step_start_y },\n      { x: next_x, y: step_start_y },\n    ]); // 수평선\n    plotData.steps.push([\n      { x: next_x, y: step_start_y },\n      { x: next_x, y: next_y },\n    ]); // 수직선\n\n    if (next_x < xb) {\n      floatStageNum = stage_count + (current_x - xb) / (current_x - next_x);\n      break;\n    }\n\n    current_x = next_x;\n    current_y = next_y;\n  }\n\n  if (results.feed_stage === 0) results.feed_stage = 1;\n  results.stages = stage_count;\n  results.xb_actual = current_x;\n\n  return { plotData, results, floatStageNum, isAzeoError, x_azeo_array };\n}\n","/**\n * main.js\n * - Receive event from'index.html'.\n * - Get class 'Variable' from 'ui.js'.\n * - Actual calculation from 'mccabe-thiele.js'.\n * - Draw graph by Chart.js at canvas(html)\n */\n\nimport { Variable } from './ui.js';\nimport { calculateMcCabeThiele } from './mccabe-thiele.js';\nimport {\n  Chart,\n  LinearScale, // 선형 눈금 (linear scale)\n  PointElement, // 점 요소\n  LineElement, // 선 요소\n  LineController, // 선 그래프 컨트롤러\n  Filler, // 영역 채우기 플러그인\n  Tooltip, // 툴팁\n  Legend, // 범례\n  Title, // 제목\n  ScatterController, // 산점도 차트 컨트롤러\n} from 'chart.js';\nimport '../style.css';\nlet mccabeChart = null;\n\nconst calcForm = document.getElementById('calc-form');\nconst chartCanvas = document.getElementById('mccabeThieleChart');\nconst resultsTextElement = document.getElementById('results-text');\n//@ts-ignore\nconst ctx = chartCanvas.getContext('2d');\n\nChart.register(\n  LinearScale,\n  PointElement,\n  LineElement,\n  LineController, // 선 그래프 컨트롤러\n  Filler, // 영역 채우기 플러그인\n  Tooltip,\n  Legend,\n  Title,\n  ScatterController\n);\n\n/**\n * Run calculation and update states\n */\nfunction runCalculation() {\n  try {\n    const variables = new Variable();\n    const { plotData, results, floatStageNum, isAzeoError, x_azeo_array } =\n      calculateMcCabeThiele(variables);\n\n    if (isAzeoError) {\n      const errorMessage = `Azeotrope Error: Desired distillate composition (xd = ${variables.xd.toFixed(\n        3\n      )}) exceeds the azeotropic point (x_azeo = ${x_azeo_array}). Separation to this purity is physically impossible.`;\n      alert(errorMessage);\n      resultsTextElement.textContent = `Calculation Error:\\n${errorMessage}`;\n\n      if (mccabeChart) {\n        mccabeChart.destroy();\n      }\n\n      return;\n    }\n    renderResults(results, floatStageNum); // print output as text\n    renderPlot(plotData); // print output as plot\n  } catch (error) {\n    console.error('McCabe-Thiele 계산 중 오류 발생:', error);\n    alert(\n      `계산에 실패했습니다: ${error.message}\\n콘솔(F12)에서 자세한 내용을 확인하세요.`\n    );\n    resultsTextElement.textContent = `계산 오류:\\n${error.message}`;\n  }\n}\n\n/**\n * print output at HTML <pre> tag\n * @param {object} results\n */\nfunction renderResults(results, floatStageNum) {\n  document.getElementById('results_Rmin').textContent =\n    results.R_min.toFixed(3);\n  document.getElementById('results_Rreal').textContent = results.R.toFixed(3);\n  //@ts-ignore\n  document.getElementById('results_Rfactor').textContent =\n    //@ts-ignore\n    document.getElementById('r_factor').value;\n  document.getElementById('results_Nstage').textContent = results.stages;\n  document.getElementById('results_Nstage_float').textContent =\n    floatStageNum.toFixed(1);\n  document.getElementById('results_Fstage').textContent = results.feed_stage;\n}\n\n/**\n * 계산된 플롯 데이터를 받아 Chart.js로 캔버스에 그래프를 그립니다.\n * (v2.0 - 분리된 유사 평형 곡선 렌더링)\n * @param {object} plotData - mccabe-thiele.js가 반환한 plotData 객체\n */\nfunction renderPlot(plotData) {\n  // 1. Chart.js가 요구하는 'datasets' 형식으로 데이터를 변환합니다.\n  const datasets = [\n    // (1) 이상 평형 곡선 (VLE 데이터)\n    {\n      label: 'Ideal Equilibrium (VLE)',\n      data: plotData.ideal_eq_curve, // [{x, y}, ...]\n      borderColor: 'blue',\n      borderWidth: 2,\n      pointRadius: 0,\n      showLine: true,\n      type: 'line',\n    },\n\n    // [!] 'murphree_eq_curve'\n    {\n      label: 'Effective Eq. (Rectifying)',\n      data: plotData.effective_curve,\n      borderColor: '#00c000', // 녹색\n      borderDash: [5, 5], // 점선\n      borderWidth: 2,\n      pointRadius: 0,\n      showLine: true,\n      type: 'line',\n    },\n\n    // (3) y=x (45도선)\n    {\n      label: 'y = x',\n      data: plotData.line_45,\n      borderColor: 'grey',\n      borderWidth: 1,\n      pointRadius: 0,\n      showLine: true,\n      type: 'line',\n    },\n    // (4) q-line\n    {\n      label: 'q-Line',\n      data: plotData.q_line,\n      borderColor: 'orange', // (q-line 색상, 겹칠 수 있으니 orange 유지)\n      borderWidth: 2,\n      pointRadius: 0,\n      showLine: true,\n      type: 'line',\n    },\n    // (5) 정류부 조작선 (ESOL)\n    {\n      label: 'ESOL',\n      data: plotData.esol_line,\n      borderColor: '#6a5acd', // 보라색\n      borderWidth: 2,\n      pointRadius: 0,\n      showLine: true,\n      type: 'line',\n    },\n    // (6) 탈거부 조작선 (SSOL)\n    {\n      label: 'SSOL',\n      data: plotData.ssol_line,\n      borderColor: '#6a5acd', // 보라색\n      borderWidth: 2,\n      pointRadius: 0,\n      showLine: true,\n      type: 'line',\n    },\n    // (7) 계단 (Steps) - 각 선분을 별도의 데이터셋으로 추가\n    ...plotData.steps.map((segment) => ({\n      type: 'line',\n      data: segment, // [{x,y}, {x,y}]\n      borderColor: '#FF6384', // 빨간색 (계단)\n      borderWidth: 1.5,\n      pointRadius: 0,\n      fill: false,\n      showLine: true,\n      showInLegend: false,\n    })),\n  ];\n\n  // 2. 기존에 차트가 있다면, 업데이트를 위해 파괴(destroy)합니다.\n  if (mccabeChart) {\n    mccabeChart.destroy();\n  }\n\n  // 3. 새 차트를 생성합니다.\n  mccabeChart = new Chart(ctx, {\n    type: 'scatter',\n    data: { datasets: datasets },\n    options: {\n      plugins: {\n        title: {\n          display: true,\n          text: 'McCabe-Thiele Plot (Methanol-Water @ 1 atm)',\n          font: { size: 18 },\n        },\n        legend: {\n          position: 'bottom',\n          labels: {\n            // [!] 우리가 이전에 수정한 'TypeError' 방지 코드 포함\n            filter: (legendItem) => {\n              if (!legendItem.text) {\n                return false; // 'label'이 없는 항목 (예: steps) 숨기기\n              }\n              return true; // 'label'이 있는 항목만 표시\n            },\n          },\n        },\n        tooltip: {\n          callbacks: {\n            label: (context) => {\n              const d = context.raw;\n              //@ts-ignore\n              return `${context.dataset.label}: (x: ${d.x.toFixed(\n                3\n                //@ts-ignore\n              )}, y: ${d.y.toFixed(3)})`;\n            },\n          },\n        },\n      },\n      scales: {\n        x: {\n          type: 'linear',\n          position: 'bottom',\n          title: { display: true, text: 'Liquid Mole Fraction (x)' },\n          min: 0.0,\n          max: 1.0,\n        },\n        y: {\n          type: 'linear',\n          title: { display: true, text: 'Vapor Mole Fraction (y)' },\n          min: 0.0,\n          max: 1.0,\n        },\n      },\n      aspectRatio: 1,\n      animation: false,\n      parsing: false,\n    },\n  });\n}\n\ncalcForm.addEventListener('submit', (event) => {\n  event.preventDefault();\n  runCalculation();\n});\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  console.log('페이지 로드 완료. 기본값으로 첫 계산을 실행합니다.');\n  runCalculation();\n});\n"],"names":["VLE_DATA","METHANOL_VLE_DATA","x","y","initializeVLEData","newVLEData","Array","isArray","length","console","error","log","getIdealEquilibriumY","x_in","alpha","p1","p2","i","slope","LOCAL_STORAGE_DB_KEY","currentSystemProps","LK_Cp","LK_Latent","HK_Cp","HK_Latent","getLocalSystems","data","localStorage","getItem","JSON","parse","saveLocalSystems","systems","setItem","stringify","Variable","xd","xb","zf","q","r_factor","nm","sc","Cp_LK","Latent_LK","Cp_HK","Latent_HK","constructor","this","parseFloat","document","getElementById","value","systemSelect","isIdealMode","validate","some","val","isNaN","alert","systemDeleteSelect","systemOutSelect","deleteVleBtn","outVleBtn","inputJsonBtn","systemDescription","querySelector","vleInputModal","addVleRowBtn","vleDataList","saveVleBtn","cancelVleBtn","dataManagementModal","manageDataBtn","closeManageBtn","addNewVleDataBtn","alphaContainer","customVLEData","fetchAndPopulateSystems","currentVal","innerHTML","idealOpt","createElement","textContent","appendChild","defaultOpt","forEach","sys","opt","system_id","system_name","find","s","updateDropdown","selectEl","btnEl","emptyMsg","disabled","async","handleSystemChange","event","selectedValue","target","classList","remove","add","systemId","system","Error","vle_points","p","props","vle_source","e","loadSystemFromLocal","hideVLEModal","updateRemoveButtonVisibility","rows","querySelectorAll","row","idx","btn","style","visibility","find_x_from_data","dataArray","y_target","low","high","mid","Math","floor","slope_inv","calculateMcCabeThiele","variables","plotData","ideal_eq_curve","line_45","q_line","esol_line","ssol_line","steps","effective_curve","results","R_min","R","stages","feed_stage","xb_actual","q_ideal_eq_x","q_ideal_eq_y","abs","x_intersect","mid_xa","ideal_eq2","q_slope","q_intercept","f","mid_x","find_q_ideal_eq_intersect","x_azeo_array","azeotropes","tolerance","x1","y1","x2","min","y2","j","x_azeo","push","findAzeotropeX","isAzeoError","azeoPointsInBoundary","x_min","x_max","max","floatStageNum","x_azeo_list","map","toFixed","join","r_min_slope","R_internal","F_factor","esol_slope","esol_intercept","q_esol_intersect_x","q_esol_intersect_y","ssol_slope","ssol_intercept","y_op_rect","y_op_strip","y_ideal","y_op_r","y_eff_r","y_op_s","y_eff_s","current_x","current_y","stage_count","next_x","step_start_y","next_y","addEventListener","r1","className","r2","clearVLERows","id","el","text","options","selectedIndex","confirm","filter","jsonStr","blob","Blob","type","url","URL","createObjectURL","a","href","download","body","click","removeChild","revokeObjectURL","file","files","reader","FileReader","onload","imported","result","newId","Date","now","random","created_at","toISOString","err","message","readAsText","compA","compB","validateVLEData","sort","b","trim","source","lkCp","lkLat","hkCp","hkLat","systemName","newSystemId","newSystem","component_a","component_b","addVLEDataRow","contains","closest","mccabeChart","calcForm","chartCanvas","resultsTextElement","ctx","getContext","runCalculation","errorMessage","destroy","renderResults","datasets","label","borderColor","borderWidth","pointRadius","showLine","borderDash","segment","fill","showInLegend","plugins","title","display","font","size","legend","position","labels","legendItem","tooltip","callbacks","context","d","raw","dataset","scales","aspectRatio","animation","parsing","renderPlot","register","preventDefault"],"ignoreList":[],"sourceRoot":""}
{"version":3,"file":"main.f036dfe9e750b0ba80df.js","mappings":"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","sources":["webpack://mccabe-thiele-method-online/./src/resources/js/supadata_channel/supadata_config.js","webpack://mccabe-thiele-method-online/./src/resources/js/eq_line.js","webpack://mccabe-thiele-method-online/./src/resources/js/ui.js","webpack://mccabe-thiele-method-online/./src/resources/js/mccabe-thiele.js","webpack://mccabe-thiele-method-online/./src/resources/js/main.js"],"sourcesContent":["export { SUPABASE_SYSTEMS_ENDPOINT, SUPABASE_ANON_KEY, SUPABASE_URL}\r\n\r\nconst SUPABASE_URL = 'https://pslozmvfdrppmmvsnpff.supabase.co'; // 예: https://abcdefg12345.supabase.co\r\nconst SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBzbG96bXZmZHJwcG1tdnNucGZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NzQ1NzIsImV4cCI6MjA4MDA1MDU3Mn0.4gL96sI9vhEwgpPXFdY_c80msecst08vJYPv6PNzgO0'; // 예: eyJhbGciOiJIUzI1NiI...\r\nconst SUPABASE_SYSTEMS_ENDPOINT = `${SUPABASE_URL}/rest/v1/systems`;","/**\n * @typedef {{x: number, y: number}} VLEPoint\n */\n\n// VLE 데이터는 모듈 내부 변수에 저장되며, 외부에서 주입 가능\n/** @type {VLEPoint[]} */\nlet VLE_DATA = [];\n\n// [TODO] Methanol-Water 기본 데이터 (초기값으로 사용)\nexport const METHANOL_VLE_DATA = [\n  { x: 0.0, y: 0.0 },\n  { x: 0.012, y: 0.068 },\n  { x: 0.02, y: 0.121 },\n  { x: 0.026, y: 0.159 },\n  { x: 0.033, y: 0.188 },\n  { x: 0.036, y: 0.215 },\n  { x: 0.053, y: 0.275 },\n  { x: 0.076, y: 0.366 },\n  { x: 0.1, y: 0.438 },\n  { x: 0.12, y: 0.485 },\n  { x: 0.14, y: 0.522 },\n  { x: 0.15, y: 0.541 },\n  { x: 0.2, y: 0.605 },\n  { x: 0.3, y: 0.686 },\n  { x: 0.4, y: 0.739 },\n  { x: 0.5, y: 0.779 },\n  { x: 0.6, y: 0.825 },\n  { x: 0.7, y: 0.87 },\n  { x: 0.8, y: 0.915 },\n  { x: 0.9, y: 0.958 },\n  { x: 0.95, y: 0.979 },\n  { x: 1.0, y: 1.0 },\n];\n\n// 모듈 로드 시 기본 데이터로 초기화\ninitializeVLEData(METHANOL_VLE_DATA);\n\n\n/**\n * 외부에서 VLE 데이터를 주입하여 모듈을 초기화합니다.\n * @param {VLEPoint[]} newVLEData - 정렬된 VLE 포인트 배열\n */\nexport function initializeVLEData(newVLEData) {\n    if (!Array.isArray(newVLEData) || newVLEData.length < 2) {\n        console.error(\"VLE Data initialization failed: Data must be an array with at least 2 points.\");\n        VLE_DATA = METHANOL_VLE_DATA; // 오류 시 기본값 유지\n        return;\n    }\n    // [핵심] 외부 데이터를 내부 변수에 저장\n    VLE_DATA = newVLEData;\n    console.log(`VLE Data initialized with ${VLE_DATA.length} points.`);\n}\n\n\n/**\n * 액상 조성(x_in)에 대한 이상 평형 기상 조성(y)을 계산합니다.\n * 선형 보간(Linear Interpolation)을 사용합니다.\n * @param {number} x_in - 액상 몰분율\n * @returns {number} - 기상 몰분율 (y)\n */\nexport function getIdealEquilibriumY(x_in) {\n  if (x_in <= 0) return 0;\n  if (x_in >= 1) return 1;\n\n  // [핵심] 내부 변수 VLE_DATA 사용\n  let p1 = VLE_DATA[0];\n  let p2 = VLE_DATA[1];\n\n  for (let i = 1; i < VLE_DATA.length; i++) {\n    if (VLE_DATA[i].x >= x_in) {\n      p1 = VLE_DATA[i - 1];\n      p2 = VLE_DATA[i];\n      break;\n    }\n  }\n\n  const slope = (p2.y - p1.y) / (p2.x - p1.x);\n  const y_out = p1.y + (x_in - p1.x) * slope;\n\n  return y_out;\n}","import { SUPABASE_SYSTEMS_ENDPOINT, SUPABASE_ANON_KEY, SUPABASE_URL} from \"./supadata_channel/supadata_config\";\nimport { initializeVLEData, METHANOL_VLE_DATA } from \"./eq_line\";\n\n/**\n * ui.js\n * Read input from index.html\n * Show output from mccabe-thiele.js to index.html\n */\n\nexport class Variable {\n  xd;\n  xb;\n  zf;\n  q;\n  r_factor;\n  nm;\n  sc;\n\n  constructor() {\n    // Used parseFloat() for shifting string(.value) to number\n    //@ts-ignore\n    this.xd = parseFloat(document.getElementById(\"xd\").value);\n    //@ts-ignore\n    this.xb = parseFloat(document.getElementById(\"xb\").value);\n    //@ts-ignore\n    this.zf = parseFloat(document.getElementById(\"zf\").value);\n    //@ts-ignore\n    this.q = parseFloat(document.getElementById(\"q\").value);\n    //@ts-ignore\n    this.r_factor = parseFloat(document.getElementById(\"r_factor\").value);\n    //@ts-ignore\n    this.nm = parseFloat(document.getElementById(\"nm\").value);\n    //@ts-ignore\n    this.sc = parseFloat(document.getElementById(\"sub_cooling\").value);\n    this.validate();\n  }\n\n  /**\n   * @returns {boolean} - 모든 값이 유효하면 true, 아니면 false\n   */\n  validate() {\n    const allValues = [\n      this.xd,\n      this.xb,\n      this.zf,\n      this.q,\n      this.r_factor,\n      this.nm,\n      this.sc,\n    ];\n    if (allValues.some((val) => isNaN(val))) {\n      console.error(\"입력값 오류: 일부 값이 숫자가 아닙니다 (NaN).\", this);\n      alert(\"유효하지 않은 입력값이 있습니다. 숫자만 입력해주세요.\");\n      return false;\n    }\n    if (this.xd <= this.zf || this.zf <= this.xb) {\n      console.warn(\n        `입력값 경고: 조성 순서가 올바르지 않습니다 (xd > zf > xb 여야 함). xd=${this.xd}, zf=${this.zf}, xb=${this.xb}`,\n      );\n    }\n    return true;\n  }\n}\n\n// [DOM 요소 캐싱]\n// Canvas에서 이미 선언된 요소들을 여기에 추가적으로 캐싱 (main.js에서도 사용됨)\nconst systemSelect = document.getElementById('system_select');\nconst systemDescription = document.getElementById('system-description');\nconst vleInputModal = document.getElementById('vle-input-modal');\nconst addVleRowBtn = document.getElementById('add-vle-row-btn');\nconst vleDataList = document.getElementById('vle-data-list');\nconst saveVleBtn = document.getElementById('save-vle-btn');\nconst cancelVleBtn = document.getElementById('cancel-vle-btn');\n\n// [전역 상태]\n// 사용자가 입력한 VLE 데이터를 임시로 저장할 배열 (나중에 DB나 LocalStorage로 옮겨야 함)\nlet customVLEData = []; \n\n\n/**\n * 페이지 로드 시 UI 이벤트를 설정합니다.\n */\nexport function setUpUIListeners() {\n    setUpSystemSelection();\n    setUpVLEModalManagement();\n    setUpDynamicVLEInput();\n}\n\n\n// --- VLE 시스템 선택 및 모달 제어 로직 ---\n\nasync function fetchSystemsFromDB() {\n    try {\n        const response = await fetch(`${SUPABASE_SYSTEMS_ENDPOINT}?select=system_id,system_name`, {\n            method: 'GET',\n            headers: {\n                'apikey': SUPABASE_ANON_KEY,\n                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\n            }\n        });\n\n        if (!response.ok) {\n            throw new Error(`Failed to fetch systems: ${response.statusText}`);\n        }\n\n        const systems = await response.json();\n        return systems;\n\n    } catch (error) {\n        console.error(\"Error fetching VLE systems from DB:\", error);\n        // 에러 발생 시 빈 배열 반환하여 기본 옵션만 표시\n        return [];\n    }\n}\n\n/**\n * [신규] 선택된 System ID를 기반으로 VLE 데이터를 DB에서 가져와 초기화합니다.\n * @param {string} systemId - DB에 저장된 시스템의 system_id (UUID)\n */\nasync function loadVLEDataBySystemId(systemId) {\n    try {\n        // system_id가 일치하는 단일 레코드를 조회\n        const response = await fetch(`${SUPABASE_SYSTEMS_ENDPOINT}?select=system_name,vle_source,vle_points&system_id=eq.${systemId}`, {\n            method: 'GET',\n            headers: {\n                'apikey': SUPABASE_ANON_KEY,\n                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\n                'Accept': 'application/json'\n            }\n        });\n\n        if (!response.ok) {\n            throw new Error(`Failed to load system data: ${response.statusText}`);\n        }\n\n        const systemData = await response.json();\n        if (systemData.length === 0) {\n            throw new Error('System not found in DB.');\n        }\n        \n        const system = systemData[0];\n        \n        // eq_line.js 모듈에 VLE 데이터 주입\n        // @ts-ignore\n        initializeVLEData(system.vle_points); \n        customVLEData = system.vle_points; // 로컬 상태 업데이트\n        \n        // UI 업데이트\n        if (systemDescription) {\n            systemDescription.innerHTML = `<b>System:</b> ${system.system_name} (Source: ${system.vle_source}) <br><b>Assumptions:</b> Total Condenser, Partial Reboiler`;\n        }\n\n    } catch (error) {\n        console.error(\"DB System Load Error:\", error);\n        alert(`Error loading VLE data for the selected system: ${error.message}`);\n        // 로드 실패 시 기본 메탄올-물 데이터로 복구 (안전성 확보)\n        // @ts-ignore\n        initializeVLEData(METHANOL_VLE_DATA);\n    }\n}\n\n/**\n * System selection 드롭다운 리스너를 설정합니다. (async로 변경)\n */\nasync function setUpSystemSelection() {\n    if (!systemSelect || !vleInputModal) return;\n\n    // 1. 드롭다운 초기화\n    systemSelect.innerHTML = '';\n    \n    // 2. 기본 옵션 추가\n    const defaultOption = document.createElement('option');\n    defaultOption.value = 'methanol_water';\n    defaultOption.textContent = 'Methanol-Water (Default)';\n    systemSelect.appendChild(defaultOption);\n\n    const customOption = document.createElement('option');\n    customOption.value = 'user_input';\n    customOption.textContent = 'Add Custom VLE Data...';\n    systemSelect.appendChild(customOption);\n\n    // 3. DB 데이터 로드 및 옵션 추가\n    const systems = await fetchSystemsFromDB();\n    if (systems.length > 0) {\n        const divider = document.createElement('option');\n        divider.disabled = true;\n        divider.textContent = '--- Your Saved Systems ---';\n        systemSelect.appendChild(divider);\n\n        systems.forEach(system => {\n            const option = document.createElement('option');\n            // 값으로 system_id를 사용하여 데이터 로드에 사용\n            option.value = system.system_id; \n            option.textContent = system.system_name;\n            systemSelect.appendChild(option);\n        });\n    }\n\n\n    // 4. 이벤트 리스너 설정\n    systemSelect.addEventListener('change', async (event) => {\n        // @ts-ignore\n        const selectedValue = event.target.value;\n        \n        if (selectedValue === 'methanol_water') {\n            systemDescription.innerHTML = '<b>System:</b> Methanol-Water @ 1 atm (VLE 데이터 기반) <br><b>Assumptions:</b> Total Condenser, Partial Reboiler';\n            // [TODO] VLE 데이터 상태를 Default로 리셋하는 로직 추가\n            // @ts-ignore\n            initializeVLEData(METHANOL_VLE_DATA); // eq_line.js 모듈 초기화\n            customVLEData = METHANOL_VLE_DATA; // 로컬 상태 업데이트\n\n        } else if (selectedValue === 'user_input') {\n            // \"Add Custom VLE Data...\"를 선택하면 모달을 띄웁니다.\n            showVLEModal();\n        } else {\n            // DB에 저장된 시스템을 선택한 경우: systemId를 loadVLEDataBySystemId에 전달\n            await loadVLEDataBySystemId(selectedValue);\n        }\n    });\n}\n\n/**\n * VLE 데이터 입력 모달의 버튼 리스너를 설정합니다.\n */\nfunction setUpVLEModalManagement() {\n    if (cancelVleBtn) {\n        cancelVleBtn.addEventListener('click', () => {\n            hideVLEModal();\n            // 취소 시 드롭다운을 Default로 되돌립니다.\n            //@ts-ignore\n            if (systemSelect) systemSelect.value = 'methanol_water'; \n        });\n    }\n    if (saveVleBtn) {\n        saveVleBtn.addEventListener('click', handleVLEDataSave);\n    }\n}\n\n/**\n * VLE 입력 모달을 표시합니다.\n */\nfunction showVLEModal() {\n    if (vleInputModal) {\n        vleInputModal.classList.remove('hidden');\n        // 모달을 열 때마다 초기 입력 행을 유지하고 나머지 데이터는 비우는 것이 좋음\n        clearVLERows(); \n    }\n}\n\n/**\n * VLE 입력 모달을 숨깁니다.\n */\nfunction hideVLEModal() {\n    if (vleInputModal) {\n        vleInputModal.classList.add('hidden');\n    }\n}\n\n\n// --- 동적 VLE 데이터 행 관리 로직 ---\n\n/**\n * VLE 데이터 입력 행의 추가/제거 리스너를 설정합니다.\n */\nfunction setUpDynamicVLEInput() {\n    if (addVleRowBtn) {\n        addVleRowBtn.addEventListener('click', () => {\n            addVLEDataRow();\n        });\n    }\n    // 부모 요소에 리스너를 달아 동적으로 생성된 '제거' 버튼을 처리 (이벤트 위임)\n    if (vleDataList) {\n        vleDataList.addEventListener('click', (event) => {\n            // @ts-ignore\n            if (event.target.classList.contains('remove-vle-row')) {\n                // @ts-ignore\n                event.target.closest('.vle-row').remove();\n                updateRemoveButtonVisibility();\n            }\n        });\n    }\n}\n\n/**\n * 새로운 VLE 데이터 입력 행을 동적으로 추가합니다.\n */\nfunction addVLEDataRow(x = 0.5, y = 0.5) {\n    if (!vleDataList) return;\n    \n    const row = document.createElement('div');\n    row.className = 'vle-row';\n    \n    row.innerHTML = `\n        <label>x (Liquid):</label>\n        <input type=\"number\" step=\"any\" min=\"0\" max=\"1\" value=\"${x}\" class=\"vle-x\" required>\n        <label>y (Vapor):</label>\n        <input type=\"number\" step=\"any\" min=\"0\" max=\"1\" value=\"${y}\" class=\"vle-y\" required>\n        <button type=\"button\" class=\"remove-vle-row\">-</button>\n    `;\n    \n    // [핵심 수정] 새 행을 마지막 행 (index: totalRows - 1) '앞'에 삽입합니다.\n    const rows = vleDataList.querySelectorAll('.vle-row');\n    const lastRow = rows.length > 0 ? rows[rows.length - 1] : null;\n\n    if (lastRow) {\n        // 마지막 행이 있다면, 그 앞에 새 행을 삽입합니다. (1.0 행 앞)\n        vleDataList.insertBefore(row, lastRow);\n    } else {\n        // 행이 없다면 (비정상적인 경우), 그냥 끝에 추가합니다.\n        vleDataList.appendChild(row);\n    }\n\n    updateRemoveButtonVisibility();\n}\n\n/**\n * VLE 데이터 행들을 모두 비우거나, 초기 1개만 남깁니다.\n * [수정] 0,0 행과 1,1 행을 항상 생성 및 초기화합니다.\n */\nfunction clearVLERows() {\n    //let rows = vleDataList.querySelectorAll('.vle-row');\n    \n    // 1. 모든 행 삭제\n    vleDataList.innerHTML = '';\n\n    // 2. [핵심] 경계값 행 (0,0 및 1,1)을 항상 생성합니다.\n    // 0,0 행 (첫 행)\n    const firstRow = document.createElement('div');\n    firstRow.className = 'vle-row';\n    firstRow.innerHTML = `\n        <label>x (Liquid):</label>\n        <input type=\"number\" step=\"any\" min=\"0\" max=\"1\" value=\"0.0\" class=\"vle-x\" required>\n        <label>y (Vapor):</label>\n        <input type=\"number\" step=\"any\" min=\"0\" max=\"1\" value=\"0.0\" class=\"vle-y\" required>\n        <button type=\"button\" class=\"remove-vle-row\" style=\"visibility: hidden;\">-</button>\n    `;\n    vleDataList.appendChild(firstRow);\n    \n    // 1,1 행 (마지막 행)\n    const lastRow = document.createElement('div');\n    lastRow.className = 'vle-row';\n    lastRow.innerHTML = `\n        <label>x (Liquid):</label>\n        <input type=\"number\" step=\"any\" min=\"0\" max=\"1\" value=\"1.0\" class=\"vle-x\" required>\n        <label>y (Vapor):</label>\n        <input type=\"number\" step=\"any\" min=\"0\" max=\"1\" value=\"1.0\" class=\"vle-y\" required>\n        <button type=\"button\" class=\"remove-vle-row\" style=\"visibility: hidden;\">-</button>\n    `;\n    vleDataList.appendChild(lastRow);\n    \n    // 3. KeepFirstRow 로직 (여기서는 무시하고, 단순히 0,0과 1,1만 유지)\n    // 이전 clearVLERows의 복잡한 로직이 필요 없게 됨.\n    \n    updateRemoveButtonVisibility();\n}\n\n/**\n * VLE 데이터 행이 1개일 때만 제거 버튼을 숨깁니다.\n */\nfunction updateRemoveButtonVisibility() {\n    if (!vleDataList) return;\n    const rows = Array.from(vleDataList.querySelectorAll('.vle-row')); \n    const totalRows = rows.length;\n\n    rows.forEach((row, index) => { // [수정] 인덱스를 활용\n        const removeBtn = row.querySelector('.remove-vle-row');\n        if (removeBtn) {\n            // [핵심 로직] 첫 행(index === 0)과 마지막 행(index === totalRows - 1)이 아니면 visible\n            const isMiddleRow = index > 0 && index < totalRows - 1;\n            // @ts-ignore\n            removeBtn.style.visibility = isMiddleRow ? 'visible' : 'hidden';\n        }\n    });\n}\n\n/**\n * [신규] VLE 최종 제출 시 세 가지 핵심 유효성 검사를 수행합니다.\n * @param {Array<{x: number, y: number}>} data - VLE 데이터 배열\n * @returns {boolean} - 유효성 검사 통과 여부\n */\nfunction validateVLEData(data) {\n    // 0. [신규 검사] 요소 이름 및 출처 비어 있는지 확인 (필수)\n    const compAInput = document.getElementById('comp_name_A');\n    const compBInput = document.getElementById('comp_name_B');\n    const sourceInput = document.getElementById('vle_source_input');\n    \n    // [수정] trim() 후 값이 없으면 오류\n    // @ts-ignore\n    if (!compAInput || !compAInput.value || compAInput.value.trim() === '') {\n        alert(\"Validation Error: Component A name cannot be empty. Please fill in the component name.\");\n        // @ts-ignore\n        compAInput.focus();\n        return false;\n    }\n    // @ts-ignore\n    if (!compBInput || !compBInput.value || compBInput.value.trim() === '') {\n        alert(\"Validation Error: Component B name cannot be empty. Please fill in the component name.\");\n        // @ts-ignore\n        compBInput.focus();\n        return false;\n    }\n    // @ts-ignore\n    if (!sourceInput || !sourceInput.value || sourceInput.value.trim() === '') {\n        alert(\"Validation Error: Source/Remarks field cannot be empty. Please provide a source, link, or brief remark.\");\n        // @ts-ignore\n        sourceInput.focus();\n        return false;\n    }\n\n    // 0.5 [신규 검사] 숫자 유효성 검사 (NaN 체크)\n    const invalidNumber = data.find(p => isNaN(p.x) || isNaN(p.y));\n    if (invalidNumber) {\n         alert(\"Validation Error: Invalid number input. Please ensure all x and y fields contain valid numerical data.\");\n         return false;\n    }\n\n\n    // 1. [검사] Out of Range 검사 (0보다 작거나 1보다 큰지)\n    const outOfRange = data.find(p => p.x < 0 || p.x > 1 || p.y < 0 || p.y > 1);\n    if (outOfRange) {\n        alert(`Validation Error: Out of range input. Both x (${outOfRange.x.toFixed(3)}) and y (${outOfRange.y.toFixed(3)}) components must be between 0 and 1.`);\n        return false;\n    }\n\n    // 2. [검사] 경계값 (Boundary Check): 첫 행 (0,0) 및 마지막 행 (1,1) 검사\n    const firstPoint = data[0];\n    const lastPoint = data[data.length - 1];\n    \n    if (Math.abs(firstPoint.x) > 1e-10 || Math.abs(firstPoint.y) > 1e-10 || \n        Math.abs(lastPoint.x - 1.0) > 1e-10 || Math.abs(lastPoint.y - 1.0) > 1e-10) {\n        alert(\"Validation Error: Invalid boundary points. The first point must be (0.0, 0.0) and the last point must be (1.0, 1.0). (Floating point precision error detected)\");\n        return false;\n    }\n    \n    // 3. [검사] X값 중복 검사 및 정렬 검사 (중복은 invalid X component를 의미)\n    const xValues = data.map(p => p.x);\n    const sortedXValues = [...xValues].sort((a, b) => a - b);\n    \n    for (let i = 0; i < xValues.length; i++) {\n        // [중복 검사]\n        if (i > 0 && Math.abs(xValues[i] - xValues[i - 1]) < 1e-10) { // 부동소수점 오차 허용\n            alert(`Validation Error: Invalid x components. Duplicate liquid composition (x = ${xValues[i].toFixed(3)}) found. VLE data must have unique x values.`);\n            return false;\n        }\n        \n        // [정렬 확인] (부동소수점 오차 허용)\n        if (Math.abs(xValues[i] - sortedXValues[i]) > 1e-10) {\n            alert(\"Validation Error: VLE data must be sorted by the liquid composition (x value). Please ensure your x values are strictly increasing.\");\n            return false;\n        }\n    }\n\n    // 4. [신규 검사] 최소 데이터 포인트 수 (경고만)\n    if (data.length <= 5) {\n        alert(`Warning: The number of data points (${data.length}) is very low. VLE curve accuracy may be compromised. Using more data points (e.g., > 10) is recommended.`);\n    }\n\n    return true; // 모든 검사 통과\n}\n\n\n// [TODO] VLE 데이터 상태를 Default로 리셋하는 로직 추가\n// ... (setUpUIListeners, setUpSystemSelection, setUpVLEModalManagement 등 나머지 함수는 동일) ...\n\n// ... (clearVLERows, updateRemoveButtonVisibility 등 나머지 함수는 동일) ...\n\n/**\n * 'Save & Use VLE Data' 버튼 클릭 시 호출됩니다.\n */\nasync function handleVLEDataSave() { // [수정] async로 변경\n    if (!vleDataList) return;\n\n    const data = [];\n    const rows = vleDataList.querySelectorAll('.vle-row');\n    \n    // 1. 데이터 추출 (유효성 검사 없이 순수 데이터만 추출)\n    // ... (기존 데이터 추출 루프 동일) ...\n    for (const row of rows) {\n        // @ts-ignore\n        const xInput = row.querySelector('.vle-x');\n        // @ts-ignore\n        const yInput = row.querySelector('.vle-y');\n        // @ts-ignore\n        const x = parseFloat(xInput.value);\n        // @ts-ignore\n        const y = parseFloat(yInput.value);\n\n        data.push({ x: x, y: y });\n    }\n\n    // 2. 최종 유효성 검사\n    if (!validateVLEData(data)) {\n        return; \n    }\n\n    // [핵심 추가] 데이터 정렬\n    // validateVLEData가 정렬 상태를 이미 검사했지만, 만약을 위해 다시 정렬합니다.\n    const sortedData = [...data].sort((a, b) => a.x - b.x);\n\n\n    // 3. [핵심] DB 전송을 위한 JSON 객체 생성\n    const compAInput = document.getElementById('comp_name_A');\n    const compBInput = document.getElementById('comp_name_B');\n    const sourceInput = document.getElementById('vle_source_input');\n    \n    // [!! 필수 데이터 추출 !!]\n    // @ts-ignore\n    const systemName = `${compAInput.value.trim()}-${compBInput.value.trim()}`;\n    // @ts-ignore\n    const componentA = compAInput.value.trim();\n    // @ts-ignore\n    const componentB = compBInput.value.trim();\n    // @ts-ignore\n    const source = sourceInput.value.trim();\n\n    // [요청 형식에 맞춘 JSON 객체]\n    const dbPayload = {\n        // [수정] DB 스키마에 맞춰 vle_type과 vle_component_num 추가\n        vle_type: 'Distillation',       // 1. 증류 타입: 'Distillation' (증류로 가정)\n        vle_component_num: 2,           // 2. 성분 수: 2 (이성분계, INTEGER 타입)\n        // 3. 추가하는 요소 이름\n        system_name: systemName,\n        component_a: componentA,\n        component_b: componentB,\n        // 4. VLE 데이터 (JSONB로 저장될 배열)\n        vle_points: sortedData, // [수정] 정렬된 데이터 사용\n        // 5. 출처\n        vle_source: source,\n        // 6. 추가한 시간 (created_at은 DB에서 자동 생성)\n        // created_at: new Date().toISOString()\n    };\n\n    // 4. [핵심] Supabase에 데이터 전송 (POST 요청)\n    try {\n        const response = await fetch(SUPABASE_SYSTEMS_ENDPOINT, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'apikey': SUPABASE_ANON_KEY, // Supabase 인증\n                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`, // 인증 토큰\n                'Prefer': 'return=representation' // 저장된 데이터를 응답으로 받기 위함\n            },\n            body: JSON.stringify(dbPayload)\n        });\n\n        if (!response.ok) {\n            const errorData = await response.json();\n            throw new Error(`Supabase Error: ${errorData.message || response.statusText}`);\n        }\n\n        // DB 저장이 성공하면, 로컬 상태 업데이트\n        const savedData = await response.json(); // 저장된 레코드\n        customVLEData = sortedData; // [수정] 정렬된 데이터 저장\n\n        // [핵심] eq_line.js 모듈 초기화\n        initializeVLEData(customVLEData);\n        \n        // 5. UI 업데이트\n        hideVLEModal();\n        alert(`Success: ${sortedData.length} Custom VLE data points for ${systemName} have been saved to the database and will be used for calculation.`);\n\n        if (systemDescription) {\n            systemDescription.innerHTML = `<b>System:</b> ${systemName} (Custom VLE, DB Connected) <br><b>Assumptions:</b> Total Condenser, Partial Reboiler`;\n        }\n\n    } catch (error) {\n        console.error(\"DB 전송 오류:\", error);\n        alert(`DB Save Error: Failed to save VLE data. Please check your Supabase connection and console (F12) for details.\\n${error.message}`);\n        // DB 저장 실패 시 모달을 닫지 않고 사용자가 다시 시도하도록 함\n        return; \n    }\n}\n\n/**\n * [TODO] 나중에 main.js/mccabe-thiele.js가 이 함수를 호출하여 데이터를 가져갈 것입니다.\n * @returns {Array<{x: number, y: number}>}\n */\nexport function getCustomVLEData() {\n    return customVLEData;\n}\n\n\n// 초기화 호출 (main.js에서 이 모듈을 import할 때 실행됨)\nsetUpUIListeners();","/**\n * mccabe-thiele.js\n * Main logic for McCabe-Thiele\n * Use equilibrium line from 'eq_line.js'\n * Murphree efficiency is calculated between actual equilibrium line and operating line\n * (y_effective = y_op + nm * (y_ideal - y_op))\n * Seperated operating line into rectifying section and stripping section.\n */\n\nimport { getIdealEquilibriumY } from \"./eq_line.js\";\nimport { Variable } from \"./ui.js\";\n\n/**\n * VLE 곡선과 y=x 선(45도선)의 교차점 (공비점)을 모두 찾아 반환합니다.\n * @returns {number[]} - 공비점 x-조성 배열. 공비점이 없으면 빈 배열을 반환합니다.\n */\nfunction findAzeotropeX() {\n    const f = (x) => getIdealEquilibriumY(x) - x;\n    const azeotropes = [];\n    \n    // [설정] 스캔할 간격의 수 (정밀도와 성능의 타협점, 1000개로 설정)\n    const NUM_SEGMENTS = 1000; \n    const step = 1.0 / NUM_SEGMENTS;\n    const tolerance = 1e-6; // 부동 소수점 오차 허용 범위\n\n    let x1 = 0.0;\n    let y1 = f(x1); // f(0) = 0.0 (항상 0임)\n\n    for (let i = 1; i <= NUM_SEGMENTS; i++) {\n        let x2 = Math.min(1.0, i * step); // 1.0을 넘지 않도록 보장\n        let y2 = f(x2);\n\n        // 1. [경계값 검사] (x=0 또는 x=1)에서는 공비점이 없다고 가정하고 넘어감\n        if (Math.abs(x1) < tolerance || Math.abs(x2 - 1.0) < tolerance) {\n             x1 = x2;\n             y1 = y2;\n             continue;\n        }\n\n        // 2. [부호 변화 검사] y1과 y2의 부호가 다른지 확인 (45도선 통과)\n        if (y1 * y2 < 0) {\n            // 부호가 바뀌었으므로, 이 구간 [x1, x2] 안에 공비점이 존재\n            \n            // [이분법 재활용] 이 구간에서 정밀한 교차점을 찾음 (30회)\n            let low = x1;\n            let high = x2;\n            for (let j = 0; j < 30; j++) {\n                let mid_x = (low + high) / 2;\n                if (f(mid_x) === 0 || high - low < tolerance) {\n                    low = mid_x; // mid_x로 수렴\n                    break;\n                }\n                if (f(mid_x) * f(low) < 0) {\n                    high = mid_x;\n                } else {\n                    low = mid_x;\n                }\n            }\n            const x_azeo = (low + high) / 2;\n\n            // 중복 방지 및 배열에 추가\n            if (azeotropes.length === 0 || Math.abs(azeotropes[azeotropes.length - 1] - x_azeo) > tolerance) {\n                 azeotropes.push(x_azeo);\n            }\n        }\n        \n        // 3. 다음 루프를 위해 값 갱신\n        x1 = x2;\n        y1 = y2;\n    }\n\n    return azeotropes; // 공비점 배열 반환\n}\n\n/**\n * Return x' when q = 0 (수평선)\n * (q-line 플로팅 및 R_min 계산에 사용됨)\n */\nfunction ideal_eq2(y_target) {\n  let low = 0.0;\n  let high = 1.0;\n  let mid_xa;\n  for (let i = 0; i < 30; i++) {\n    mid_xa = (low + high) / 2;\n    const y_guess = getIdealEquilibriumY(mid_xa);\n    if (y_guess < y_target) {\n      low = mid_xa;\n    } else {\n      high = mid_xa;\n    }\n  }\n  return (low + high) / 2;\n}\n\n/**\n * q-line actual equilibrium line의 교차점을 찾기 (q-line 플로팅 및 R_min 계산용).\n */\nfunction find_q_ideal_eq_intersect(q, zf) {\n  if (Math.abs(q - 1.0) < 1e-6) {\n    // q = 1 (수직선)\n    const x_intersect = zf;\n    const y_intersect = getIdealEquilibriumY(zf);\n    return { x: x_intersect, y: y_intersect };\n  }\n  if (Math.abs(q) < 1e-6) {\n    // q = 0 (수평선)\n    const x_intersect = ideal_eq2(zf);\n    const y_intersect = zf;\n    return { x: x_intersect, y: y_intersect };\n  }\n\n  const q_slope = q / (q - 1);\n  const q_intercept = -zf / (q - 1);\n  const q_line = (x) => q_slope * x + q_intercept;\n  const f = (x) => getIdealEquilibriumY(x) - q_line(x);\n\n  let low = 0.0,\n    high = 1.0,\n    mid_x;\n  for (let i = 0; i < 30; i++) {\n    mid_x = (low + high) / 2;\n    if (f(mid_x) < 0) {\n      low = mid_x;\n    } else {\n      high = mid_x;\n    }\n  }\n  const x_intersect = (low + high) / 2;\n  const y_intersect = getIdealEquilibriumY(x_intersect);\n\n  return { x: x_intersect, y: y_intersect };\n}\n\n/**\n * @param {array} dataArray\n * @param {number} y_target\n * @returns {number}\n */\nfunction find_x_from_data(dataArray, y_target) {\n  // Is target end of data?\n  if (y_target <= dataArray[0].y) return dataArray[0].x;\n  if (y_target >= dataArray[dataArray.length - 1].y)\n    return dataArray[dataArray.length - 1].x;\n\n  let low = 0;\n  let high = dataArray.length - 1;\n  let p1 = dataArray[low];\n  let p2 = dataArray[high];\n\n  while (high - low > 1) {\n    let mid = Math.floor((low + high) / 2);\n    if (dataArray[mid].y < y_target) {\n      low = mid;\n    } else {\n      high = mid;\n    }\n  }\n  p1 = dataArray[low];\n  p2 = dataArray[high];\n\n  // 데이터 사이를 선형으로 메꿈\n  const slope_inv = (p2.x - p1.x) / (p2.y - p1.y);\n  const x_out = p1.x + (y_target - p1.y) * slope_inv;\n\n  return x_out;\n}\n\n/**\n * McCabe-Thiele 계산을 수행하는 메인 함수\n * @param {Variable} variables - ui.js에서 생성된 Variable class\n * @returns {object}\n */\nexport function calculateMcCabeThiele(variables) {\n  const { xd, xb, zf, q, r_factor, nm, sc } = variables;\n  const plotData = {\n    ideal_eq_curve: [],\n    line_45: [\n      { x: 0, y: 0 },\n      { x: 1, y: 1 },\n    ],\n    q_line: [],\n    esol_line: [],\n    ssol_line: [],\n    steps: [],\n    effective_curve: [],\n  };\n  const results = { R_min: 0, R: 0, stages: 0, feed_stage: 0, xb_actual: 0 };\n  const { x: q_ideal_eq_x, y: q_ideal_eq_y } = find_q_ideal_eq_intersect(q, zf);\n  const x_azeo_array = findAzeotropeX(); // 공비점 배열을 받음\n  let isAzeoError = false;\n  const azeoPointsInBoundary = [];\n\n  if (x_azeo_array.length > 0) {\n      // 1. 분리 영역(xb ~ xd)을 정의\n      const x_min = Math.min(xd, xb);\n      const x_max = Math.max(xd, xb);\n\n      // 2. 공비점이 분리 영역 내부에 있는지 확인\n      x_azeo_array.forEach(x_azeo => {\n          if (x_azeo > x_min && x_azeo < x_max) {\n              isAzeoError = true;\n              azeoPointsInBoundary.push(x_azeo);\n          }\n      });\n      \n      // 3. [추가 검사] 목표 증류액이 공비점보다 큰 경우 (단일 공비점 가정 시 오류 처리)\n      // 이 경우는 분리 불가능함을 의미 (x_azeo_array[x_azeo_array.length - 1]가 가장 큰 공비점)\n      const highest_x_azeo = x_azeo_array[x_azeo_array.length - 1];\n      if (xd > highest_x_azeo) {\n          isAzeoError = true;\n          // (선택 사항: 메시지를 위해 최고 공비점을 추가할 수 있음)\n          if (!azeoPointsInBoundary.includes(highest_x_azeo)) {\n              azeoPointsInBoundary.push(highest_x_azeo);\n          }\n      }\n  }\n  \n  // [신규] 공비물 오류 발생 시 즉시 반환 (계산 중단)\n  if (isAzeoError) {\n      // 오류가 발생했음을 알리는 플래그와 공비점 배열 반환\n      return { \n          plotData: { /* empty */ }, \n          results: { /* empty */ }, \n          floatStageNum: 0, \n          isAzeoError: true,\n          // [수정] 여러 공비점을 문자열로 반환하여 main.js에서 처리하도록 함\n          x_azeo_list: azeoPointsInBoundary.map(x => x.toFixed(3)).join(\", \")\n      };\n  }\n\n  const r_min_slope = (xd - q_ideal_eq_y) / (xd - q_ideal_eq_x);\n  results.R_min = r_min_slope / (1 - r_min_slope); // 최소 환류비\n\n  results.R = results.R_min * r_factor; // 실제 환류비\n\n  let R_internal = results.R;\n\n  const CP_LIQUID = 81.6; // 메탄올 액체 열용량 (J/mol·K)\n  const LATENT_HEAT = 35270; // 메탄올 기화 잠열 (J/mol)\n  const DELTA_T = sc; // 과냉각\n\n  // 과냉각 보정 계수 (F > 1)\n  // 차가운 환류가 증기를 추가 응축시켜 내부 유량을 증가시킴\n  const F_factor = 1 + (CP_LIQUID * DELTA_T) / LATENT_HEAT; // 엔탈피 수지식을 토대로 구함\n\n  // 조작선 그리기용 '내부 환류비' 갱신\n  R_internal = results.R * F_factor;\n\n  const esol_slope = R_internal / (R_internal + 1); // 정류부 operating line 기울기\n  const esol_intercept = xd / (R_internal + 1); // 정류부 operating line 절편\n\n  let q_esol_intersect_x, q_esol_intersect_y;\n  if (Math.abs(q - 1.0) < 1e-6) {\n    q_esol_intersect_x = zf;\n    q_esol_intersect_y = esol_slope * q_esol_intersect_x + esol_intercept;\n  } else {\n    const q_slope = q / (q - 1);\n    const q_intercept = -zf / (q - 1);\n    q_esol_intersect_x =\n      (esol_intercept - q_intercept) / (q_slope - esol_slope);\n    q_esol_intersect_y = esol_slope * q_esol_intersect_x + esol_intercept;\n  }\n\n  const ssol_slope = (q_esol_intersect_y - xb) / (q_esol_intersect_x - xb); // 탈거부 operating line 기울기\n  const ssol_intercept = xb - ssol_slope * xb; // 탈거부 operating line 절편\n\n  plotData.q_line = [\n    { x: zf, y: zf },\n    { x: q_ideal_eq_x, y: q_ideal_eq_y },\n  ];\n  plotData.esol_line = [\n    { x: xd, y: xd },\n    { x: q_esol_intersect_x, y: q_esol_intersect_y },\n  ];\n  plotData.ssol_line = [\n    { x: xb, y: xb },\n    { x: q_esol_intersect_x, y: q_esol_intersect_y },\n  ];\n\n  const y_op_rect = (x) => esol_slope * x + esol_intercept;\n  const y_op_strip = (x) => ssol_slope * x + ssol_intercept;\n\n  for (let i = 0; i <= 100; i++) {\n    const x = i / 100.0;\n    const y_ideal = getIdealEquilibriumY(x); // Ideal equilibrium(blue)\n\n    plotData.ideal_eq_curve.push({ x: x, y: y_ideal });\n\n    const y_op_r = y_op_rect(x);\n    const y_eff_r = y_op_r + nm * (y_ideal - y_op_r);\n    if (x > q_esol_intersect_x) {\n      plotData.effective_curve.push({ x: x, y: y_eff_r }); // 만약 qline을 안지났다면 rectifying operating line 기준으로, 아니면 stripping으로\n    }\n\n    const y_op_s = y_op_strip(x);\n    const y_eff_s = y_op_s + nm * (y_ideal - y_op_s);\n    if (x <= q_esol_intersect_x) {\n      plotData.effective_curve.push({ x: x, y: y_eff_s });\n    }\n  }\n\n  // stepping, 단수 계산.\n\n  let current_x = xd;\n  let current_y = xd;\n  let stage_count = 0;\n  let floatStageNum = 0;\n  const MAX_STAGES = 200;\n\n  while (current_x > xb && stage_count < MAX_STAGES) {\n    stage_count++;\n\n    let next_x; // 이번 스텝의 '다음 x'\n    const step_start_y = current_y; // 수평선 그리기를 위한 y값 저장\n\n    // 수평 이동\n    next_x = find_x_from_data(plotData.effective_curve, current_y);\n\n    // 수직 이동\n    let next_y;\n    if (next_x > q_esol_intersect_x) {\n      next_y = y_op_rect(next_x);\n    } else {\n      next_y = y_op_strip(next_x);\n\n      if (results.feed_stage === 0) {\n        results.feed_stage = stage_count;\n      }\n    }\n\n    plotData.steps.push([\n      { x: current_x, y: step_start_y },\n      { x: next_x, y: step_start_y },\n    ]); // 수평선\n    plotData.steps.push([\n      { x: next_x, y: step_start_y },\n      { x: next_x, y: next_y },\n    ]); // 수직선\n\n    if (next_x < xb) {\n      floatStageNum = stage_count + (current_x - xb) / (current_x - next_x);\n      break;\n    }\n\n    current_x = next_x;\n    current_y = next_y;\n  }\n\n  if (results.feed_stage === 0) results.feed_stage = 1;\n  results.stages = stage_count;\n  results.xb_actual = current_x;\n\n  return { plotData, results, floatStageNum, isAzeoError, x_azeo_array};\n}\n","/**\n * main.js\n * - Receive event from'index.html'.\n * - Get class 'Variable' from 'ui.js'.\n * - Actual calculation from 'mccabe-thiele.js'.\n * - Draw graph by Chart.js at canvas(html)\n */\n\nimport { Variable } from './ui.js';\nimport { calculateMcCabeThiele } from './mccabe-thiele.js';\nimport {\n    Chart,\n    LinearScale, // 선형 눈금 (linear scale)\n    PointElement, // 점 요소\n    LineElement,  // 선 요소\n    LineController,  // 선 그래프 컨트롤러\n    Filler,          // 영역 채우기 플러그인\n    Tooltip,      // 툴팁\n    Legend,       // 범례\n    Title,        // 제목\n    ScatterController, // 산점도 차트 컨트롤러\n} from 'chart.js'; \nimport \"../style.css\";\nlet mccabeChart = null;\n\nconst calcForm = document.getElementById('calc-form');\nconst chartCanvas = document.getElementById('mccabeThieleChart');\nconst resultsTextElement = document.getElementById('results-text');\n//@ts-ignore\nconst ctx = chartCanvas.getContext('2d');\n\nChart.register(\n    LinearScale,\n    PointElement,\n    LineElement,\n    LineController,  // 선 그래프 컨트롤러\n    Filler,          // 영역 채우기 플러그인\n    Tooltip,\n    Legend,\n    Title,\n    ScatterController\n);\n\n/**\n * Run calculation and update states\n */\nfunction runCalculation() {\n    try {\n        const variables = new Variable();\n        const { plotData, results, floatStageNum, isAzeoError, x_azeo_array } = calculateMcCabeThiele(variables);\n\n        // [!!! 핵심 공비물 로직 추가 !!!]\n        if (isAzeoError) {\n            const errorMessage = `Azeotrope Error: Desired distillate composition (xd = ${variables.xd.toFixed(3)}) exceeds the azeotropic point (x_azeo = ${x_azeo_array}). Separation to this purity is physically impossible.`;\n            alert(errorMessage);\n            resultsTextElement.textContent = `Calculation Error:\\n${errorMessage}`;\n            \n            // 이전 차트가 있다면 파괴하여 빈 캔버스를 만듭니다.\n            if (mccabeChart) mccabeChart.destroy();\n            \n            // 여기서 정상적인 흐름을 중단합니다.\n            return; \n        }\n        renderResults(results, floatStageNum); // print output as text\n        renderPlot(plotData); // print output as plot\n\n    } catch (error) {\n        console.error(\"McCabe-Thiele 계산 중 오류 발생:\", error);\n        alert(`계산에 실패했습니다: ${error.message}\\n콘솔(F12)에서 자세한 내용을 확인하세요.`);\n        resultsTextElement.textContent = `계산 오류:\\n${error.message}`;\n    }\n}\n\n/**\n * print output at HTML <pre> tag\n * @param {object} results\n */\nfunction renderResults(results, floatStageNum) {\n    document.getElementById('results_Rmin').textContent = results.R_min.toFixed(3);\n    document.getElementById('results_Rreal').textContent = results.R.toFixed(3);\n    //@ts-ignore\n    document.getElementById('results_Rfactor').textContent = document.getElementById('r_factor').value;\n    document.getElementById('results_Nstage').textContent = results.stages;\n    document.getElementById('results_Nstage_float').textContent = floatStageNum.toFixed(1);\n    document.getElementById('results_Fstage').textContent = results.feed_stage;\n}\n\n/**\n * [!] 수정된 함수 [!]\n * 계산된 플롯 데이터를 받아 Chart.js로 캔버스에 그래프를 그립니다.\n * (v2.0 - 분리된 유사 평형 곡선 렌더링)\n * @param {object} plotData - mccabe-thiele.js가 반환한 plotData 객체\n */\nfunction renderPlot(plotData) {\n    \n    // 1. Chart.js가 요구하는 'datasets' 형식으로 데이터를 변환합니다.\n    const datasets = [\n        // (1) 이상 평형 곡선 (VLE 데이터)\n        {\n            label: 'Ideal Equilibrium (VLE)',\n            data: plotData.ideal_eq_curve, // [{x, y}, ...]\n            borderColor: 'blue',\n            borderWidth: 2,\n            pointRadius: 0,\n            showLine: true,\n            type: 'line',\n        },\n        \n        \n        // [!] 'murphree_eq_curve'\n        {   label: 'Effective Eq. (Rectifying)',\n            data: plotData.effective_curve,\n            borderColor: '#00c000', // 녹색\n            borderDash: [5, 5], // 점선\n            borderWidth: 2,\n            pointRadius: 0,\n            showLine: true,\n            type: 'line',\n        },\n\n        // (3) y=x (45도선)\n        {\n            label: 'y = x',\n            data: plotData.line_45,\n            borderColor: 'grey',\n            borderWidth: 1,\n            pointRadius: 0,\n            showLine: true,\n            type: 'line',\n        },\n        // (4) q-line\n        {\n            label: 'q-Line',\n            data: plotData.q_line,\n            borderColor: 'orange', // (q-line 색상, 겹칠 수 있으니 orange 유지)\n            borderWidth: 2,\n            pointRadius: 0,\n            showLine: true,\n            type: 'line',\n        },\n        // (5) 정류부 조작선 (ESOL)\n        {\n            label: 'ESOL',\n            data: plotData.esol_line,\n            borderColor: '#6a5acd', // 보라색\n            borderWidth: 2,\n            pointRadius: 0,\n            showLine: true,\n            type: 'line',\n        },\n        // (6) 탈거부 조작선 (SSOL)\n        {\n            label: 'SSOL',\n            data: plotData.ssol_line,\n            borderColor: '#6a5acd', // 보라색\n            borderWidth: 2,\n            pointRadius: 0,\n            showLine: true,\n            type: 'line',\n        },\n        // (7) 계단 (Steps) - 각 선분을 별도의 데이터셋으로 추가\n        ...plotData.steps.map(segment => ({\n            type: 'line',\n            data: segment, // [{x,y}, {x,y}]\n            borderColor: '#FF6384', // 빨간색 (계단)\n            borderWidth: 1.5,\n            pointRadius: 0,\n            fill: false,\n            showLine: true,\n            showInLegend: false, \n        }))\n    ];\n\n    // 2. 기존에 차트가 있다면, 업데이트를 위해 파괴(destroy)합니다.\n    if (mccabeChart) {\n        mccabeChart.destroy();\n    }\n\n    // 3. 새 차트를 생성합니다.\n    mccabeChart = new Chart(ctx, {\n        type: 'scatter', \n        data: { datasets: datasets },\n        options: {\n            plugins: {\n                title: {\n                    display: true,\n                    text: 'McCabe-Thiele Plot (Methanol-Water @ 1 atm)',\n                    font: { size: 18 }\n                },\n                legend: {\n                    position: 'bottom',\n                    labels: {\n                        // [!] 우리가 이전에 수정한 'TypeError' 방지 코드 포함\n                        filter: (legendItem) => {\n                            if (!legendItem.text) {\n                                return false; // 'label'이 없는 항목 (예: steps) 숨기기\n                            }\n                            return true; // 'label'이 있는 항목만 표시\n                        }\n                    }\n                },\n                tooltip: {\n                    callbacks: {\n                        label: (context) => {\n                            const d = context.raw\n                            //@ts-ignore\n                            return `${context.dataset.label}: (x: ${d.x.toFixed(3)}, y: ${d.y.toFixed(3)})`;\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    type: 'linear',\n                    position: 'bottom',\n                    title: { display: true, text: 'Liquid Mole Fraction (x)' },\n                    min: 0.0,\n                    max: 1.0,\n                },\n                y: {\n                    type: 'linear',\n                    title: { display: true, text: 'Vapor Mole Fraction (y)' },\n                    min: 0.0,\n                    max: 1.0,\n                }\n            },\n            aspectRatio: 1,\n            animation: false,\n            parsing: false, \n        }\n    });\n}\n\ncalcForm.addEventListener('submit', (event) => {\n    event.preventDefault(); \n    runCalculation();\n});\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    console.log(\"페이지 로드 완료. 기본값으로 첫 계산을 실행합니다.\");\n    runCalculation();\n});"],"names":["SUPABASE_ANON_KEY","SUPABASE_SYSTEMS_ENDPOINT","VLE_DATA","METHANOL_VLE_DATA","x","y","initializeVLEData","newVLEData","Array","isArray","length","console","error","log","getIdealEquilibriumY","x_in","p1","p2","i","slope","Variable","xd","xb","zf","q","r_factor","nm","sc","constructor","this","parseFloat","document","getElementById","value","validate","some","val","isNaN","alert","warn","systemSelect","systemDescription","vleInputModal","addVleRowBtn","vleDataList","saveVleBtn","cancelVleBtn","customVLEData","hideVLEModal","classList","add","updateRemoveButtonVisibility","rows","from","querySelectorAll","totalRows","forEach","row","index","removeBtn","querySelector","isMiddleRow","style","visibility","find_x_from_data","dataArray","y_target","low","high","mid","Math","floor","slope_inv","calculateMcCabeThiele","variables","plotData","ideal_eq_curve","line_45","q_line","esol_line","ssol_line","steps","effective_curve","results","R_min","R","stages","feed_stage","xb_actual","q_ideal_eq_x","q_ideal_eq_y","abs","x_intersect","mid_xa","ideal_eq2","q_slope","q_intercept","f","mid_x","find_q_ideal_eq_intersect","x_azeo_array","azeotropes","tolerance","x1","y1","x2","min","y2","j","x_azeo","push","findAzeotropeX","isAzeoError","azeoPointsInBoundary","x_min","x_max","max","highest_x_azeo","includes","floatStageNum","x_azeo_list","map","toFixed","join","r_min_slope","R_internal","F_factor","esol_slope","esol_intercept","q_esol_intersect_x","q_esol_intersect_y","ssol_slope","ssol_intercept","y_op_rect","y_op_strip","y_ideal","y_op_r","y_eff_r","y_op_s","y_eff_s","current_x","current_y","stage_count","next_x","step_start_y","next_y","async","innerHTML","defaultOption","createElement","textContent","appendChild","customOption","systems","response","fetch","method","headers","ok","Error","statusText","json","fetchSystemsFromDB","divider","disabled","system","option","system_id","system_name","addEventListener","event","selectedValue","target","remove","firstRow","className","lastRow","clearVLERows","systemId","systemData","vle_points","vle_source","message","loadVLEDataBySystemId","setUpSystemSelection","data","xInput","yInput","compAInput","compBInput","sourceInput","trim","focus","find","p","outOfRange","firstPoint","lastPoint","xValues","sortedXValues","sort","a","b","validateVLEData","sortedData","systemName","dbPayload","vle_type","vle_component_num","component_a","component_b","body","JSON","stringify","errorData","insertBefore","addVLEDataRow","contains","closest","mccabeChart","calcForm","chartCanvas","resultsTextElement","ctx","getContext","runCalculation","errorMessage","destroy","renderResults","datasets","label","borderColor","borderWidth","pointRadius","showLine","type","borderDash","segment","fill","showInLegend","options","plugins","title","display","text","font","size","legend","position","labels","filter","legendItem","tooltip","callbacks","context","d","raw","dataset","scales","aspectRatio","animation","parsing","renderPlot","register","preventDefault"],"ignoreList":[],"sourceRoot":""}
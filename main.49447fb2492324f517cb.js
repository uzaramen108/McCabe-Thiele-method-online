"use strict";(self.webpackChunkmccabe_thiele_method_online=self.webpackChunkmccabe_thiele_method_online||[]).push([[792],{374:(e,t,n)=>{let a=[];const l=[{x:0,y:0},{x:.012,y:.068},{x:.02,y:.121},{x:.026,y:.159},{x:.033,y:.188},{x:.036,y:.215},{x:.053,y:.275},{x:.076,y:.366},{x:.1,y:.438},{x:.12,y:.485},{x:.14,y:.522},{x:.15,y:.541},{x:.2,y:.605},{x:.3,y:.686},{x:.4,y:.739},{x:.5,y:.779},{x:.6,y:.825},{x:.7,y:.87},{x:.8,y:.915},{x:.9,y:.958},{x:.95,y:.979},{x:1,y:1}];function o(e){if(!Array.isArray(e)||e.length<2)return console.error("VLE Data initialization failed: Data must be an array with at least 2 points."),void(a=l);a=e,console.log(`VLE Data initialized with ${a.length} points.`)}function s(e,t){if(e<=0)return 0;if(e>=1)return 1;if(t)return e*t/(1+(t-1)*e);let n=a[0],l=a[1];for(let t=1;t<a.length;t++)if(a[t].x>=e){n=a[t-1],l=a[t];break}const o=(l.y-n.y)/(l.x-n.x);return n.y+(e-n.x)*o}o(l);const r="vle_systems_data";let i={LK_Cp:81.6,LK_Latent:35270,HK_Cp:75.3,HK_Latent:40660};function d(){const e=localStorage.getItem(r);return e?JSON.parse(e):[]}function c(e){localStorage.setItem(r,JSON.stringify(e))}class u{xd;xb;zf;q;r_factor;nm;sc;alpha;Cp_LK;Latent_LK;Cp_HK;Latent_HK;constructor(){this.xd=parseFloat(document.getElementById("xd").value),this.xb=parseFloat(document.getElementById("xb").value),this.zf=parseFloat(document.getElementById("zf").value),this.q=parseFloat(document.getElementById("q").value),this.r_factor=parseFloat(document.getElementById("r_factor").value),this.nm=parseFloat(document.getElementById("nm").value),this.sc=parseFloat(document.getElementById("sub_cooling").value);const e=document.getElementById("system_select"),t=e&&"ideal_binary"===e.value;this.alpha=t?parseFloat(document.getElementById("alpha_value").value):null,this.Cp_LK=i.LK_Cp||0,this.Latent_LK=i.LK_Latent||0,this.Cp_HK=i.HK_Cp||0,this.Latent_HK=i.HK_Latent||0,this.validate()}validate(){return[this.xd,this.xb,this.zf,this.q,this.r_factor,this.nm,this.sc,this.alpha].some(e=>isNaN(e))?(alert("There are invalid inputs. Please confirm type of inputs."),!1):null!==this.alpha&&(isNaN(this.alpha)||this.alpha<=1)?(alert("α should be bigger than 1.0"),!1):((this.xd<=this.zf||this.zf<=this.xb)&&console.warn("warn: Invalid order of composition (xd > zf > xb)."),!0)}}const m=document.getElementById("system_select"),_=document.getElementById("system_for_delete_select"),y=document.getElementById("delete-vle-btn"),p=document.querySelector(".description"),h=document.getElementById("vle-input-modal"),v=document.getElementById("add-vle-row-btn"),f=document.getElementById("vle-data-list"),b=document.getElementById("save-vle-btn"),x=document.getElementById("cancel-vle-btn"),g=document.getElementById("data-management-modal"),L=document.getElementById("manage-vle-data-btn"),E=document.getElementById("close-data-management-modal-btn"),C=document.getElementById("add-new-vle-data-btn"),K=document.getElementById("alpha-container");let I=[];function B(){const e=d();if(m){const t=m.value;m.innerHTML="";const n=document.createElement("option");n.value="ideal_binary",n.textContent="Ideal Binary System (Relative Volatility α)",m.appendChild(n);const a=document.createElement("option");a.value="methanol_water",a.textContent="Methanol-Water (Default)",m.appendChild(a),e.forEach(e=>{const t=document.createElement("option");t.value=e.system_id,t.textContent=e.system_name,m.appendChild(t)}),t&&("methanol_water"===t||e.find(e=>e.system_id===t))&&(m.value=t)}!function(e){if(_)if(_.innerHTML="",0===e.length){const e=document.createElement("option");e.textContent="저장된 데이터가 없습니다.",e.disabled=!0,_.appendChild(e),y&&(y.disabled=!0)}else y&&(y.disabled=!1),e.forEach(e=>{const t=document.createElement("option");t.value=e.system_id,t.textContent=e.system_name,_.appendChild(t)})}(e)}async function w(e){const t=e.target.value;if("ideal_binary"===t)return K&&K.classList.remove("hidden"),p&&(p.innerHTML="<b>System:</b> Ideal Binary<br><b>Method:</b> Relative Volatility (α)"),void(i={LK_Cp:0,LK_Latent:0,HK_Cp:0,HK_Latent:0});K&&K.classList.add("hidden"),"methanol_water"===t?(o(l),I=l,i={LK_Cp:81.6,LK_Latent:35270,HK_Cp:75.3,HK_Latent:40660},p&&(p.innerHTML="<b>System:</b> Methanol-Water<br><b>Assumptions:</b> Total Condenser, Partial Reboiler")):function(e){try{const t=d().find(t=>t.system_id===e);if(!t)throw new Error("Data not found");o(t.vle_points),I=t.vle_points;const n=t.props||{};i={LK_Cp:n.LK_Cp||0,LK_Latent:n.LK_Latent||0,HK_Cp:n.HK_Cp||0,HK_Latent:n.HK_Latent||0};const a=`\n      <div style="font-size: 0.85em; color: #555; margin-top: 6px; line-height: 1.4;">\n        <strong>[Light Key]</strong> Cp: ${i.LK_Cp}, λ: ${i.LK_Latent}<br>\n        <strong>[Heavy Key]</strong> Cp: ${i.HK_Cp}, λ: ${i.HK_Latent}\n      </div>\n    `;p&&(p.innerHTML=`\n        <b>System:</b> ${t.system_name}<br>\n        <b>Source:</b> ${t.vle_source}\n        ${i.LK_Cp||i.HK_Cp?a:""}\n      `)}catch(e){console.error(e),alert("데이터를 불러오는데 실패했습니다. 기본값으로 돌아갑니다."),m&&(m.value="methanol_water"),w({target:{value:"methanol_water"}})}}(t)}function H(){h&&h.classList.add("hidden"),g&&g.classList.remove("hidden")}function M(){if(!f)return;const e=Array.from(f.querySelectorAll(".vle-row"));e.forEach((t,n)=>{const a=t.querySelector(".remove-vle-row");a&&(a.style.visibility=0===n||n===e.length-1?"hidden":"visible")})}function F(e,t){if(t<=e[0].y)return e[0].x;if(t>=e[e.length-1].y)return e[e.length-1].x;let n=0,a=e.length-1,l=e[n],o=e[a];for(;a-n>1;){let l=Math.floor((n+a)/2);e[l].y<t?n=l:a=l}l=e[n],o=e[a];const s=(o.x-l.x)/(o.y-l.y);return l.x+(t-l.y)*s}function S(e){const{xd:t,xb:n,zf:a,q:l,r_factor:o,nm:r,sc:i,Cp_LK:d,Latent_LK:c,Cp_HK:u,Latent_HK:m}=e,_={ideal_eq_curve:[],line_45:[{x:0,y:0},{x:1,y:1}],q_line:[],esol_line:[],ssol_line:[],steps:[],effective_curve:[]},y={R_min:0,R:0,stages:0,feed_stage:0,xb_actual:0},{x:p,y:h}=function(e,t,n){if(Math.abs(e-1)<1e-6)return{x:t,y:s(t,n)};if(Math.abs(e)<1e-6){const e=function(e,t){let n,a=0,l=1;for(let o=0;o<30;o++)n=(a+l)/2,s(n,t)<e?a=n:l=n;return(a+l)/2}(t,n);return{x:e,y:t}}const a=e/(e-1),l=-t/(e-1),o=e=>s(e,n)-(e=>a*e+l)(e);let r,i=0,d=1;for(let e=0;e<30;e++)r=(i+d)/2,o(r)<0?i=r:d=r;const c=(i+d)/2;return{x:c,y:s(c,n)}}(l,a,e.alpha),v=function(){const e=(e,t)=>s(e,t)-e,t=[],n=1e-6;let a=0,l=e(a);for(let o=1;o<=1e3;o++){let s=Math.min(1,.001*o),r=e(s);if(Math.abs(a)<n||Math.abs(s-1)<n)a=s,l=r;else{if(l*r<0){let l=a,o=s;for(let t=0;t<30;t++){let t=(l+o)/2;if(0===e(t)||o-l<n){l=t;break}e(t)*e(l)<0?o=t:l=t}const r=(l+o)/2;(0===t.length||Math.abs(t[t.length-1]-r)>n)&&t.push(r)}a=s,l=r}}return t}();let f=!1;const b=[];if(v.length>0){const e=Math.min(t,n),a=Math.max(t,n);v.forEach(t=>{t>e&&t<a&&(f=!0,b.push(t))})}if(f)return{plotData:{},results:{},floatStageNum:0,isAzeoError:!0,x_azeo_list:b.map(e=>e.toFixed(3)).join(", ")};const x=(t-h)/(t-p);y.R_min=x/(1-x),y.R=y.R_min*o;let g=y.R;const L=1+(t*d+(1-t)*u)*i/(t*c+(1-t)*m);g=y.R*L;const E=g/(g+1),C=t/(g+1);let K,I;Math.abs(l-1)<1e-6?(K=a,I=E*K+C):(K=(C- -a/(l-1))/(l/(l-1)-E),I=E*K+C);const B=(I-n)/(K-n),w=n-B*n;_.q_line=[{x:a,y:a},{x:p,y:h}],_.esol_line=[{x:t,y:t},{x:K,y:I}],_.ssol_line=[{x:n,y:n},{x:K,y:I}];const H=e=>E*e+C,M=e=>B*e+w;for(let t=0;t<=100;t++){const n=t/100,a=s(n,e.alpha);_.ideal_eq_curve.push({x:n,y:a});const l=H(n),o=l+r*(a-l);n>K&&_.effective_curve.push({x:n,y:o});const i=M(n),d=i+r*(a-i);n<=K&&_.effective_curve.push({x:n,y:d})}let S=t,q=t,R=0,$=0;for(;S>n&&R<200;){let e;R++;const t=q;let a;if(e=F(_.effective_curve,q),e>K?a=H(e):(a=M(e),0===y.feed_stage&&(y.feed_stage=R)),_.steps.push([{x:S,y:t},{x:e,y:t}]),_.steps.push([{x:e,y:t},{x:e,y:a}]),e<n){$=R+(S-n)/(S-e);break}S=e,q=a}return 0===y.feed_stage&&(y.feed_stage=1),y.stages=R,y.xb_actual=S,{plotData:_,results:y,floatStageNum:$,isAzeoError:f,x_azeo_array:v}}B(),m&&m.addEventListener("change",w),L&&L.addEventListener("click",()=>{B(),g.classList.remove("hidden")}),E&&E.addEventListener("click",()=>g.classList.add("hidden")),C&&C.addEventListener("click",()=>{g.classList.add("hidden"),h&&(h.classList.remove("hidden"),function(){if(!f)return;f.innerHTML="";const e=document.createElement("div");e.className="vle-row",e.innerHTML='<label>x:</label><input type="number" value="0.0" class="vle-x" readonly><label>y:</label><input type="number" value="0.0" class="vle-y" readonly><button class="remove-vle-row" style="visibility:hidden">-</button>',f.appendChild(e);const t=document.createElement("div");t.className="vle-row",t.innerHTML='<label>x:</label><input type="number" value="1.0" class="vle-x" readonly><label>y:</label><input type="number" value="1.0" class="vle-y" readonly><button class="remove-vle-row" style="visibility:hidden">-</button>',f.appendChild(t),M()}(),["comp_name_A","comp_name_B","vle_source_input","LK_vle_Cpl_input","LK_vle_vLatent_heat_input","HK_vle_Cpl_input","HK_vle_vLatent_heat_input"].forEach(e=>{const t=document.getElementById(e);t&&(t.value="")}))}),y&&y.addEventListener("click",function(){const e=document.getElementById("system_for_delete_select"),t=document.getElementById("system_select");if(!e||!e.value)return void alert("System is not selected.");const n=e.value,a=e.options[e.selectedIndex].text;if(confirm(`[warn] '${a}' will be deleted forever?`))try{if(c(d().filter(e=>e.system_id!==n)),alert("Deleted."),B(),t&&t.value===n){alert("삭제된 데이터를 보고 있어 기본값으로 전환됩니다."),t.value="methanol_water",o(l),K&&K.classList.add("hidden");const e=document.querySelector(".description");e&&(e.innerHTML="<b>System:</b> Methanol-Water<br><b>Assumptions:</b> Total Condenser, Partial Reboiler")}}catch(e){console.error("Delete Error:",e),alert(`오류 발생: ${e.message}`)}}),x&&x.addEventListener("click",H),b&&b.addEventListener("click",function(){const e=f.querySelectorAll(".vle-row"),t=[];if(e.forEach(e=>{t.push({x:parseFloat(e.querySelector(".vle-x").value),y:parseFloat(e.querySelector(".vle-y").value)})}),!function(e){const t=document.getElementById("comp_name_A").value,n=document.getElementById("comp_name_B").value,a=document.getElementById("vle_source_input").value;if(!t||!n||!a)return alert("Name of componet and resources are necessary."),!1;const l=["LK_vle_Cpl_input","LK_vle_vLatent_heat_input","HK_vle_Cpl_input","HK_vle_vLatent_heat_input"];for(const e of l){const t=document.getElementById(e).value;if(t&&isNaN(parseFloat(t)))return alert("Cp, Latent Heat should be number."),!1}return!(e.length<2)||(alert("Two VLE is necessary."),!1)}(t))return;t.sort((e,t)=>e.x-t.x);const n=document.getElementById("comp_name_A").value.trim(),a=document.getElementById("comp_name_B").value.trim(),l=document.getElementById("vle_source_input").value.trim(),s=document.getElementById("LK_vle_Cpl_input").value,r=document.getElementById("LK_vle_vLatent_heat_input").value,i=document.getElementById("HK_vle_Cpl_input").value,u=document.getElementById("HK_vle_vLatent_heat_input").value,_=s?parseFloat(s):0,y=r?parseFloat(r):0,p=i?parseFloat(i):0,h=u?parseFloat(u):0,v=`${n}-${a}`,b="loc_"+Date.now()+Math.floor(1e3*Math.random()),x={system_id:b,system_name:v,component_a:n,component_b:a,vle_points:t,vle_source:l,props:{LK_Cp:_,LK_Latent:y,HK_Cp:p,HK_Latent:h},created_at:(new Date).toISOString()};try{const e=d();e.push(x),c(e),I=t,o(I),H(),alert(`Success! '${v}' is saved.`),B(),m&&(m.value=b,w({target:{value:b}}))}catch(e){console.error(e),alert("There are error during saving: "+e.message)}}),v&&v.addEventListener("click",()=>function(e=.5,t=.5){if(!f)return;const n=document.createElement("div");n.className="vle-row",n.innerHTML=`\n        <label>x:</label><input type="number" step="any" min="0" max="1" value="${e}" class="vle-x" required>\n        <label>y:</label><input type="number" step="any" min="0" max="1" value="${t}" class="vle-y" required>\n        <button type="button" class="remove-vle-row">-</button>\n    `;const a=f.querySelectorAll(".vle-row"),l=a.length>0?a[a.length-1]:null;l?f.insertBefore(n,l):f.appendChild(n),M()}()),f&&f.addEventListener("click",e=>{e.target.classList.contains("remove-vle-row")&&(e.target.closest(".vle-row").remove(),M())});var q=n(106);let R=null;const $=document.getElementById("calc-form"),z=document.getElementById("mccabeThieleChart"),N=document.getElementById("results-text"),T=z.getContext("2d");function k(){try{const e=new u,{plotData:t,results:n,floatStageNum:a,isAzeoError:l,x_azeo_array:o}=S(e);if(l){const t=`Azeotrope Error: Desired distillate composition (xd = ${e.xd.toFixed(3)}) exceeds the azeotropic point (x_azeo = ${o}). Separation to this purity is physically impossible.`;return alert(t),N.textContent=`Calculation Error:\n${t}`,void(R&&R.destroy())}!function(e,t){document.getElementById("results_Rmin").textContent=e.R_min.toFixed(3),document.getElementById("results_Rreal").textContent=e.R.toFixed(3),document.getElementById("results_Rfactor").textContent=document.getElementById("r_factor").value,document.getElementById("results_Nstage").textContent=e.stages,document.getElementById("results_Nstage_float").textContent=t.toFixed(1),document.getElementById("results_Fstage").textContent=e.feed_stage}(n,a),function(e){const t=[{label:"Ideal Equilibrium (VLE)",data:e.ideal_eq_curve,borderColor:"blue",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"Effective Eq. (Rectifying)",data:e.effective_curve,borderColor:"#00c000",borderDash:[5,5],borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"y = x",data:e.line_45,borderColor:"grey",borderWidth:1,pointRadius:0,showLine:!0,type:"line"},{label:"q-Line",data:e.q_line,borderColor:"orange",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"ESOL",data:e.esol_line,borderColor:"#6a5acd",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},{label:"SSOL",data:e.ssol_line,borderColor:"#6a5acd",borderWidth:2,pointRadius:0,showLine:!0,type:"line"},...e.steps.map(e=>({type:"line",data:e,borderColor:"#FF6384",borderWidth:1.5,pointRadius:0,fill:!1,showLine:!0,showInLegend:!1}))];R&&R.destroy(),R=new q.t1(T,{type:"scatter",data:{datasets:t},options:{plugins:{title:{display:!0,text:"McCabe-Thiele Plot (Methanol-Water @ 1 atm)",font:{size:18}},legend:{position:"bottom",labels:{filter:e=>!!e.text}},tooltip:{callbacks:{label:e=>{const t=e.raw;return`${e.dataset.label}: (x: ${t.x.toFixed(3)}, y: ${t.y.toFixed(3)})`}}}},scales:{x:{type:"linear",position:"bottom",title:{display:!0,text:"Liquid Mole Fraction (x)"},min:0,max:1},y:{type:"linear",title:{display:!0,text:"Vapor Mole Fraction (y)"},min:0,max:1}},aspectRatio:1,animation:!1,parsing:!1}})}(t)}catch(e){console.error("McCabe-Thiele 계산 중 오류 발생:",e),alert(`계산에 실패했습니다: ${e.message}\n콘솔(F12)에서 자세한 내용을 확인하세요.`),N.textContent=`계산 오류:\n${e.message}`}}q.t1.register(q.kc,q.FN,q.No,q.ZT,q.dN,q.m_,q.s$,q.hE,q.Pz),$.addEventListener("submit",e=>{e.preventDefault(),k()}),document.addEventListener("DOMContentLoaded",()=>{console.log("페이지 로드 완료. 기본값으로 첫 계산을 실행합니다."),k()})}},e=>{e.O(0,[106],()=>e(e.s=374)),e.O()}]);
//# sourceMappingURL=main.49447fb2492324f517cb.js.map